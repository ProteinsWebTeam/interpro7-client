{"version":3,"file":"js/8810.module.structure-summary.8ff.js","mappings":"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","sources":["webpack://interpro7-client/./src/components/Accession/index.tsx","webpack://interpro7-client/./src/components/Accession/style.css?1419","webpack://interpro7-client/./src/components/SimpleCommonComponents/FullScreenButton/index.tsx","webpack://interpro7-client/./src/utils/fullscreen/index.js","webpack://interpro7-client/./src/components/SimpleCommonComponents/PictureInPicturePanel/ToggleButton/index.tsx","webpack://interpro7-client/./src/components/SimpleCommonComponents/PictureInPicturePanel/index.tsx","webpack://interpro7-client/./src/components/SimpleCommonComponents/PictureInPicturePanel/style.css?e289","webpack://interpro7-client/./src/components/Structure/ViewerAndEntries/EntrySelection/index.tsx","webpack://interpro7-client/./src/components/Related/DomainEntriesOnStructure/ProteinViewerLoaded/index.tsx","webpack://interpro7-client/./src/components/Related/DomainEntriesOnStructure/index.tsx","webpack://interpro7-client/./src/components/Structure/ViewerAndEntries/ProteinViewerForStructures/index.tsx","webpack://interpro7-client/./src/components/Structure/ViewerAndEntries/index.tsx","webpack://interpro7-client/./src/components/Structure/Summary/index.tsx","webpack://interpro7-client/./src/components/Structure/ViewerOnDemand/index.tsx","webpack://interpro7-client/./src/components/Structure/ViewerOnDemand/utils/resource-restriction/index.ts","webpack://interpro7-client/./src/components/Structure/ViewerOnDemand/style.css?39be","webpack://interpro7-client/./src/utils/date/index.ts","webpack://interpro7-client/./src/components/Structure/ViewerAndEntries/button-bar.css?ba9b","webpack://interpro7-client/./src/components/Structure/ViewerAndEntries/style.css?b122"],"sourcesContent":["import React from 'react';\n\nimport cssBinder from 'styles/cssBinder';\nimport local from './style.css';\n\nconst f = cssBinder(local);\n\ntype Props = {\n  accession: string | number;\n  withTitle?: boolean;\n  title?: string;\n};\n\nconst Accession = ({ withTitle, accession, title }: Props) => {\n  return (\n    <div>\n      {title !== '' && withTitle ? <span> {title || 'Accession'}:</span> : null}\n      {title === 'Job ID' ? (\n        <span className={f('tag-sqc')}> {accession}</span>\n      ) : (\n        accession\n      )}\n    </div>\n  );\n};\n\nexport default Accession;\n","// extracted by mini-css-extract-plugin\nexport default {\"tag-sqc\":\"Accession_style__tag-sqc___bf\"};","import React, { useState, useEffect } from 'react';\n\nimport { noop } from 'lodash-es';\n\nimport Tooltip from 'components/SimpleCommonComponents/Tooltip';\nimport Button from 'components/SimpleCommonComponents/Button';\n\nimport { requestFullScreen, exitFullScreen } from 'utils/fullscreen';\nimport cssBinder from 'styles/cssBinder';\n\nimport fonts from 'EBI-Icon-fonts/fonts.css';\n\nconst css = cssBinder(fonts);\n\ntype Props = {\n  /**\n   * Hook that is call when the full screen action gets trigger\n   * @returns void\n   */\n  onFullScreenHook?: () => void;\n  /**\n   * Hook that is call when exiting the full screen action\n   * @returns void\n   */\n  onExitFullScreenHook?: () => void;\n  /**\n   * Either the id, or directly the DOM element to be send to full screen\n   */\n  element?: string | HTMLElement | null;\n  /**\n   * Content of the tooltip that appears when hovering this button\n   */\n  tooltip: string;\n  /**\n   * Extra CSS classes to add\n   */\n  className?: string;\n  /**\n   * Should we change the icon for one from https://www.ebi.ac.uk/style-lab/general/fonts/v1.3/\n   */\n  dataIcon?: string;\n  /**\n   * To disable the component\n   */\n  disabled?: boolean;\n};\nconst FullScreenButton = ({\n  element,\n  tooltip,\n  className,\n  dataIcon,\n  disabled = false,\n  onFullScreenHook = noop,\n  onExitFullScreenHook = noop,\n}: Props) => {\n  const [elementInDOM, setElementInDom] = useState<\n    HTMLElement | null | undefined\n  >(null);\n  const [isFull, setFull] = useState(false);\n  const onFullscreen = () => {\n    if (document.fullscreenElement === null) {\n      setFull(false);\n      onExitFullScreenHook();\n    }\n  };\n  useEffect(() => {\n    document.addEventListener('fullscreenchange', onFullscreen);\n    return () => document.removeEventListener('fullscreenchange', onFullscreen);\n  }, []);\n  useEffect(() => {\n    setElementInDom(\n      typeof element === 'string' ? document.getElementById(element) : element,\n    );\n  }, [element]);\n\n  if (!elementInDOM) return null;\n  const _handleFullScreen = () => {\n    if (isFull) {\n      exitFullScreen();\n      onExitFullScreenHook();\n    } else {\n      requestFullScreen(elementInDOM).then(() => onFullScreenHook());\n    }\n    setFull(!isFull);\n  };\n  const _className =\n    className || css('margin-bottom-none', 'icon', 'icon-common');\n  const icon =\n    dataIcon || (isFull ? 'icon-fullscreen-collapse' : 'icon-fullscreen');\n  return (\n    <Tooltip title={tooltip}>\n      <Button\n        type=\"inline\"\n        onClick={_handleFullScreen}\n        icon={icon}\n        title={tooltip}\n        className={_className}\n        disabled={disabled}\n      />\n    </Tooltip>\n  );\n};\n\nexport default FullScreenButton;\n","export const requestFullScreen = (element) => {\n  if ('requestFullscreen' in element) {\n    return element.requestFullscreen();\n  } else if ('webkitRequestFullscreen' in element) {\n    return element.webkitRequestFullscreen();\n  } else if ('mozRequestFullScreen' in element) {\n    return element.mozRequestFullScreen();\n  } else if ('msRequestFullscreen' in element) {\n    return element.msRequestFullscreen();\n  }\n};\n\nexport const exitFullScreen = () => {\n  if ('exitFullscreen' in document) {\n    return document.exitFullscreen();\n  } else if ('webkitExitFullscreen' in document) {\n    return document.webkitExitFullscreen();\n  } else if ('mozExitFullScreen' in document) {\n    return document.mozExitFullScreen();\n  } else if ('msExitFullscreen' in document) {\n    return document.msExitFullscreen();\n  }\n};\n\nexport const onFullScreenChange = (element, callback) => {\n  if ('onfullscreenchange' in element) {\n    element.onfullscreenchange = callback;\n  } else if ('onwebkitfullscreenchange' in element) {\n    element.onwebkitfullscreenchange = callback;\n  } else if ('onmozfullscreenchange' in element) {\n    element.onmozfullscreenchange = callback;\n  } else if ('onfullscreenchange' in document) {\n    document.onfullscreenchange = callback;\n  } else if ('onwebkitfullscreenchange' in document) {\n    document.onwebkitfullscreenchange = callback;\n  } else if ('onmozfullscreenchange' in document) {\n    document.onmozfullscreenchange = callback;\n  } else if ('onMSFullscreenChange' in document) {\n    document.onMSFullscreenChange = callback;\n  }\n};\n","import React from 'react';\nimport { connect } from 'react-redux';\nimport { createSelector } from 'reselect';\n\nimport { changeSettingsRaw } from 'actions/creators';\n\nimport Tooltip from 'components/SimpleCommonComponents/Tooltip';\ntype Props = {\n  isPIPEnabled: boolean;\n  changeSettingsRaw: typeof changeSettingsRaw;\n  className?: string;\n};\nconst PIPToggleButton = ({\n  isPIPEnabled,\n  changeSettingsRaw,\n  className,\n}: Props) => {\n  const togglePIP = () => {\n    changeSettingsRaw('ui', 'isPIPEnabled', !isPIPEnabled);\n  };\n  const text = `${\n    isPIPEnabled ? 'Disable' : 'Enable'\n  } The Picture In Picture functionality`;\n  return (\n    <Tooltip title={text}>\n      <button\n        className={className}\n        onClick={togglePIP}\n        data-icon=\"&#xf247;\"\n        title={text}\n        style={{\n          color: isPIPEnabled ? undefined : '#bbb',\n        }}\n      />\n    </Tooltip>\n  );\n};\n\nconst mapStateToProps = createSelector(\n  (state: GlobalState) => state.settings.ui,\n  (ui) => ({\n    isPIPEnabled: !!ui.isPIPEnabled,\n  })\n);\n\nexport default connect(mapStateToProps, { changeSettingsRaw })(PIPToggleButton);\n","import React, {\n  useState,\n  useEffect,\n  useRef,\n  ReactNode,\n  PropsWithChildren,\n} from 'react';\n\nimport { connect } from 'react-redux';\nimport { createSelector } from 'reselect';\n\nimport { intersectionObserver as intersectionObserverPolyfill } from 'utils/polyfills';\n\nimport cssBinder from 'styles/cssBinder';\nimport style from './style.css';\nimport fonts from 'EBI-Icon-fonts/fonts.css';\n\nconst css = cssBinder(style, fonts);\n\nconst NUMBER_OF_CHECKS = 10;\nconst optionsForObserver = {\n  root: null,\n  rootMargin: '0px',\n  threshold: Array.from(Array(NUMBER_OF_CHECKS)).map(\n    (_, n) => (n + 1) / NUMBER_OF_CHECKS\n  ),\n};\ntype Props = {\n  className: string;\n  hideBar?: boolean;\n  OtherControls?: {\n    bottom?: ReactNode | null;\n    top?: ReactNode | null;\n  };\n  OtherButtons?: ReactNode | null;\n  onChangingMode?: () => void;\n  isPIPEnabled?: boolean;\n} & PropsWithChildren;\n\nconst PictureInPicturePanel = ({\n  className,\n  hideBar = false,\n  OtherControls = { bottom: null, top: null },\n  OtherButtons = null,\n  onChangingMode = () => null,\n  isPIPEnabled = true,\n  children,\n}: Props) => {\n  const [isStuck, setStuck] = useState(false);\n  const [isMinimized, setMinimized] = useState(false);\n  const wrapperRef /*: { current: null | React$ElementRef<'div'> } */ =\n    useRef(null);\n  let observer: IntersectionObserver | null = null;\n  const threshold = 0.4;\n  useEffect(() => {\n    const asynLoadPolyfill = async () => await intersectionObserverPolyfill();\n    asynLoadPolyfill();\n  }, []);\n  useEffect(() => {\n    if (wrapperRef?.current) {\n      const current = wrapperRef.current;\n      observer = new IntersectionObserver((entries) => {\n        setStuck(\n          ((current as HTMLElement)?.getBoundingClientRect()?.y || 0) < 0 &&\n            entries[0].intersectionRatio < threshold\n        );\n        onChangingMode();\n      }, optionsForObserver);\n      observer.observe(current);\n    }\n    return () => {\n      if (observer) observer.disconnect();\n    };\n  }, [wrapperRef]);\n  return (\n    <div ref={wrapperRef} className={css('wrapper')}>\n      <div\n        className={css(className, 'content', {\n          'is-stuck': isStuck && isPIPEnabled,\n          'is-minimized': isMinimized,\n        })}\n      >\n        {!isStuck && <div className={css('controls')}>{OtherControls.top}</div>}\n        {children}\n        <div\n          className={css('control-bar', {\n            hide: hideBar,\n          })}\n        >\n          {OtherControls.bottom}\n          <div className={css('controls')}>\n            {isStuck && isPIPEnabled && OtherControls.top}\n            {OtherButtons}\n            {isStuck && isPIPEnabled && (\n              <button\n                data-icon={isMinimized ? '\\uF2D0' : '\\uF2D1'}\n                title={'Minimize'}\n                onClick={() => setMinimized(!isMinimized)}\n                className={css('control-icon', 'icon', 'icon-common')}\n              />\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst mapStateToProps = createSelector(\n  (state: GlobalState) => state.settings.ui,\n  (ui: { isPIPEnabled?: boolean }) => ({\n    isPIPEnabled: !!ui.isPIPEnabled,\n  })\n);\n\nexport default connect(mapStateToProps)(PictureInPicturePanel);\n","// extracted by mini-css-extract-plugin\nexport default {\"wrapper\":\"PictureInPicturePanel_style__wrapper___c5\",\"content\":\"PictureInPicturePanel_style__content___e7\",\"control-bar\":\"PictureInPicturePanel_style__control-bar___c7\",\"controls\":\"PictureInPicturePanel_style__controls___b2\",\"is-stuck\":\"PictureInPicturePanel_style__is-stuck___c4\",\"structure-viewer-select\":\"PictureInPicturePanel_style__structure-viewer-select___f5\",\"structure-icon\":\"PictureInPicturePanel_style__structure-icon___fe\",\"is-minimized\":\"PictureInPicturePanel_style__is-minimized___b9\",\"structure-viewer-ref\":\"PictureInPicturePanel_style__structure-viewer-ref___be\"};","import React from 'react';\n\nimport cssBinder from 'styles/cssBinder';\n\nimport style from '../style.css';\n\nconst css = cssBinder(style);\nexport const NO_SELECTION = 'NO_SELECTION';\n\ntype Props = {\n  updateStructure: (memberDB: string | null, entry: string) => void;\n  entryMap: Object;\n  selectedEntry?: string;\n};\n\nconst EntrySelection = ({\n  entryMap,\n  selectedEntry,\n  updateStructure,\n}: Props) => {\n  const selectionGroups = [];\n  selectionGroups.push(\n    <option key=\"{NO_SELECTION}\" value={NO_SELECTION}>\n      Highlight Entry in the 3D structure\n    </option>\n  );\n\n  for (const [memberDB, entries] of Object.entries(entryMap)) {\n    const entryList = [];\n    for (const entry of Object.keys(entries)) {\n      const key = `${memberDB}$-${entry}`;\n      entryList.push(\n        <option key={key} value={entry}>\n          {entry}\n        </option>\n      );\n    }\n    selectionGroups.push(\n      <optgroup key={memberDB} label={memberDB}>\n        {entryList}\n      </optgroup>\n    );\n  }\n  const onSelectionChange = (e: React.FormEvent) => {\n    // extract memberDB and entry from component\n    const select = e.target as HTMLSelectElement;\n    const entry = select.value;\n    let memberDB = null;\n    if (entry !== null) {\n      const selectedOption = select.options[select.selectedIndex];\n      const optGroup = selectedOption.parentNode as HTMLOptGroupElement;\n      memberDB = optGroup?.label;\n    }\n    // update structure viewer\n    updateStructure(memberDB, entry);\n  };\n  return (\n    <select\n      className={css('structure-viewer-select')}\n      onChange={onSelectionChange}\n      onBlur={onSelectionChange}\n      value={selectedEntry}\n      data-testid=\"structure-entry-select\"\n    >\n      {selectionGroups}\n    </select>\n  );\n};\n\nexport default EntrySelection;\n","import React, { useEffect, useRef } from 'react';\n\nimport loadable from 'higherOrder/loadable';\n\nconst ProteinViewer = loadable({\n  loader: () =>\n    import(/* webpackChunkName: \"protein-viewer\" */ 'components/ProteinViewer'),\n  loading: null,\n});\n\ntype Props = {\n  tracks: Array<[string, Array<Record<string, unknown>>]>;\n  chain: string;\n  fixedHighlight?: string;\n  id: string;\n  protein: { accession: string; length: number; sequence: string };\n};\n\nconst ProteinViewerLoaded = ({ protein, tracks, chain, id }: Props) => {\n  const protvistaEl = useRef<HTMLDivElement | null>(null);\n\n  useEffect(() => {\n    if (!protvistaEl.current || !protvistaEl.current.addEventListener) return;\n    const handleMouseover = (event: Event) => {\n      const {\n        detail: { eventType, highlight, feature },\n      } = event as CustomEvent;\n      if (eventType === 'mouseover' && feature.aa) {\n        protvistaEl.current?.dispatchEvent(\n          new CustomEvent('change', {\n            detail: {\n              highlight,\n              eventType: 'sequence-chain',\n              chain,\n              protein: protein.accession,\n            },\n            bubbles: true,\n            cancelable: true,\n          }),\n        );\n      }\n    };\n    protvistaEl.current.addEventListener('change', handleMouseover);\n\n    return () => {\n      if (protvistaEl.current)\n        protvistaEl.current.removeEventListener('change', handleMouseover);\n    };\n  });\n\n  // List of \"main\" tracks to be displayed, the rest are hidden by default\n  const mainTracks = [\n    'secondary structure',\n    'families',\n    'domains',\n    'conserved site',\n    'active site',\n  ];\n\n  const hideCategories = {\n    'secondary structure': false,\n    families: false,\n    domains: false,\n    'conserved site': false,\n    'active site': false,\n  };\n\n  const enrichedTracks = [...tracks];\n\n  return (\n    <div ref={protvistaEl}>\n      <ProteinViewer\n        mainTracks={mainTracks}\n        hideCategories={hideCategories}\n        protein={protein}\n        data={enrichedTracks}\n        id={id}\n        title=\"Domains in the chain\"\n      />\n    </div>\n  );\n};\n\nexport default ProteinViewerLoaded;\n","import React, { useMemo } from 'react';\n\nimport Link from 'components/generic/Link';\nimport Tooltip from 'components/SimpleCommonComponents/Tooltip';\n\nimport ProteinViewerForStructure from './ProteinViewerLoaded';\n\nimport cssBinder from 'styles/cssBinder';\nimport fonts from 'EBI-Icon-fonts/fonts.css';\nimport { orderByAccession } from 'components/Related/DomainsOnProtein';\nimport {\n  flattenTracksObject,\n  byEntryType,\n} from 'components/Related/DomainsOnProtein/DomainsOnProteinLoaded';\n\nimport { ExtendedFeature } from 'src/components/ProteinViewer';\n\nconst css = cssBinder(fonts);\n\nfunction getBoundaries(item: ExtendedFeature | ExtendedFeature[]) {\n  let fragment = undefined;\n  let accession = undefined;\n\n  if (Array.isArray(item)) {\n    fragment = item[0].locations?.[0].fragments?.[0];\n    accession = item[0].accession;\n  } else {\n    fragment = item.locations?.[0].fragments?.[0];\n    accession = item.accession;\n  }\n  if (fragment && accession) {\n    return [accession, fragment.start, fragment.end];\n  }\n  return [0, 0];\n}\n\nexport function sortTracks(\n  a: ExtendedFeature | ExtendedFeature[],\n  b: ExtendedFeature | ExtendedFeature[],\n) {\n  const [aAccession, aStart, aEnd] = getBoundaries(a);\n  const [bAccession, bStart, bEnd] = getBoundaries(b);\n\n  if (aStart > bStart) return 1;\n  if (aStart < bStart) return -1;\n  if (aStart === bStart) {\n    if (aEnd < bEnd) return 1;\n    if (aEnd > bEnd) return -1;\n    if (aEnd === bEnd) {\n      if (aAccession > bAccession) return 1;\n      else return -1;\n    }\n  }\n  return 0;\n}\n\nconst toArrayStructure = (locations: Array<ProtVistaLocation>) =>\n  locations.map((loc) => loc.fragments.map((fr) => [fr.start, fr.end]));\n\nexport type DataForProteinChain = {\n  protein: {\n    accession: string;\n    length: number;\n  };\n  sequence: {\n    sequence: string;\n    length: number;\n  };\n  data: {\n    [key: string]: Array<{\n      accession: string;\n      name?: string;\n      short_name?: string;\n      coordinates?: number[][][];\n      source_database: string;\n      locations: ProtVistaLocation[];\n      link?: string;\n      children?: unknown;\n      chain: string;\n      protein?: string;\n      type: string;\n    }>;\n  };\n  chain: string;\n  isChimeric?: boolean;\n};\n\nconst mergeData = (\n  secondaryData: StructureLinkedObject[],\n  secondaryStructures?: SecondaryStructure[],\n) => {\n  const out: Record<string, Record<string, DataForProteinChain>> = {};\n  for (const entry of secondaryData) {\n    if (!(entry.chain in out)) {\n      out[entry.chain] = {};\n    }\n    if (!(entry.protein in out[entry.chain])) {\n      // Merging the secondary structures data per chain\n      const secondaryStructArray = [];\n      if (secondaryStructures) {\n        for (const structure of secondaryStructures) {\n          // eslint-disable-next-line max-depth\n          if (entry.chain === structure.accession) {\n            const allFragments: Array<ProtVistaFragment> = [];\n            structure.locations.forEach((loc) => {\n              loc.fragments.forEach((f) => {\n                if (f.shape === 'helix') {\n                  f.fill = 'transparent';\n                  allFragments.push({ ...f });\n                } else {\n                  allFragments.push({ ...f });\n                }\n              });\n            });\n            const newLocations = [];\n            for (const f of allFragments) {\n              // To be consistent with the expected structure loc = [{fragments: [{}]}]\n              newLocations.push({ fragments: [{ ...f }] });\n            }\n            secondaryStructArray.push({\n              locations: newLocations,\n              type: 'secondary_structure',\n              accession: `Chain ${structure.accession}`,\n              source_database: 'PDB',\n              chain: structure.accession,\n            });\n          }\n        }\n      }\n\n      out[entry.chain][entry.protein] = {\n        protein: {\n          accession: entry.protein,\n          length: entry.protein_length,\n        },\n        sequence: {\n          sequence: entry.sequence,\n          length: entry.sequence_length,\n        },\n        data: {\n          secondary_structure: secondaryStructArray,\n        },\n        chain: entry.chain,\n      };\n    }\n\n    const dataType = entry.type;\n\n    if (!out[entry.chain][entry.protein].data[dataType as string]) {\n      out[entry.chain][entry.protein].data[dataType as string] = [];\n    }\n\n    out[entry.chain][entry.protein].data[dataType as string].push({\n      accession: entry.accession,\n      name: entry.name,\n      short_name: entry.short_name,\n      source_database: entry.source_database as 'interpro' | MemberDB,\n      coordinates: toArrayStructure(entry.entry_structure_locations),\n      locations: entry.entry_structure_locations,\n      link: `/entry/${entry.source_database}/${entry.accession}`,\n      children: entry.children?.map(\n        ({ entry_protein_locations, entry_structure_locations, ...child }) => ({\n          ...child,\n          locations: entry_structure_locations,\n        }),\n      ),\n      chain: entry.chain,\n      protein: entry.protein,\n      type: entry.type || entry.entry_type || '',\n    });\n  }\n\n  const entries = [];\n  const chains = Object.keys(out).sort((a, b) => (a ? a.localeCompare(b) : -1));\n  for (const chain of chains) {\n    const proteins = Object.keys(out[chain]).sort((a, b) =>\n      a ? a.localeCompare(b) : -1,\n    );\n    for (const protein of proteins) {\n      Object.values(out[chain][protein].data).forEach((g) =>\n        g.sort(orderByAccession),\n      );\n      entries.push(out[chain][protein]);\n    }\n  }\n  return entries;\n};\n\nconst tagChimericStructures = (data: DataForProteinChain[]) => {\n  const proteinsPerChain: Record<string, Array<string>> = {};\n  for (const e of data) {\n    if (!(e.chain in proteinsPerChain)) proteinsPerChain[e.chain] = [];\n    proteinsPerChain[e.chain].push(e.protein.accession);\n  }\n  for (const e of data) {\n    if (proteinsPerChain[e.chain].length > 1) e.isChimeric = true;\n  }\n};\n\nconst getRepresentativesPerChain = (\n  representativeDomains?: Record<string, unknown>[],\n) => {\n  const representativesPerChain: Record<string, Array<MinimalFeature>> = {};\n  if (representativeDomains?.length) {\n    representativeDomains.forEach((domain) => {\n      if (domain.chain) {\n        if (!representativesPerChain[domain.chain as string])\n          representativesPerChain[domain.chain as string] = [];\n        representativesPerChain[domain.chain as string].push(\n          domain as MinimalFeature,\n        );\n      }\n    });\n  }\n  return representativesPerChain;\n};\n\ntype Props = {\n  structure: string;\n  entries: StructureLinkedObject[];\n  unintegrated: StructureLinkedObject[];\n  secondaryStructures?: SecondaryStructure[];\n  representativeDomains?: Record<string, unknown>[];\n  representativeFamilies?: Record<string, unknown>[];\n};\n\nconst EntriesOnStructure = ({\n  entries,\n  unintegrated,\n  secondaryStructures,\n  structure,\n  representativeDomains,\n  representativeFamilies,\n}: Props) => {\n  const merged = useMemo(() => {\n    const data = mergeData(entries.concat(unintegrated), secondaryStructures);\n    tagChimericStructures(data);\n    return data;\n  }, [entries, unintegrated, secondaryStructures]);\n\n  const representativesDomainsPerChain = useMemo(\n    () => getRepresentativesPerChain(representativeDomains),\n    [representativeDomains],\n  );\n\n  const representativesFamiliesPerChain = useMemo(\n    () => getRepresentativesPerChain(representativeFamilies),\n    [representativeFamilies],\n  );\n\n  return (\n    <>\n      <div className={css('vf-stack', 'vf-stack--400')}>\n        {merged.map((e, i) => {\n          const sequenceData = {\n            accession: `${e.chain}-${structure}`,\n            ...e.sequence,\n          };\n\n          const tracks = flattenTracksObject(e.data);\n          const homologous_superfamily = tracks.filter(\n            (entry) => entry[0] == 'homologous superfamily',\n          )[0];\n\n          tracks.map((entry) => {\n            if (entry[0] === 'domain') {\n              entry[0] = 'domains';\n              if (representativesDomainsPerChain[e.chain]) {\n                entry[1] = entry[1].concat(\n                  representativesDomainsPerChain[e.chain],\n                );\n              }\n              if (homologous_superfamily) {\n                entry[1] = entry[1].concat(homologous_superfamily[1]);\n              }\n            }\n\n            if (entry[0] === 'family') {\n              entry[0] = 'families';\n              if (representativesFamiliesPerChain[e.chain]) {\n                entry[1] = entry[1].concat(\n                  representativesFamiliesPerChain[e.chain],\n                );\n              }\n            }\n\n            if (\n              entry[0] === 'homologous superfamily' ||\n              entry[0] === 'unintegrated'\n            ) {\n              entry[1] = [];\n            }\n          });\n\n          tracks.map((entry) => {\n            (entry[1] as ExtendedFeature[]).sort(sortTracks).flat();\n          });\n\n          return (\n            <div key={i} className={css('vf-stack')}>\n              <h4 id={`protvista-${e.chain}-${e.protein.accession}`}>\n                Chain {e.chain}{' '}\n                {e.protein?.accession && (\n                  <small>\n                    (\n                    <Link\n                      to={{\n                        description: {\n                          main: { key: 'protein' },\n                          protein: {\n                            db: 'uniprot',\n                            accession: e.protein.accession,\n                          },\n                        },\n                      }}\n                    >\n                      <span\n                        className={css('icon', 'icon-conceptual')}\n                        data-icon=\"&#x50;\"\n                      />{' '}\n                      {(e.protein.accession || '').toUpperCase()}\n                    </Link>\n                    )\n                  </small>\n                )}\n                {e.isChimeric && (\n                  <Tooltip title=\"This chain maps to a Chimeric protein consisting of two or more proteins\">\n                    <div className={css('tag')}>\n                      <span\n                        className={css('small', 'icon', 'icon-common')}\n                        data-icon=\"&#xf129;\"\n                        aria-label=\"This chain maps to a Chimeric protein consisting of two or more proteins\"\n                      />{' '}\n                      Chimeric\n                    </div>\n                  </Tooltip>\n                )}\n              </h4>\n              <ProteinViewerForStructure\n                tracks={\n                  tracks as Array<[string, Array<Record<string, unknown>>]>\n                }\n                chain={e.chain}\n                id={`${e.chain}-${e.protein.accession}`}\n                protein={sequenceData}\n              />\n            </div>\n          );\n        })}\n      </div>\n    </>\n  );\n};\n\nexport default EntriesOnStructure;\n","import React from 'react';\nimport { createSelector } from 'reselect';\nimport { format } from 'url';\n\nimport loadData from 'higherOrder/loadData/ts';\nimport descriptionToPath from 'utils/processDescription/descriptionToPath';\n\nimport Loading from 'components/SimpleCommonComponents/Loading';\nimport EntriesOnStructure from 'components/Related/DomainEntriesOnStructure';\nimport { useProcessData } from 'components/ProteinViewer/utils';\n\ntype StructureWithSecondary = {\n  metadata: StructureMetadata;\n  extra_fields: { secondary_structures: Array<SecondaryStructure> };\n};\nexport interface LoadedProps\n  extends LoadDataProps<PayloadList<EndpointWithMatchesPayload<EntryMetadata>>>,\n    LoadDataProps<StructureWithSecondary, 'Secondary'> {\n  structure: string;\n}\n\nconst ProteinViewerForStructure = ({\n  structure,\n  data,\n  dataSecondary,\n}: LoadedProps) => {\n  const processedData = useProcessData(data?.payload?.results, 'structure');\n\n  if (!data || data.loading) return <Loading />;\n\n  let secondaryData;\n  if (dataSecondary && !dataSecondary.loading && dataSecondary.payload) {\n    if (\n      dataSecondary.payload.extra_fields &&\n      dataSecondary.payload.extra_fields.secondary_structures\n    ) {\n      secondaryData = dataSecondary.payload.extra_fields.secondary_structures;\n    }\n  }\n  if (!data.payload || !processedData) return null;\n  const {\n    interpro,\n    unintegrated,\n    representativeDomains,\n    representativeFamilies,\n  } = processedData;\n  return (\n    <div>\n      <EntriesOnStructure\n        structure={structure}\n        entries={interpro as StructureLinkedObject[]}\n        unintegrated={unintegrated as StructureLinkedObject[]}\n        secondaryStructures={secondaryData}\n        representativeFamilies={representativeFamilies}\n        representativeDomains={representativeDomains}\n      />\n    </div>\n  );\n};\n\nexport const getURLForMatches = createSelector(\n  (state) => state.settings.api,\n  (state) => state.customLocation.description.structure,\n  ({ protocol, hostname, port, root }, { accession }) =>\n    format({\n      protocol,\n      hostname,\n      port,\n      pathname: `${root}${descriptionToPath({\n        main: { key: 'entry' },\n        structure: { isFilter: true, db: 'pdb', accession },\n        entry: { db: 'all' },\n      } as InterProPartialDescription)}`,\n      query: {\n        page_size: 200,\n        extra_fields: 'short_name',\n      },\n    }),\n);\nconst getSecondaryStructureURL = createSelector(\n  (state) => state.settings.api,\n  (state) => state.customLocation.description.structure,\n  ({ protocol, hostname, port, root }, { db, accession }) => {\n    const newDesc: InterProPartialDescription = {\n      main: { key: 'structure' },\n      structure: { db, accession },\n    };\n    return format({\n      protocol,\n      hostname,\n      port,\n      pathname: root + descriptionToPath(newDesc),\n      query: {\n        extra_fields: 'secondary_structures',\n      },\n    });\n  },\n);\n\nexport default loadData<StructureWithSecondary, 'Secondary'>({\n  propNamespace: 'Secondary',\n  getUrl: getSecondaryStructureURL,\n} as LoadDataParameters)(\n  loadData<PayloadList<EndpointWithMatchesPayload<EntryMetadata>>>(\n    getURLForMatches,\n  )(ProteinViewerForStructure),\n);\n","import React, { PureComponent, RefObject } from 'react';\nimport { connect } from 'react-redux';\nimport { createSelector } from 'reselect';\n\nimport Link from 'components/generic/Link';\nimport EntrySelection from './EntrySelection';\nimport { NO_SELECTION } from './EntrySelection';\nimport { EntryColorMode, getTrackColor } from 'utils/entry-color';\n\nimport ProteinViewerForStructures from './ProteinViewerForStructures';\nimport FullScreenButton from 'components/SimpleCommonComponents/FullScreenButton';\nimport PictureInPicturePanel from 'components/SimpleCommonComponents/PictureInPicturePanel';\nimport PIPToggleButton from 'components/SimpleCommonComponents/PictureInPicturePanel/ToggleButton';\n\nimport StructureViewer from 'components/Structure/ViewerOnDemand';\n\nimport fonts from 'EBI-Icon-fonts/fonts.css';\n\nimport cssBinder from 'styles/cssBinder';\n\nimport style from './style.css';\nimport buttonBar from './button-bar.css';\n\nconst css = cssBinder(style, buttonBar, fonts);\n\nconst RED = 0xff0000;\n\ntype Props = {\n  id: string;\n  matches: EndpointWithMatchesPayload<EntryMetadata, StructureLinkedObject>[];\n  highlight?: string;\n  colorDomainsBy: unknown;\n};\n\nexport type Selection = {\n  color: number;\n  start: number;\n  end: number;\n  chain: string;\n};\ntype SelectedEntry = {\n  accession?: string | null;\n  db?: string | null;\n  chain?: string | null;\n  protein?: string | null;\n};\ntype MinimalStructureFeature = MinimalFeature & {\n  chain?: string;\n  color: string;\n};\ntype EntryHit = {\n  struct_asym_id: string;\n  start_residue_number: number;\n  end_residue_number: number;\n  accession: string;\n  source_database: string;\n  color?: string;\n};\ntype State = {\n  entryMap: Record<string, Record<string, Record<string, EntryHit[]>>>;\n  selectedEntry: string;\n  selectedEntryToKeep?: SelectedEntry | null;\n  isReady: boolean;\n  isSplitScreen: boolean;\n  isSpinning: boolean;\n  shouldResetViewer: boolean;\n  selectionsInStructure?: Array<Selection> | null;\n};\n\nclass StructureView extends PureComponent<Props, State> {\n  name: string;\n  _protvista: RefObject<HTMLDivElement>;\n  _structureView: RefObject<HTMLDivElement>;\n  _splitView: RefObject<HTMLDivElement>;\n  splitViewStyle: Object;\n  handlingSequenceHighlight?: boolean;\n\n  constructor(props: Props) {\n    super(props);\n\n    this.state = {\n      entryMap: {},\n      selectedEntry: '',\n      selectedEntryToKeep: null,\n      isSplitScreen: false,\n      isSpinning: false,\n      shouldResetViewer: false,\n      selectionsInStructure: null,\n      isReady: false,\n    };\n\n    this.name = `${this.props.id}`;\n\n    this._protvista = React.createRef();\n    this._splitView = React.createRef();\n    this._structureView = React.createRef();\n    this.splitViewStyle = {};\n  }\n\n  async componentDidMount() {\n    const pdbid = this.props.id;\n\n    this._protvista.current?.addEventListener('change', (event: Event) => {\n      const {\n        detail: { eventType, highlight, feature, chain },\n      } = event as CustomEvent;\n      const {\n        accession,\n        source_database: sourceDB,\n        type,\n        chain: chainF,\n        protein: proteinF,\n        parent,\n      }: {\n        accession: string;\n        source_database: string;\n        type: string;\n        chain: string;\n        protein: string;\n        parent: Record<string, unknown> & { protein: string };\n      } = feature || {};\n      let proteinD = proteinF;\n\n      switch (eventType) {\n        case 'sequence-chain':\n          if (highlight) {\n            const [start, stop] = highlight.split(':');\n            this.setState({\n              selectionsInStructure: [\n                {\n                  color: RED,\n                  start: Math.round(start),\n                  end: Math.round(stop),\n                  chain: chain,\n                },\n              ],\n            });\n            this.handlingSequenceHighlight = true;\n          } else {\n            this.setState({ selectionsInStructure: null });\n          }\n          break;\n        case 'click':\n          // bit of a hack to handle missing data in some entries\n          if (!proteinD && parent) {\n            proteinD = parent.protein;\n          }\n          this.setState({\n            selectedEntryToKeep:\n              type === 'chain'\n                ? {\n                    accession: pdbid,\n                    db: 'pdb',\n                    chain: accession,\n                    protein: proteinD,\n                  }\n                : {\n                    accession: accession,\n                    db: sourceDB,\n                    chain: chainF,\n                    protein: proteinD,\n                  },\n          });\n          break;\n        case 'mouseover':\n          if (this.handlingSequenceHighlight) {\n            this.handlingSequenceHighlight = false;\n            return;\n          }\n          if (type === 'chain')\n            this.showEntryInStructure('pdb', pdbid, accession);\n          else if (type === 'secondary_structure')\n            this.setSelectionsForSecondaryStructure(feature);\n          else if (accession && !accession.startsWith('G3D:'))\n            this.showEntryInStructure(sourceDB, accession, chainF);\n          break;\n        case 'mouseout':\n          if (type !== 'secondary_structure') this.showEntryInStructure();\n          break;\n        default:\n          break;\n      }\n    });\n  }\n  componentDidUpdate() {\n    if (this.state.shouldResetViewer) {\n      requestAnimationFrame(() => this.setState({ shouldResetViewer: false }));\n    }\n  }\n\n  setSelectionsForSecondaryStructure(feature: MinimalStructureFeature) {\n    const hits: Array<{ color: string; start: number; end: number }> = [];\n    if (feature.locations) {\n      for (const loc of feature.locations) {\n        for (const frag of loc.fragments) {\n          hits.push({\n            color: feature.color,\n            start: frag.start,\n            end: frag.end,\n          });\n        }\n      }\n    }\n\n    if (hits.length > 0) {\n      const selections: Array<Selection> = [];\n      hits.forEach((hit) => {\n        const hexColour = parseInt(hit.color.substring(1), 16);\n        selections.push({\n          color: hexColour,\n          start: hit.start,\n          end: hit.end,\n          chain: feature.chain || '',\n        });\n      });\n      this.setState({ selectionsInStructure: selections });\n    } else {\n      this.setState({ selectionsInStructure: null });\n    }\n  }\n\n  _getChainMap(chain: string, locations: ProtVistaLocation[]) {\n    const chainMap = [];\n    for (const location of locations) {\n      for (const { start, end } of location.fragments) {\n        chainMap.push({\n          struct_asym_id: chain,\n          start_residue_number: start,\n          end_residue_number: end,\n          accession: chain,\n          source_database: 'pdb',\n        });\n      }\n    }\n    return chainMap;\n  }\n\n  _mapLocations(\n    map: Record<string, Array<unknown>>,\n    {\n      chain,\n      locations,\n      entry,\n      db,\n      match,\n    }: {\n      chain: string;\n      locations: ProtVistaLocation[];\n      entry: string;\n      db: string;\n      match: { metadata: { integrated: string | null } };\n    },\n  ) {\n    for (const location of locations) {\n      for (const fragment of location.fragments) {\n        map[chain].push({\n          struct_asym_id: chain,\n          start_residue_number: Math.round(fragment.start),\n          end_residue_number: Math.round(fragment.end),\n          accession: entry,\n          source_database: db,\n          parent: match.metadata.integrated\n            ? { accession: match.metadata.integrated }\n            : null,\n        });\n      }\n    }\n  }\n\n  _collateHits(database: string, accession: string, chain?: string | null) {\n    let hits: Array<EntryHit> = [];\n    if (database && accession) {\n      if (chain) {\n        hits = hits.concat(...this.state.entryMap[database][accession][chain]);\n      } else {\n        Object.keys(this.state.entryMap[database][accession]).forEach((c) => {\n          hits = hits.concat(this.state.entryMap[database][accession][c]);\n        });\n      }\n    }\n\n    hits.forEach(\n      (hit) => (hit.color = getTrackColor(hit, this.props.colorDomainsBy)),\n    );\n    return hits;\n  }\n\n  createEntryMap() {\n    const memberDBMap: Record<\n      string,\n      Record<string, Record<string, Array<EntryHit>>>\n    > = { pdb: {} };\n\n    if (this.props.matches) {\n      // create matches in structure hierarchy\n      for (const match of this.props.matches) {\n        const entry = match.metadata.accession;\n        const db = match.metadata.source_database;\n        if (!memberDBMap[db]) memberDBMap[db] = {};\n        if (!memberDBMap[db][entry]) memberDBMap[db][entry] = {};\n\n        for (const structure of match.structures) {\n          const chain = structure.chain;\n\n          if (!memberDBMap[db][entry][chain])\n            memberDBMap[db][entry][chain] = [];\n          this._mapLocations(memberDBMap[db][entry], {\n            chain,\n            locations: structure.entry_structure_locations,\n            entry,\n            db,\n            match,\n          });\n          // create PDB chain mapping\n          if (!memberDBMap.pdb[structure.accession])\n            memberDBMap.pdb[structure.accession] = {};\n          if (!memberDBMap.pdb[structure.accession][chain]) {\n            memberDBMap.pdb[structure.accession][chain] = this._getChainMap(\n              chain,\n              structure.entry_structure_locations,\n            );\n          }\n        }\n      }\n    }\n    return memberDBMap;\n  }\n\n  showEntryInStructure = (\n    memberDB?: string | null,\n    entry?: string,\n    chain?: string,\n  ) => {\n    const keep = this.state.selectedEntryToKeep;\n    let db: null | string | undefined;\n    let acc: null | string | undefined;\n    let ch: null | string | undefined;\n\n    // reset keep when 'no entry' is selected via selection input\n    if (entry === NO_SELECTION && keep) {\n      keep.db = null;\n      keep.accession = null;\n      keep.chain = null;\n    } else if (memberDB !== undefined && entry !== undefined) {\n      db = memberDB;\n      acc = entry;\n      ch = chain;\n    } else if (\n      keep &&\n      keep.db !== null &&\n      keep.accession !== null &&\n      keep.chain !== null &&\n      keep.protein !== null\n    ) {\n      db = keep.db;\n      acc = keep.accession;\n      ch = keep.chain;\n    }\n\n    if (acc && acc.startsWith('Chain')) return; // Skip the keep procedure for secondary structure\n    const hits = this._collateHits(db || '', acc || '', ch);\n    if (hits.length > 0) {\n      const selections: Array<Selection> = [];\n      hits.forEach((hit) => {\n        const hexColour = parseInt(hit.color?.substring(1) || '', 16);\n        selections.push({\n          color: hexColour,\n          start: hit.start_residue_number,\n          end: hit.end_residue_number,\n          chain: hit.struct_asym_id,\n        });\n      });\n\n      this.setState({ selectionsInStructure: selections });\n    } else {\n      this.setState({ selectionsInStructure: null });\n    }\n\n    this.setState({ selectedEntry: acc || '' });\n  };\n\n  render() {\n    const {\n      entryMap,\n      selectedEntry,\n      isSpinning,\n      isSplitScreen,\n      shouldResetViewer,\n    } = this.state;\n    const pdbId = this.props.id;\n    const elementId = `structure-${pdbId}`;\n\n    return (\n      <div\n        ref={this._splitView}\n        className={css({ 'split-view': isSplitScreen })}\n      >\n        <PictureInPicturePanel\n          className={css('structure-viewer')}\n          OtherControls={{\n            top: this.props.matches ? (\n              <EntrySelection\n                entryMap={entryMap}\n                updateStructure={this.showEntryInStructure}\n                selectedEntry={selectedEntry}\n              />\n            ) : null,\n          }}\n          OtherButtons={\n            <div\n              style={{\n                display: isSplitScreen ? 'none' : 'block',\n              }}\n              className={css('button-bar')}\n            >\n              <Link\n                className={css('control')}\n                href={`https://www.ebi.ac.uk/pdbe/entry-files/download/pdb${pdbId}.ent`}\n                download={`${pdbId || 'download'}.model.pdb.ent`}\n              >\n                <span\n                  className={css('icon', 'icon-common', 'icon-download')}\n                  data-icon=\"&#xf019;\"\n                />\n                &nbsp;PDB file\n              </Link>\n              <Link\n                className={css('control')}\n                href={`https://www.ebi.ac.uk/pdbe/entry-files/download/${pdbId}.cif`}\n                download={`${pdbId || 'download'}.model.cif`}\n              >\n                <span\n                  className={css('icon', 'icon-common', 'icon-download')}\n                  data-icon=\"&#xf019;\"\n                />\n                &nbsp;mmCIF file\n              </Link>\n\n              <button\n                className={css('icon', 'icon-common', 'as-link')}\n                onClick={() => {\n                  this.setState({ isSpinning: !isSpinning });\n                }}\n                data-icon={isSpinning ? '' : 'v'}\n                title={isSpinning ? 'Stop spinning' : 'Spin structure'}\n              />\n              <button\n                className={css('icon', 'icon-common', 'as-link')}\n                onClick={() => this.setState({ shouldResetViewer: true })}\n                data-icon=\"}\"\n                title=\"Reset image\"\n              />\n              <FullScreenButton\n                element={this._splitView.current}\n                className={css('icon', 'icon-common', 'as-link')}\n                tooltip=\"Split full screen\"\n                dataIcon=\"icon-columns\"\n                onFullScreenHook={() => this.setState({ isSplitScreen: true })}\n                onExitFullScreenHook={() =>\n                  this.setState({ isSplitScreen: false })\n                }\n              />\n              <FullScreenButton\n                className={css('icon', 'icon-common', 'as-link')}\n                tooltip=\"View the structure in full screen mode\"\n                element={this.state.isReady ? elementId : null}\n              />\n              <PIPToggleButton\n                className={css('icon', 'icon-common', 'as-link')}\n              />\n            </div>\n          }\n        >\n          <StructureViewer\n            id={pdbId}\n            elementId={elementId}\n            onStructureLoaded={() => {\n              if (this.props.matches) {\n                const entryMap = this.createEntryMap();\n                this.setState({ entryMap, isReady: true });\n              }\n            }}\n            isSpinning={isSpinning}\n            shouldResetViewer={shouldResetViewer}\n            selections={this.state.selectionsInStructure}\n            onReset={() => {\n              this.setState({ selectionsInStructure: null });\n            }}\n          />\n        </PictureInPicturePanel>\n        <div\n          ref={this._protvista}\n          data-testid=\"structure-protvista\"\n          className={css('protvista-container')}\n        >\n          <ProteinViewerForStructures structure={pdbId} />\n        </div>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = createSelector(\n  (state: GlobalState) => state.settings.ui,\n  (ui) => ({\n    colorDomainsBy: ui.colorDomainsBy || EntryColorMode.DOMAIN_RELATIONSHIP,\n  }),\n);\n\nexport default connect(mapStateToProps)(StructureView);\n","import React from 'react';\n\nimport { createSelector } from 'reselect';\nimport { format } from 'url';\n\nimport loadData from 'higherOrder/loadData/ts';\nimport descriptionToPath from 'utils/processDescription/descriptionToPath';\n\nimport Accession from 'components/Accession';\nimport Link from 'components/generic/Link';\nimport BaseLink from 'components/ExtLink/BaseLink';\nimport ErrorBoundary from 'wrappers/ErrorBoundary';\nimport Literature from 'components/Entry/Literature';\nimport ViewerOnDemand from 'components/Structure/ViewerAndEntries';\nimport { formatExperimentType } from 'components/Structure/utils';\nimport { formatLongDate } from 'utils/date';\n\nimport cssBinder from 'styles/cssBinder';\n\nimport summary from 'styles/summary.css';\nimport ipro from 'styles/interpro-vf.css';\n\nconst css = cssBinder(summary, ipro);\n\nconst EXTERNAL_LINKS = [\n  { pattern: 'https://www.ebi.ac.uk/pdbe/entry/pdb/{id}', label: 'PDBe' },\n  { pattern: 'https://www.rcsb.org/structure/{id}', label: 'RCSB PDB' },\n  {\n    pattern:\n      'http://www.ebi.ac.uk/thornton-srv/databases/cgi-bin/pdbsum/GetPage.pl?pdbcode={id}',\n    label: 'PDBsum',\n  },\n  { pattern: 'https://www.cathdb.info/pdb/{id}', label: 'CATH' },\n  {\n    pattern: 'http://scop.mrc-lmb.cam.ac.uk/search?t=txt;q={id}',\n    label: 'SCOP',\n  },\n  {\n    pattern: 'http://prodata.swmed.edu/ecod/complete/search?kw={id}',\n    label: 'ECOD',\n  },\n  {\n    pattern: 'https://proteopedia.org/wiki/index.php/{id}',\n    label: 'Proteopedia',\n  },\n  {\n    pattern: 'https://search.foldseek.com/search?accession={id}&source=PDB',\n    label: 'Foldseek',\n  },\n];\n\ninterface LoadedProps\n  extends LoadDataProps<{ metadata: StructureMetadata }>,\n    LoadDataProps<\n      PayloadList<\n        EndpointWithMatchesPayload<EntryMetadata, StructureLinkedObject>\n      >,\n      'Matches'\n    > {}\n\nexport const SummaryStructure = ({ data, dataMatches }: LoadedProps) => {\n  const { loading, payload } = data || {};\n  const { loading: loadingM, payload: payloadM } = dataMatches || {};\n  if (loading || loadingM || !payload) return null;\n  const metadata = payload.metadata;\n  const matches = payloadM?.results || [];\n  const chains = Array.from(new Set(metadata.chains || []));\n  const date = new Date(metadata.release_date);\n  const literature = Object.entries(metadata.literature || {}).map((item) => {\n    // DOI_URL for structure URL is not complete. It contains only the ID\n    if (\n      item.length === 2 &&\n      item[1]?.DOI_URL !== null &&\n      !item[1]?.DOI_URL?.startsWith('http')\n    ) {\n      const id = item[1].DOI_URL;\n      item[1].DOI_URL = `https://www.doi.org/${id}`;\n    }\n    return item;\n  });\n  return (\n    <div className={css('vf-stack', 'vf-stack--400')}>\n      <section className={css('vf-grid', 'summary-grid')}>\n        <div className={css('vf-stack')}>\n          {chains.length && (\n            <table className={css('vf-table', 'left-headers')}>\n              <tbody>\n                <tr>\n                  <td style={{ maxWidth: '50%' }}>Accession</td>\n                  <td>\n                    <Accession accession={metadata.accession} />\n                  </td>\n                </tr>\n                <tr>\n                  <td>Experiment type</td>\n                  <td className={css('text-cap')}>\n                    <Link\n                      to={{\n                        description: {\n                          main: { key: 'structure' },\n                          structure: { db: 'PDB' },\n                          entry: { isFilter: true, db: 'InterPro' },\n                        },\n                        search: {\n                          experiment_type: metadata.experiment_type,\n                        },\n                      }}\n                    >\n                      {formatExperimentType(metadata.experiment_type)}\n                    </Link>\n                  </td>\n                </tr>\n                {metadata.resolution && (\n                  <tr>\n                    <td>Resolution</td>\n                    <td>{metadata.resolution} </td>\n                  </tr>\n                )}\n                <tr>\n                  <td>Chains</td>\n                  <td>{chains.join(', ')}</td>\n                </tr>\n                <tr>\n                  <td>Released</td>\n                  <td>{formatLongDate(date)}</td>\n                </tr>\n              </tbody>\n            </table>\n          )}\n        </div>\n        <div className={css('vf-stack')}>\n          <section>\n            <h5>External Links</h5>\n            <ul className={css('no-bullet')}>\n              {EXTERNAL_LINKS.map(({ label, pattern }) => (\n                <li key={label}>\n                  <BaseLink\n                    id={metadata.accession}\n                    target=\"_blank\"\n                    pattern={pattern}\n                    className={css('ext')}\n                  >\n                    {label}\n                  </BaseLink>\n                </li>\n              ))}\n            </ul>\n          </section>\n        </div>\n      </section>\n      <ErrorBoundary>\n        <div>\n          <ViewerOnDemand id={metadata.accession} matches={matches} />\n        </div>\n      </ErrorBoundary>\n      <div>\n        {literature.length ? (\n          <section id=\"references\">\n            <div className={css('vf-grid')}>\n              <h4>References</h4>\n            </div>\n            <Literature extra={literature} />\n          </section>\n        ) : null}\n      </div>\n    </div>\n  );\n};\n\nexport const getURLForMatches = createSelector(\n  (state) => state.settings.api,\n  (state) => state.customLocation.description.structure,\n  ({ protocol, hostname, port, root }, { accession }) =>\n    format({\n      protocol,\n      hostname,\n      port,\n      pathname: `${root}${descriptionToPath({\n        main: { key: 'entry' },\n        structure: { isFilter: true, db: 'pdb', accession },\n        entry: { db: 'all' },\n      })}`,\n      query: {\n        page_size: 200,\n        extra_fields: 'short_name',\n      },\n    }),\n);\n\nexport default loadData({\n  getUrl: getURLForMatches,\n  propNamespace: 'Matches',\n})(loadData()(SummaryStructure));\n","import React, { FormEvent, useRef, useState, useEffect } from 'react';\nimport { connect } from 'react-redux';\nimport { createSelector } from 'reselect';\n\nimport Link from 'components/generic/Link';\nimport LazyImage from 'components/LazyImage';\n\nimport loadable from 'higherOrder/loadable';\n\nimport isResourceRestricted from './utils/resource-restriction';\nimport { Props as ViewerProps } from '../Viewer';\nimport { changeSettingsRaw } from 'actions/creators';\n\nimport styles from './style.css';\n\nconst StructureViewAsync = loadable({\n  loader: () =>\n    import(\n      /* webpackChunkName: \"structure-viewer\" */ 'components/Structure/Viewer'\n    ),\n  loading: null,\n});\n\ntype Props = {\n  id: string;\n  userActivatedVisible: boolean;\n  changeSettingsRaw: typeof changeSettingsRaw;\n} & ViewerProps;\n\nexport const ViewerOnDemand = (props: Props) => {\n  const { id, userActivatedVisible, changeSettingsRaw } = props;\n  const [visible, setVisible] = useState(userActivatedVisible);\n  const inputRef = useRef<HTMLInputElement>(null);\n  useEffect(() => {\n    const initializeVisible = async () => {\n      setVisible(!(await isResourceRestricted()));\n    };\n    initializeVisible().catch(console.error);\n  }, []);\n\n  if (visible) {\n    return <StructureViewAsync {...props} />;\n  }\n\n  const handleCheckboxClick = (e: FormEvent) => e.stopPropagation();\n\n  const handleClick = () => {\n    if (inputRef.current?.checked) {\n      changeSettingsRaw('ui', 'structureViewer', true);\n    }\n    setVisible(true);\n  };\n\n  return (\n    <div className={styles.wrapper}>\n      <button className={styles['inner-wrapper']} onClick={handleClick}>\n        <div className={styles.background}>\n          <LazyImage\n            src={`//www.ebi.ac.uk/thornton-srv/databases/cgi-bin/pdbsum/getimg.pl?source=pdbsum&pdb_code=${id}&file=traces.jpg`}\n            alt={`structure with accession ${id}`}\n          />\n        </div>\n        <div className={styles.text}>\n          <p>\n            click or tap this area to display the interactive structure viewer\n          </p>\n          <p>\n            <label htmlFor=\"cb_reminder\">\n              Remember this next time?{' '}\n              <input\n                type=\"checkbox\"\n                ref={inputRef}\n                id=\"cb_reminder\"\n                onClick={handleCheckboxClick}\n              />\n            </label>\n            <small>\n              This can be reversed in the{' '}\n              <Link to={{ description: { other: ['settings'] } }}>\n                Settings\n              </Link>{' '}\n              page\n            </small>\n          </p>\n        </div>\n      </button>\n    </div>\n  );\n};\n\nconst mapStateToProps = createSelector(\n  (state: GlobalState) => state.settings.ui.structureViewer,\n  (userActivatedVisible) => ({\n    userActivatedVisible: userActivatedVisible || false,\n  })\n);\n\nexport default connect(mapStateToProps, { changeSettingsRaw }, null, {\n  forwardRef: true,\n})(ViewerOnDemand);\n","const LOW_BATTERY_LEVEL = 0.15;\nconst SMALL_SCREEN = 650;\n\n// http://wicg.github.io/netinfo/#connection-types\ntype ConnectionType =\n  | 'bluetooth'\n  | 'cellular'\n  | 'ethernet'\n  | 'mixed'\n  | 'none'\n  | 'other'\n  | 'unknown'\n  | 'wifi'\n  | 'wimax';\n\n// http://wicg.github.io/netinfo/#effectiveconnectiontype-enum\ntype EffectiveConnectionType = '2g' | '3g' | '4g' | 'slow-2g';\n\n// http://wicg.github.io/netinfo/#dom-megabit\ntype Megabit = number;\n// http://wicg.github.io/netinfo/#dom-millisecond\ntype Millisecond = number;\n\n// http://wicg.github.io/netinfo/#networkinformation-interface\ninterface NetworkInformation extends EventTarget {\n  // http://wicg.github.io/netinfo/#type-attribute\n  readonly type?: ConnectionType;\n  // http://wicg.github.io/netinfo/#effectivetype-attribute\n  readonly effectiveType?: EffectiveConnectionType;\n  // http://wicg.github.io/netinfo/#downlinkmax-attribute\n  readonly downlinkMax?: Megabit;\n  // http://wicg.github.io/netinfo/#downlink-attribute\n  readonly downlink?: Megabit;\n  // http://wicg.github.io/netinfo/#rtt-attribute\n  readonly rtt?: Millisecond;\n  // http://wicg.github.io/netinfo/#savedata-attribute\n  readonly saveData?: boolean;\n  // http://wicg.github.io/netinfo/#handling-changes-to-the-underlying-connection\n  onchange?: EventListener;\n}\n\nexport default async () => {\n  // If not in a browser, no restriction\n  if (!window.navigator) return false;\n  // If slow connection, restriction!\n  if (\n    'connection' in navigator &&\n    (navigator.connection as NetworkInformation)?.effectiveType !== '4g'\n  ) {\n    return true;\n  }\n  // If small screen, restriction!\n  if (window.innerWidth < SMALL_SCREEN) return true;\n  try {\n    if (\n      'getBattery' in navigator &&\n      typeof navigator.getBattery === 'function'\n    ) {\n      const battery = await navigator.getBattery();\n      // If low battery and discharging, restriction!\n      return !battery.isCharging && battery.level < LOW_BATTERY_LEVEL;\n    }\n  } catch {\n    /**/\n  }\n  return false;\n};\n","// extracted by mini-css-extract-plugin\nexport default {\"wrapper\":\"ViewerOnDemand_style__wrapper___ae\",\"inner-wrapper\":\"ViewerOnDemand_style__inner-wrapper___c3\",\"background\":\"ViewerOnDemand_style__background___e3\",\"text\":\"ViewerOnDemand_style__text___af\"};","/* eslint-disable no-magic-numbers */\nconst monthNames = [\n  'January',\n  'February',\n  'March',\n  'April',\n  'May',\n  'June',\n  'July',\n  'August',\n  'September',\n  'October',\n  'November',\n  'December',\n];\n\nconst _getOrdinal = (d: number) => {\n  if (d > 3 && d < 21) return `${d}th`;\n  switch (d % 10) {\n    case 1:\n      return `${d}st`;\n    case 2:\n      return `${d}nd`;\n    case 3:\n      return `${d}rd`;\n    default:\n      return `${d}th`;\n  }\n};\n\nexport const formatISODate = (date: string) => {\n  const d = new Date(date);\n  return `${_getOrdinal(d.getDate())} ${\n    monthNames[d.getMonth()]\n  } ${d.getFullYear()}`;\n};\n\nexport const formatLongDate = (d: Date) =>\n  `${d.getDate()} ${monthNames[d.getMonth()]} ${d.getFullYear()}`;\n\nexport const formatShortDate = (d: Date) =>\n  `${(d.getDate() < 10 ? '0' : '') + d.getDate()}/${\n    (d.getMonth() + 1 < 10 ? '0' : '') + (d.getMonth() + 1)\n  }/${d.getFullYear()}`;\n\nexport const formatLongDateTime = (d: Date) =>\n  `${(d.getDate() < 10 ? '0' : '') + d.getDate()}-${\n    (d.getMonth() + 1 < 10 ? '0' : '') + (d.getMonth() + 1)\n  }-${d.getFullYear()} ${(d.getHours() < 10 ? '0' : '') + d.getHours()}:${\n    (d.getMinutes() < 10 ? '0' : '') + d.getMinutes()\n  }:${(d.getSeconds() < 10 ? '0' : '') + d.getSeconds()}`;\n","// extracted by mini-css-extract-plugin\nexport default {\"button-bar\":\"ViewerAndEntries_button-bar__button-bar___bb\",\"control\":\"ViewerAndEntries_button-bar__control___e3\"};","// extracted by mini-css-extract-plugin\nexport default {\"structure-viewer\":\"ViewerAndEntries_style__structure-viewer___f0\",\"structure-viewer-select\":\"ViewerAndEntries_style__structure-viewer-select___ca\",\"as-link\":\"ViewerAndEntries_style__as-link___ff\",\"split-view\":\"ViewerAndEntries_style__split-view___c0\",\"protvista-container\":\"ViewerAndEntries_style__protvista-container___c4\",\"wrapper\":\"ViewerAndEntries_style__wrapper___e8\"};"],"names":["f","cssBinder","_ref","withTitle","accession","title","React","className","css","fonts","element","tooltip","dataIcon","disabled","onFullScreenHook","noop","onExitFullScreenHook","elementInDOM","setElementInDom","useState","isFull","setFull","onFullscreen","document","fullscreenElement","useEffect","addEventListener","removeEventListener","getElementById","_className","icon","Tooltip","Button","type","onClick","_handleFullScreen","exitFullscreen","webkitExitFullscreen","mozExitFullScreen","msExitFullscreen","requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen","requestFullScreen","then","mapStateToProps","createSelector","state","settings","ui","isPIPEnabled","connect","changeSettingsRaw","text","togglePIP","style","color","undefined","optionsForObserver","root","rootMargin","threshold","Array","from","map","_","n","hideBar","OtherControls","bottom","top","OtherButtons","onChangingMode","children","isStuck","setStuck","isMinimized","setMinimized","wrapperRef","useRef","observer","intersectionObserverPolyfill","current","IntersectionObserver","entries","_a","getBoundingClientRect","y","intersectionRatio","observe","disconnect","ref","hide","NO_SELECTION","entryMap","selectedEntry","updateStructure","selectionGroups","memberDB","push","key","value","Object","entryList","entry","keys","label","onSelectionChange","e","select","target","optGroup","options","selectedIndex","parentNode","onChange","onBlur","ProteinViewer","loadable","loader","loading","protein","tracks","chain","id","protvistaEl","handleMouseover","event","detail","eventType","highlight","feature","aa","dispatchEvent","CustomEvent","bubbles","cancelable","enrichedTracks","mainTracks","hideCategories","families","domains","data","getBoundaries","item","fragment","isArray","_b","locations","fragments","_d","_c","start","end","sortTracks","a","b","aAccession","aStart","aEnd","bAccession","bStart","bEnd","getRepresentativesPerChain","representativeDomains","representativesPerChain","length","forEach","domain","unintegrated","secondaryStructures","structure","representativeFamilies","merged","useMemo","mergeData","secondaryData","out","secondaryStructArray","_loop","allFragments","loc","shape","fill","assign","newLocations","source_database","protein_length","sequence","sequence_length","secondary_structure","dataType","name","short_name","coordinates","entry_structure_locations","fr","link","entry_protein_locations","child","__rest","entry_type","chains","sort","localeCompare","proteins","values","g","orderByAccession","concat","proteinsPerChain","isChimeric","tagChimericStructures","representativesDomainsPerChain","representativesFamiliesPerChain","i","sequenceData","flattenTracksObject","homologous_superfamily","filter","flat","Link","to","description","main","db","toUpperCase","ProteinViewerForStructure","getURLForMatches","api","customLocation","_ref2","_ref3","protocol","hostname","port","format","pathname","descriptionToPath","isFilter","query","page_size","extra_fields","getSecondaryStructureURL","_ref4","_ref5","newDesc","loadData","propNamespace","getUrl","dataSecondary","processedData","useProcessData","payload","results","Loading","secondary_structures","interpro","EntriesOnStructure","buttonBar","StructureView","PureComponent","constructor","props","super","showEntryInStructure","acc","ch","keep","this","selectedEntryToKeep","startsWith","hits","_collateHits","selections","hit","hexColour","parseInt","substring","start_residue_number","end_residue_number","struct_asym_id","setState","selectionsInStructure","isSplitScreen","isSpinning","shouldResetViewer","isReady","_protvista","_splitView","_structureView","splitViewStyle","componentDidMount","pdbid","sourceDB","chainF","proteinF","parent","proteinD","stop","split","Math","round","handlingSequenceHighlight","setSelectionsForSecondaryStructure","componentDidUpdate","requestAnimationFrame","frag","_getChainMap","chainMap","location","_mapLocations","match","metadata","integrated","database","c","getTrackColor","colorDomainsBy","createEntryMap","memberDBMap","pdb","matches","structures","render","pdbId","elementId","PictureInPicturePanel","EntrySelection","display","href","download","FullScreenButton","PIPToggleButton","StructureViewer","onStructureLoaded","onReset","ProteinViewerForStructures","EntryColorMode","DOMAIN_RELATIONSHIP","summary","ipro","EXTERNAL_LINKS","pattern","SummaryStructure","dataMatches","loadingM","payloadM","Set","date","Date","release_date","literature","DOI_URL","maxWidth","Accession","search","experiment_type","formatExperimentType","resolution","join","formatLongDate","BaseLink","ErrorBoundary","ViewerOnDemand","Literature","extra","StructureViewAsync","structureViewer","userActivatedVisible","forwardRef","visible","setVisible","inputRef","window","navigator","connection","effectiveType","innerWidth","getBattery","battery","isCharging","level","catch","console","error","handleClick","checked","LazyImage","src","alt","htmlFor","stopPropagation","other","monthNames","formatISODate","d","_getOrdinal","getDate","getMonth","getFullYear","formatShortDate","formatLongDateTime","getHours","getMinutes","getSeconds"],"sourceRoot":""}