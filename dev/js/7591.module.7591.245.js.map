{"version":3,"file":"js/7591.module.7591.245.js","mappings":"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","sources":["webpack://interpro7-client/./src/components/AlphaFold/selectors.ts","webpack://interpro7-client/./src/components/ProteinViewer/utils.ts","webpack://interpro7-client/./src/components/Related/DomainsOnProtein/DomainsOnProteinLoaded/index.tsx","webpack://interpro7-client/./src/components/Related/DomainsOnProtein/mergeExtraFeatures.ts","webpack://interpro7-client/./src/components/Related/DomainsOnProtein/mergeResidues.ts","webpack://interpro7-client/./src/components/Related/DomainsOnProtein/ExternalSourcesHOC/RepeatsDB/index.ts","webpack://interpro7-client/./src/components/Related/DomainsOnProtein/ExternalSourcesHOC/DisProt/index.ts","webpack://interpro7-client/./src/components/Related/DomainsOnProtein/ExternalSourcesHOC/index.tsx","webpack://interpro7-client/./src/components/Related/DomainsOnProtein/index.tsx","webpack://interpro7-client/./src/components/Structure/ViewerAndEntries/ProteinViewerForAlphafold/index.tsx","webpack://interpro7-client/./node_modules/core-js/internals/does-not-exceed-safe-integer.js","webpack://interpro7-client/./node_modules/core-js/internals/flatten-into-array.js","webpack://interpro7-client/./node_modules/core-js/modules/es.array.flat.js","webpack://interpro7-client/./node_modules/core-js/modules/es.array.unscopables.flat.js"],"sourcesContent":["import { createSelector } from 'reselect';\nimport { format } from 'url';\n\nexport const getAlphaFoldPredictionURL = createSelector(\n  (state: GlobalState) => state.settings.alphafold,\n  (state: GlobalState) => state.customLocation.description.protein.accession,\n  ({ protocol, hostname, port, root, query }, accession) => {\n    return format({\n      protocol,\n      hostname,\n      port,\n      pathname: `${root}api/prediction/${accession}`,\n      query: query,\n    });\n  },\n);\ntype StartsWithData = `data${string}`;\nexport const getConfidenceURLFromPayload = (namespace: string) =>\n  createSelector(\n    (\n      _: GlobalState,\n      props: { [d: StartsWithData]: RequestedData<AlphafoldPayload> },\n    ) => props[`data${namespace}`],\n    (dataPrediction: RequestedData<AlphafoldPayload>) => {\n      const cifURL = dataPrediction?.payload?.[0]?.cifUrl;\n      return cifURL?.length\n        ? cifURL.replace('-model', '-confidence').replace('.cif', '.json')\n        : null;\n    },\n  );\n","import { useMemo } from 'react';\nimport { toPlural } from 'utils/pages/toPlural';\nimport { NOT_MEMBER_DBS } from 'menuConfig';\nimport { getTrackColor, EntryColorMode } from 'utils/entry-color';\n\nexport const selectRepresentativeData = (\n  entries: Record<string, unknown>[],\n  locationKey: string,\n  type: string,\n) => {\n  const flatRepresentativeData = [];\n\n  for (const entry of entries) {\n    const { accession, short_name, name, source_database, integrated, chain } =\n      entry;\n\n    if (\n      entry[locationKey] === null ||\n      (entry.type !== type &&\n        (type === 'domain' ? entry.type !== 'repeat' : true)) // Handles repeat types, which fall under the \"domain\" cateogory\n    ) {\n      continue;\n    }\n    for (const location of entry[locationKey] as Array<ProtVistaLocation>) {\n      for (const fragment of location.fragments) {\n        const { start, end } = fragment;\n        const representative = location.representative;\n        if (location.representative) {\n          flatRepresentativeData.push({\n            accession,\n            chain,\n            short_name,\n            name,\n            source_database,\n            integrated,\n            representative,\n            start,\n            end,\n            color: getTrackColor({ source_database }, EntryColorMode.MEMBER_DB),\n            length: end - start + 1,\n          });\n        }\n      }\n    }\n  }\n\n  return flatRepresentativeData;\n};\n\nexport const useProcessData = <M = Metadata>(\n  results: EndpointWithMatchesPayload<M, MatchI>[] | undefined,\n  endpoint: Endpoint,\n) =>\n  useMemo(() => {\n    return processData(results || [], endpoint);\n  }, [results, endpoint]);\n\nconst processData = <M = Metadata>(\n  dataResults: EndpointWithMatchesPayload<M>[],\n  endpoint: Endpoint,\n) => {\n  const results: Record<string, unknown>[] = [];\n  for (const item of dataResults) {\n    results.splice(\n      0,\n      0,\n      ...item[toPlural(endpoint)].map((match) => ({\n        ...match,\n        ...item.metadata,\n        ...(item.extra_fields || {}),\n      })),\n    );\n  }\n  const interpro = results.filter(\n    (entry) =>\n      (entry as unknown as Metadata).source_database.toLowerCase() ===\n      'interpro',\n  );\n\n  const locationKey =\n    endpoint === 'structure'\n      ? 'entry_structure_locations'\n      : 'entry_protein_locations';\n\n  const representativeData = {\n    domains: selectRepresentativeData(results, locationKey, 'domain'),\n    families: selectRepresentativeData(results, locationKey, 'family'),\n  };\n\n  const representativeDomains = representativeData['domains'];\n  const representativeFamilies = representativeData['families'];\n\n  const interproMap = new Map(\n    interpro.map((ipro) => [\n      `${ipro.accession}-${ipro.chain}-${ipro.protein}`,\n      ipro,\n    ]),\n  );\n  const integrated = results.filter((entry) => entry.integrated);\n  const unintegrated = results.filter(\n    (entry) =>\n      interpro.concat(integrated).indexOf(entry) === -1 &&\n      !NOT_MEMBER_DBS.has(\n        (entry as unknown as Metadata).source_database.toLowerCase(),\n      ),\n  );\n  integrated.forEach((entry) => {\n    const ipro: Record<string, unknown> & {\n      children?: Array<Record<string, unknown>>;\n    } =\n      interproMap.get(`${entry.integrated}-${entry.chain}-${entry.protein}`) ||\n      {};\n    if (!ipro.children) ipro.children = [];\n    if (ipro.children.indexOf(entry) === -1) ipro.children.push(entry);\n  });\n  integrated.sort((a, b) =>\n    a.chain ? (a.chain as string).localeCompare(b.chain as string) : -1,\n  );\n  return {\n    interpro,\n    unintegrated,\n    representativeDomains,\n    representativeFamilies,\n    other: [],\n  };\n};\n","import React, { PropsWithChildren } from 'react';\nimport { addConfidenceTrack } from 'components/Structure/ViewerAndEntries/ProteinViewerForAlphafold';\nimport loadable from 'higherOrder/loadable';\nimport { groupByEntryType } from 'components/Related/DomainsOnProtein';\nimport { ProteinsAPIVariation } from '@nightingale-elements/nightingale-variation/dist/proteinAPI';\nimport {\n  ExtendedFeature,\n  ExtendedFeatureLocation,\n} from 'components/ProteinViewer';\nimport { sleep } from 'timing-functions';\n\nconst ProteinViewer = loadable({\n  loader: () =>\n    import(/* webpackChunkName: \"protein-viewer\" */ 'components/ProteinViewer'),\n  loading: null,\n});\n\n// 0A017SEX7 is a good example\nconst UNDERSCORE = /_/g;\n\nconst FIRST_IN_ORDER = [\n  'alphafold_confidence',\n  'secondary_structure',\n  'families',\n  'family',\n  'domains',\n  'domain',\n  'intrinsically_disordered_regions',\n  'conserved_site',\n  'conserved_residues',\n  'spurious_proteins',\n  'pathogenic_and_likely_pathogenic_variants',\n  'repeat',\n  'active_site',\n  'binding_site',\n  'ptm',\n];\n\nconst LASTS_IN_ORDER = [\n  'coiled-coils,_signal_peptides,_transmembrane_regions',\n  'short_linear_motifs',\n  'pfam-n',\n  'funfam',\n  'match_conservation',\n];\n\nexport const byEntryType = (\n  [a, _]: [string, unknown],\n  [b, __]: [string, unknown],\n) => {\n  for (const label of FIRST_IN_ORDER) {\n    if (a.toLowerCase() === label) return -1;\n    if (b.toLowerCase() === label) return 1;\n  }\n  for (const l of LASTS_IN_ORDER) {\n    if (a.toLowerCase() === l) return -1;\n    if (b.toLowerCase() === l) return 1;\n  }\n  return a > b ? 1 : 0;\n};\n\ntype tracksProps = {\n  interpro: Array<{ accession: string; type: string }>;\n  unintegrated: Array<MinimalFeature>;\n  other?: Array<MinimalFeature>;\n  representativeDomains?: Array<MinimalFeature>;\n  representativeFamilies?: Array<MinimalFeature>;\n  disorderedRegions?: Array<MinimalFeature>;\n};\n\nfunction getBoundaries(item: ExtendedFeature | ExtendedFeature[]) {\n  let fragment = undefined;\n  let accession = undefined;\n\n  if (Array.isArray(item)) {\n    if (item[0].entry_protein_locations)\n      fragment = item[0].entry_protein_locations?.[0].fragments?.[0];\n    else fragment = item[0].locations?.[0].fragments?.[0];\n    accession = item[0].accession;\n  } else {\n    if (item.entry_protein_locations)\n      fragment = item.entry_protein_locations?.[0].fragments?.[0];\n    else fragment = item.locations?.[0].fragments?.[0];\n    accession = item.accession;\n  }\n  if (fragment && accession) {\n    return [accession, fragment.start, fragment.end];\n  }\n  return [0, 0];\n}\n\nexport function sortTracks(\n  a: ExtendedFeature | ExtendedFeature[],\n  b: ExtendedFeature | ExtendedFeature[],\n) {\n  const [aAccession, aStart, aEnd] = getBoundaries(a);\n  const [bAccession, bStart, bEnd] = getBoundaries(b);\n\n  if (aStart > bStart) return 1;\n  if (aStart < bStart) return -1;\n  if (aStart === bStart) {\n    if (aEnd < bEnd) return 1;\n    if (aEnd > bEnd) return -1;\n    if (aEnd === bEnd) {\n      if (aAccession > bAccession) return 1;\n      else return -1;\n    }\n  }\n  return 0;\n}\n\nconst getMemberDBMatches = (\n  interpro: Array<MinimalFeature>,\n): Array<MinimalFeature> => {\n  const dbMatches: Array<MinimalFeature> = [];\n  interpro.forEach((entry) => {\n    if (entry.children) {\n      entry.children.forEach((memberDBMatch) => {\n        dbMatches.push(memberDBMatch);\n      });\n    }\n  });\n  return dbMatches;\n};\n\nexport const makeTracks = ({\n  interpro,\n  unintegrated,\n  other,\n  representativeDomains,\n  representativeFamilies,\n  disorderedRegions,\n}: tracksProps): ProteinViewerDataObject<MinimalFeature> => {\n  /* Logic to highlight matches from member DBs, not InterPro entries\n      1. Remove Intepro entries as the \"parent\" of matches from member DBs.\n      2. Merge unintegrated with result from (1.);\n      3. Sort matches in tracks based on their position but, if integrated,\n      maintaining grouping for the same InterPro entry.\n\n  // 1. and 2.\n  const integratedMatches = getMemberDBMatches(interpro);\n  const allMatches = integratedMatches.concat(unintegrated);\n\n  // this was \n  const groups = groupByEntryType(\n    allMatches as { accession: string; type: string }[],\n  );\n\n  /* 3.\n        Group matches of the same type (e.g domain) by IntePro accession\n        sort matches by position within the same group,\n        sort all the groups based on first fragment of group.\n\n  Object.keys(groups).map((key) => {\n    const uniqueInterproAccessions = [\n      ...new Set(groups[key].map((match: ExtendedFeature) => match.integrated)),\n    ];\n    const allMatchesGroupedByEntry = [];\n\n    for (let i = 0; i < uniqueInterproAccessions.length; i++) {\n      const groupedEntry = groups[key].filter(\n        (match: ExtendedFeature) =>\n          match.integrated == uniqueInterproAccessions[i],\n      );\n      // Sort non-integrated and those appearing just once for an Interpro accession, independently from the grouped ones\n      if (uniqueInterproAccessions[i] === null || groupedEntry.length == 1) {\n        groupedEntry.map((entry) => allMatchesGroupedByEntry.push(entry));\n      } else {\n        allMatchesGroupedByEntry.push(groupedEntry.sort(sortTracks));\n      }\n    }\n    groups[key] = allMatchesGroupedByEntry.sort(sortTracks).flat();\n  });*/\n\n  const groups = groupByEntryType(\n    interpro.concat(unintegrated as { accession: string; type: string }[]),\n  );\n\n  // Merge domain and families into respective representative ones. Merge homologous superfamily into domains.\n  const mergedData: ProteinViewerDataObject<MinimalFeature> = groups;\n\n  // Domain and family as empty objects, to cancat other object later\n  if (!mergedData.domain) {\n    mergedData.domain = [];\n  }\n\n  if (!mergedData.family) {\n    mergedData.family = [];\n  }\n\n  // Add repeats and homologous superfamilies to domain\n  if (mergedData.homologous_superfamily) {\n    mergedData.domain = mergedData.domain.concat(\n      mergedData.homologous_superfamily,\n    );\n    mergedData.homologous_superfamily = [];\n  }\n\n  if (mergedData.repeat) {\n    mergedData.domain = mergedData.domain.concat(mergedData.repeat);\n    mergedData.repeat = [];\n  }\n\n  // Add representative data\n  if (representativeFamilies?.length)\n    mergedData.family = mergedData.family.concat(representativeFamilies);\n\n  if (representativeDomains?.length)\n    mergedData.domain = mergedData.domain.concat(representativeDomains);\n\n  if (disorderedRegions?.length)\n    mergedData.disorderedRegions = disorderedRegions;\n\n  if (other) mergedData.other_features = other;\n\n  Object.values(mergedData).map((group) => group.sort(sortTracks).flat());\n\n  return mergedData;\n};\n\nexport const flattenTracksObject = (\n  tracksObject: ProteinViewerDataObject,\n): ProteinViewerData => {\n  return (\n    Object.entries(tracksObject)\n      .sort(byEntryType)\n      // “Binding_site” -> “Binding site”\n      .map(([key, value]) => [key.replace(UNDERSCORE, ' '), value])\n  );\n};\n\n/* Processing of the payload needs to be slightly different\nto add tracks to the dataMerged object instead of the dataSorted object */\nexport const addVariationTrack = (\n  variationPayload: ProteinsAPIVariation,\n  protein: string,\n  tracks: ProteinViewerDataObject,\n) => {\n  if (variationPayload?.features?.length) {\n    tracks['pathogenic_and_likely_pathogenic_variants'] = [];\n    tracks['pathogenic_and_likely_pathogenic_variants'][0] = {\n      accession: `variation_${protein}`,\n      data: variationPayload,\n      type: 'variation',\n      protein,\n      source_database: 'proteinsAPI',\n    };\n  }\n};\n\nexport const addPTMTrack = (\n  proteomicsPayload: ProteinsAPIProteomics,\n  protein: string,\n  tracks: ProteinViewerDataObject,\n) => {\n  if (proteomicsPayload?.features?.length) {\n    if (!tracks['ptm']) {\n      tracks['ptm'] = [];\n    }\n    tracks['ptm'].push({\n      accession: `ptm_${protein}`,\n      data: proteomicsPayload,\n      type: 'ptm',\n      protein,\n      source_database: 'proteinsAPI',\n    });\n  }\n};\n\ntype Props = PropsWithChildren<{\n  mainData:\n    | {\n        metadata: MinimalProteinMetadata;\n      }\n    | {\n        payload: {\n          metadata: MinimalProteinMetadata;\n        };\n      };\n  dataMerged: ProteinViewerDataObject;\n  dataConfidence?: RequestedData<AlphafoldConfidencePayload>;\n  dataVariation?: RequestedData<ProteinsAPIVariation>;\n  dataProteomics?: RequestedData<ProteinsAPIProteomics>;\n  conservationError?: string | null;\n  showConservationButton?: boolean;\n  handleConservationLoad?: () => void;\n  loading: boolean;\n  title?: string;\n}>;\n\nconst DomainsOnProteinLoaded = ({\n  mainData,\n  dataMerged,\n  dataConfidence,\n  dataVariation,\n  dataProteomics,\n  conservationError,\n  showConservationButton,\n  handleConservationLoad,\n  loading,\n  children,\n  title = 'Entry matches to this protein',\n}: Props) => {\n  const protein =\n    (mainData as ProteinEntryPayload).metadata ||\n    (mainData as { payload: ProteinEntryPayload }).payload.metadata;\n\n  /*\n  Special tracks are now added to the dataMerged object before being sorted based on FIRST_IN_ORDER.\n  Adding the tracks to the dataSorted object, caused the Alphafold track and variants track to be displayed always at the first/last position.\n  */\n  if (dataConfidence)\n    addConfidenceTrack(dataConfidence, protein.accession, dataMerged);\n\n  if (dataVariation?.ok && dataVariation.payload) {\n    const filteredVariationPayload = filterVariation(dataVariation.payload);\n    if (filteredVariationPayload.features.length > 0)\n      addVariationTrack(\n        filteredVariationPayload,\n        protein.accession,\n        dataMerged,\n      );\n  }\n\n  if (dataProteomics?.ok && dataProteomics.payload) {\n    if (dataProteomics.payload.features.length > 0) {\n      addPTMTrack(dataProteomics.payload, protein.accession, dataMerged);\n    }\n  }\n\n  const uniqueResidues: Record<string, ExtendedFeature> = {};\n\n  // Group PIRSR residue by description and position\n  let pirsrFound = false;\n  for (let i = 0; i < dataMerged.residues?.length; i++) {\n    const currentResidue = dataMerged.residues[i] as ExtendedFeature;\n    if (currentResidue.source_database === 'pirsr') {\n      if (!pirsrFound) pirsrFound = true;\n      const residueStart =\n        currentResidue.locations?.[0].fragments?.[0].start || 0;\n      const residueEnd = currentResidue.locations?.[0].fragments?.[0].end || 0;\n      const residueDescription =\n        currentResidue.locations?.[0].description?.replace('.', '');\n\n      const dictKey =\n        residueStart.toString() + residueEnd.toString() + residueDescription;\n\n      if (!uniqueResidues[dictKey]) uniqueResidues[dictKey] = currentResidue;\n    } else {\n      uniqueResidues[currentResidue.accession] = currentResidue;\n    }\n  }\n\n  // Create fake PIRSR object to display group label\n  if (pirsrFound)\n    uniqueResidues['PIRSR'] = {\n      accession: 'PIRSR_GROUP',\n      source_database: 'pirsr',\n      type: 'residue',\n      locations: [\n        {\n          description: 'PIRSR',\n          fragments: [{ residues: '', start: -10, end: 0 }],\n        } as ExtendedFeatureLocation,\n      ],\n    };\n\n  dataMerged.conserved_residues = Object.values(uniqueResidues).sort((a, b) => {\n    // If comparing two entries from different DBs, put the non-pirsr always first (a) OR if source database is pirsr and first element is fake label, put fake label first\n    if (\n      (a.source_database !== 'pirsr' && b.source_database === 'pirsr') ||\n      (a.source_database === b.source_database && a.accession === 'PIRSR_GROUP')\n    )\n      return -1;\n    // If comparing two entries from different DBs, put the non-pirsr always first (b) OR if source database is pirsr and second element is fake label, put fake label first\n    else if (\n      (a.source_database === 'pirsr' && b.source_database !== 'pirsr') ||\n      (a.source_database === b.source_database && b.accession === 'PIRSR_GROUP')\n    )\n      return 1;\n    // All other cases\n    else return a.accession.localeCompare(b.accession);\n  });\n\n  if (dataMerged.domain) dataMerged.domains = dataMerged.domain.slice();\n\n  if (dataMerged.family) dataMerged.families = dataMerged.family.slice();\n\n  const renamedTracks = ['domain', 'family', 'residues'];\n  const flattenedData = flattenTracksObject(dataMerged).filter(\n    (track) => !renamedTracks.includes(track[0]),\n  );\n\n  let mainTracks: string[] = [];\n  let hideCategories: Record<string, boolean> = {};\n\n  // Protein Viewer data for InterProScan Search Results needs to be handled differently\n  if (protein.accession.startsWith('iprscan')) {\n    const homologous_superfamily = flattenedData.filter(\n      (entry) => entry[0] == 'homologous superfamily',\n    )[0];\n    const representative_domains = flattenedData.filter(\n      (entry) => entry[0] == 'representative domains',\n    )[0];\n\n    const representative_families = flattenedData.filter(\n      (entry) => entry[0] == 'representative families',\n    )[0];\n\n    if (representative_domains) {\n      representative_domains[1].map((domain) => {\n        if (typeof domain === 'object' && domain !== null) {\n          (domain as { representative?: boolean })['representative'] = true;\n        }\n      });\n    }\n\n    console.log(representative_families);\n\n    if (representative_families) {\n      representative_families[1].map((family) => {\n        if (typeof family === 'object' && family !== null) {\n          (family as { representative?: boolean })['representative'] = true;\n        }\n      });\n    }\n\n    flattenedData.map((entry) => {\n      if (entry[0] === 'domains') {\n        if (homologous_superfamily) {\n          entry[1] = entry[1].concat(homologous_superfamily[1]);\n        }\n\n        if (representative_domains) {\n          entry[1] = entry[1].concat(representative_domains[1]);\n        }\n      }\n\n      if (entry[0] === 'homologous superfamily') {\n        entry[1] = [];\n      }\n    });\n\n    // Remove sections\n\n    mainTracks = [\n      'alphafold confidence',\n      'families',\n      'domains',\n      'pathogenic and likely pathogenic variants',\n      'intrinsically disordered regions',\n      'spurious proteins',\n      'conserved residues',\n      'unintegrated',\n      'other features',\n      'other residues',\n    ];\n\n    hideCategories = {\n      'secondary structure': false,\n      families: false,\n      domains: false,\n      repeat: false,\n      'conserved site': false,\n      'active site': false,\n      'binding site': false,\n      ptm: false,\n      'match conservation': false,\n      'coiled-coils, signal peptides, transmembrane regions': false,\n      'short linear motifs': false,\n      'pfam-n': false,\n      funfam: false,\n    };\n\n    flattenedData.map((entry) => {\n      (entry[1] as ExtendedFeature[]).sort(sortTracks).flat();\n    });\n\n    console.log(flattenedData);\n  } else {\n    mainTracks = [\n      'alphafold confidence',\n      'families',\n      'domains',\n      'pathogenic and likely pathogenic variants',\n      'intrinsically disordered regions',\n      'spurious proteins',\n      'conserved residues',\n    ];\n\n    hideCategories = {\n      'secondary structure': false,\n      families: true,\n      domains: true,\n      repeat: false,\n      'conserved site': false,\n      'active site': false,\n      'binding site': false,\n      ptm: false,\n      'match conservation': false,\n      'coiled-coils, signal peptides, transmembrane regions': false,\n      'short linear motifs': false,\n      'pfam-n': false,\n      funfam: false,\n    };\n  }\n\n  return (\n    <ProteinViewer\n      protein={protein}\n      data={flattenedData}\n      title={title}\n      show\n      ervationButton={showConservationButton}\n      handleConservationLoad={handleConservationLoad}\n      conservationError={conservationError}\n      loading={loading}\n      mainTracks={mainTracks}\n      hideCategories={hideCategories}\n    >\n      {children}\n    </ProteinViewer>\n  );\n};\n\nexport default DomainsOnProteinLoaded;\nfunction filterVariation(payload: ProteinsAPIVariation): ProteinsAPIVariation {\n  const types = ['pathogenic', 'likely pathogenic'];\n  const features = payload.features.filter(\n    (f) =>\n      (f?.clinicalSignificances || []).filter((cs) =>\n        types.includes((cs?.type || '').toLowerCase()),\n      ).length > 0,\n    // Next line is the filter I think UniProt uses, which yields different results than the one above\n    // (f) => (f?.association || []).filter((a) => a.disease).length > 0,\n  );\n  return {\n    ...payload,\n    features,\n  };\n}\n","import { ExtendedFeature } from 'components/ProteinViewer';\nconst mobiConsensus = 'Consensus Disorder Prediction';\nconst splitMobiFeatures = (feature: ExtendedFeature) => {\n  const newFeatures: Record<string, ExtendedFeature> = {};\n  for (const loc of feature.locations || []) {\n    const key =\n      ((loc.fragments[0] as Record<string, number | string>)\n        ?.seq_feature as string) ||\n      loc.seq_feature ||\n      mobiConsensus;\n    if (newFeatures[key]) {\n      newFeatures[key].locations?.push(loc);\n    } else {\n      newFeatures[key] = {\n        ...feature,\n        accession: `Mobidblt-${key}`,\n        locations: [loc],\n      };\n    }\n  }\n\n  return Object.values(newFeatures);\n};\n\nconst mergeExtraFeatures = (\n  data: ProteinViewerDataObject,\n  extraFeatures: Record<string, ExtendedFeature>\n) => {\n  if ('mobidb-lite' in extraFeatures) {\n    data.other_features = data.other_features.concat(\n      splitMobiFeatures(extraFeatures['mobidb-lite'])\n    );\n  }\n  data.other_features = data.other_features\n    .concat(\n      Object.values(extraFeatures).filter(\n        ({ source_database: db }) => db !== 'mobidblt'\n      )\n    )\n    .sort((a, b) => {\n      const { accession: accA, source_database: dbA } = a as Record<\n        string,\n        string\n      >;\n      const { accession: accB, source_database: dbB } = b as Record<\n        string,\n        string\n      >;\n      if (dbA === dbB) {\n        if (accA.includes(mobiConsensus)) return -1;\n        if (accB.includes(mobiConsensus)) return 1;\n        return 0;\n      }\n      return dbA.localeCompare(dbB);\n    });\n  return data;\n};\nexport default mergeExtraFeatures;\n","import { ExtendedFeature } from 'src/components/ProteinViewer';\n\nconst PIRSR_ACCESSION_LENGTH = 11;\nconst PIRSF_PREFIX_LENGTH = 5;\n\ntype FeatureWithResidues = MinimalFeature & {\n  residues?: Array<ResidueMetadata>;\n};\ntype ResidueEntry = ResidueMetadata & {\n  linked?: boolean;\n  type?: string;\n};\n\n/**\n * PIRSR residues associated with the same family can come from several models\n * which accession correspond to the family followed by the model. e.g. PIRSR000001-1 and PIRSR000001-2\n * This function groups those two model into a single residue with multiple locations.\n * @param {object} residues list of residues\n * @returns {object} list of residues with the PIRSR ones grouped\n */\nconst mergePIRSFRResidues = (residues: Record<string, ResidueMetadata>) => {\n  const newResidues: Record<string, ResidueMetadata> = {};\n  Object.keys(residues).forEach((acc) => {\n    if (acc.startsWith('PIRSR')) {\n      const newAcc = acc.substring(0, PIRSR_ACCESSION_LENGTH);\n\n      if (!newResidues[newAcc]) {\n        newResidues[newAcc] = {\n          ...residues[acc],\n          accession: newAcc,\n          locations: [] as Array<ProtVistaLocation>,\n        };\n      }\n      residues[acc].locations?.forEach(\n        (location) => (location.accession = acc),\n      );\n      newResidues[newAcc].locations?.push(...(residues[acc].locations || []));\n    } else {\n      newResidues[acc] = { ...residues[acc] };\n    }\n  });\n  return newResidues;\n};\n\nconst mergeResidues = (\n  data: ProteinViewerDataObject<MinimalFeature>,\n  residuesPayload: ResiduesPayload,\n) => {\n  const residuesWithEntryDetails: Array<FeatureWithResidues> = [];\n  const residues: Record<string, ResidueEntry> =\n    mergePIRSFRResidues(residuesPayload);\n\n  const { representative_domains: _, ...otherGroups } = data;\n  Object.values(otherGroups).forEach(\n    (\n      group /*: Array<{accession:string, residues: Array<Object>, children: any}> */,\n    ) =>\n      group.forEach((entry) => {\n        const resAccession = entry.accession.startsWith('PIRSF')\n          ? `PIRSR${entry.accession.substring(\n              PIRSF_PREFIX_LENGTH,\n              PIRSR_ACCESSION_LENGTH,\n            )}`\n          : entry.accession;\n        if (residues[resAccession]) {\n          const matchedEntry: FeatureWithResidues = { ...entry };\n          matchedEntry.accession = `residue:${entry.accession}`;\n          matchedEntry.residues = [residues[resAccession]];\n          residuesWithEntryDetails.push(matchedEntry);\n          residues[resAccession].linked = true;\n        }\n\n        if (entry.children && entry.children.length)\n          entry.children.forEach((child) => {\n            const childResAccession = child.accession.startsWith('PIRSF')\n              ? `PIRSR${child.accession.substring(\n                  PIRSF_PREFIX_LENGTH,\n                  PIRSR_ACCESSION_LENGTH,\n                )}`\n              : child.accession;\n            if (residues[childResAccession]) {\n              const matchedEntry: FeatureWithResidues = { ...child };\n              matchedEntry.accession = `residue:${child.accession}`;\n              matchedEntry.residues = [residues[childResAccession]];\n              residuesWithEntryDetails.push(matchedEntry);\n              residues[childResAccession].linked = true;\n            }\n          });\n      }),\n  );\n\n  const unlinkedResidues: ResidueEntry[] = [];\n  Object.values(residues)\n    .filter(({ linked }) => !linked)\n    .forEach((residue) => {\n      residue.locations.forEach((location, i) => {\n        const residueEntry = { ...residue };\n        residueEntry.accession = `${\n          location.accession || residue.accession\n        }.${i}`;\n        residueEntry.type = 'residue';\n        residueEntry.locations = [location];\n        unlinkedResidues.push(residueEntry);\n      });\n    });\n\n  data.residues = (residuesWithEntryDetails as ResidueEntry[]).concat(\n    unlinkedResidues,\n  );\n};\n\nexport default mergeResidues;\n","const HTTP_OK = 200;\n\nexport const formatRepeatsDB = ({\n  loading,\n  status,\n  payload,\n}: RequestedData<RepeatsDBPayload>) => {\n  const panelsData: MinimalFeature[] = [];\n  if (!loading && status === HTTP_OK && payload) {\n    const data = Object.values(payload.items);\n    for (const item of data) {\n      const proteinAcc = item.content.chain.structure;\n      for (const feature of item.content.loci) {\n        if (feature.type === 'region')\n          panelsData.push({\n            accession: `REPEAT:${proteinAcc}:${feature.start}-${feature.end}`,\n            protein: proteinAcc,\n            source_database: 'RepeatsDB',\n            type: 'Consensus',\n            locations: [\n              {\n                fragments: [\n                  {\n                    start: feature.start,\n                    end: feature.end,\n                  },\n                ],\n              },\n            ],\n          } as MinimalFeature);\n      }\n    }\n  }\n  return panelsData;\n};\n\nexport default formatRepeatsDB;\n","const HTTP_OK = 200;\n\nconst TYPES: { [key: string]: string } = {\n  F: 'Function region',\n  S: 'Order state',\n  D: 'Disorder state',\n  T: 'Transition',\n  I: 'Transition with interaction',\n};\n\nexport const formatDisProt = ({\n  loading,\n  status,\n  payload,\n}: RequestedData<DisProtPayload>) => {\n  const panelsData: MinimalFeature[] = [];\n  if (!loading && status === HTTP_OK && payload) {\n    let i = 1;\n    for (const region of payload.disprot_consensus.full) {\n      panelsData.push({\n        accession: `DISPROT:${i++}`,\n        protein: payload.acc,\n        source_database: 'DisProt',\n        type: TYPES[region.type] || '',\n        locations: [\n          {\n            fragments: [\n              {\n                start: region.start,\n                end: region.end,\n              },\n            ],\n          },\n        ],\n      } as MinimalFeature);\n    }\n  }\n  return panelsData;\n};\n\nexport default formatDisProt;\n","import React from 'react';\nimport { createSelector } from 'reselect';\nimport { format } from 'url';\n\nimport loadData from 'higherOrder/loadData/ts';\nimport formatRepeatsDB from './RepeatsDB';\nimport formatDisProt from './DisProt';\n\nexport type ExtenalSourcesProps = {\n  loading: boolean;\n  externalSourcesData: MinimalFeature[];\n};\nexport function loadExternalSources<\n  T extends ExtenalSourcesProps = ExtenalSourcesProps,\n>(WrappedComponent: React.ComponentType<T>) {\n  // Try to create a nice displayName for React Dev Tools.\n  const displayName =\n    WrappedComponent.displayName || WrappedComponent.name || 'Component';\n\n  type Props = Omit<T, keyof ExtenalSourcesProps> &\n    LoadDataProps<DisProtPayload, 'DisProt'> &\n    LoadDataProps<RepeatsDBPayload, 'RepeatsDB'>;\n\n  const ComponentWithExternalData = (props: Props) => {\n    const {\n      dataRepeatsDB,\n      isStaleRepeatsDB: __,\n      dataDisProt,\n      isStaleDisProt: ___,\n      ...otherProps\n    } = props;\n\n    const repeatsDBFormatted = dataRepeatsDB\n      ? formatRepeatsDB(dataRepeatsDB)\n      : [];\n    const disprotFormatted = dataDisProt ? formatDisProt(dataDisProt) : [];\n\n    // TODO: Add Disprot\n\n    // Fetch the props you want to inject. This could be done with context instead.\n    const newProps = {\n      externalSourcesData: [...repeatsDBFormatted, ...disprotFormatted],\n    };\n\n    // props comes afterwards so the can override the default ones.\n    return <WrappedComponent {...newProps} {...(otherProps as T)} />;\n  };\n\n  ComponentWithExternalData.displayName = `loadExternalSources(${displayName})`;\n\n  return loadData<RepeatsDBPayload, 'RepeatsDB'>({\n    getUrl: getRepeatsDBURL,\n    propNamespace: 'RepeatsDB',\n  } as LoadDataParameters)(\n    loadData<DisProtPayload, 'DisProt'>({\n      getUrl: getDisProtURL,\n      propNamespace: 'DisProt',\n    } as LoadDataParameters)(ComponentWithExternalData),\n  );\n}\n\nconst getRepeatsDBURL = createSelector(\n  (state: GlobalState) => state.settings.repeatsDB,\n  (state: GlobalState) => state.customLocation.description.protein.accession,\n  (\n    { protocol, hostname, port, root }: ParsedURLServer,\n    accession: string | null,\n  ) => {\n    if (!accession) return null;\n    return format({\n      protocol,\n      hostname,\n      port,\n      pathname: `${root}`,\n      query: {\n        'chain.structure': `${accession}`,\n        'chain.id': 'A',\n        skip: '0',\n        limit: '1',\n      },\n    });\n  },\n);\n\nconst getDisProtURL = createSelector(\n  (state: GlobalState) => state.settings.disprot,\n  (state: GlobalState) => state.customLocation.description.protein.accession,\n  (\n    { protocol, hostname, port, root }: ParsedURLServer,\n    accession: string | null,\n  ) => {\n    if (!accession) return null;\n    return format({\n      protocol,\n      hostname,\n      port,\n      pathname: `${root}/${accession}`,\n      query: {\n        format: 'json',\n      },\n    });\n  },\n);\n\nexport default loadExternalSources;\n","import React, { PropsWithChildren, useEffect, useState } from 'react';\nimport { createSelector } from 'reselect';\nimport { format } from 'url';\n\nimport loadData from 'higherOrder/loadData/ts';\nimport descriptionToPath from 'utils/processDescription/descriptionToPath';\nimport { edgeCases, STATUS_TIMEOUT } from 'utils/server-message';\n\nimport {\n  getAlphaFoldPredictionURL,\n  getConfidenceURLFromPayload,\n} from 'components/AlphaFold/selectors';\nimport { useProcessData } from 'components/ProteinViewer/utils';\nimport Loading from 'components/SimpleCommonComponents/Loading';\nimport Callout from 'components/SimpleCommonComponents/Callout';\nimport EdgeCase from 'components/EdgeCase';\n\n// import ConservationProvider, {\n//   mergeConservationData,\n//   // Disabling Conservation until hmmer is working\n//   // isConservationDataAvailable,\n// } from './ConservationProvider';\nimport mergeExtraFeatures from './mergeExtraFeatures';\nimport mergeResidues from './mergeResidues';\nimport DomainsOnProteinLoaded, { makeTracks } from './DomainsOnProteinLoaded';\nimport loadExternalSources, { ExtenalSourcesProps } from './ExternalSourcesHOC';\nimport { ProteinsAPIVariation } from '@nightingale-elements/nightingale-variation/dist/proteinAPI';\nimport { ExtendedFeature } from 'src/components/ProteinViewer';\n\nexport const orderByAccession = (\n  a: { accession: string },\n  b: { accession: string },\n) => (a.accession > b.accession ? 1 : -1);\n\nexport const groupByEntryType = (\n  interpro: Array<{\n    accession: string;\n    type: string;\n  }>,\n) => {\n  const groups: Record<\n    string,\n    Array<{\n      accession: string;\n      type: string;\n    }>\n  > = {};\n  for (const entry of interpro) {\n    if (!groups[entry.type]) groups[entry.type] = [];\n    groups[entry.type].push(entry);\n  }\n  Object.values(groups).forEach((g) => g.sort(orderByAccession));\n  return groups;\n};\n\nexport const getFeature = (\n  filter: string | string[],\n  mergedData: ProteinViewerDataObject,\n): ExtendedFeature[] => {\n  if (mergedData['other_features']) {\n    return (mergedData['other_features'] as ExtendedFeature[]).filter(\n      (entry) => {\n        const entryDB = entry.source_database;\n        if (entryDB) {\n          if (Array.isArray(filter))\n            return filter.some((item) => entryDB.includes(item));\n          else return filter.includes(entryDB);\n        }\n      },\n    );\n  }\n  return [];\n};\n\nexport const filterMobiDBLiteFeatures = (\n  mergedData: ProteinViewerDataObject,\n): ExtendedFeature[] => {\n  const mobiDBLiteEntries: ExtendedFeature[] = (\n    mergedData['other_features'] as ExtendedFeature[]\n  ).filter((k) =>\n    (k as ExtendedFeature).accession.toLowerCase().includes('mobidblt'),\n  );\n\n  const mobiDBLiteConsensusWithChildren: ExtendedFeature[] =\n    mobiDBLiteEntries.filter((entry) =>\n      entry.accession.toLowerCase().includes('consensus'),\n    );\n  const mobiDBLiteChildren: ExtendedFeature[] = mobiDBLiteEntries.filter(\n    (entry) => !entry.accession.toLowerCase().includes('consensus'),\n  );\n\n  if (mobiDBLiteConsensusWithChildren.length > 0) {\n    mobiDBLiteChildren.map((child) => {\n      child.protein = child.accession;\n    });\n    mobiDBLiteConsensusWithChildren[0].children = mobiDBLiteChildren;\n  }\n\n  return mobiDBLiteConsensusWithChildren;\n};\n\ntype Props = PropsWithChildren<{\n  mainData: {\n    metadata:\n      | ProteinMetadata\n      | (MinimalProteinMetadata & { name?: NameObject });\n  };\n  onMatchesLoaded?: (\n    results: EndpointWithMatchesPayload<EntryMetadata, MatchI>[],\n  ) => void;\n  onFamiliesFound?: (families: Record<string, unknown>[]) => void;\n  title?: string;\n}>;\ninterface LoadedProps\n  extends Props,\n    ExtenalSourcesProps,\n    LoadDataProps<ExtraFeaturesPayload, 'Features'>,\n    LoadDataProps<ResiduesPayload, 'Residues'>,\n    LoadDataProps<ProteinsAPIVariation, 'Variation'>,\n    LoadDataProps<AlphafoldConfidencePayload, 'Confidence'>,\n    LoadDataProps<ProteinsAPIProteomics, 'Proteomics'>,\n    LoadDataProps<AlphafoldPayload, 'Prediction'>,\n    LoadDataProps<\n      PayloadList<EndpointWithMatchesPayload<EntryMetadata>> | ErrorPayload\n    > {}\n\nconst DomainOnProteinWithoutData = ({\n  data,\n  mainData,\n  dataResidues,\n  dataFeatures,\n  dataConfidence,\n  dataVariation,\n  dataProteomics,\n  onMatchesLoaded,\n  onFamiliesFound,\n  children,\n  externalSourcesData,\n  title,\n}: LoadedProps) => {\n  // const [conservation, setConservation] = useState<{\n  //   generateData: boolean;\n  //   showButton: boolean;\n  //   data: ConservationPayload | null;\n  //   error: string | null;\n  // }>({\n  //   generateData: false,\n  //   showButton: false,\n  //   data: null,\n  //   error: null,\n  // });\n  const [processedData, setProcessedData] = useState<{\n    interpro: Record<string, unknown>[];\n    representativeDomains?: Record<string, unknown>[];\n    representativeFamilies?: Record<string, unknown>[];\n    unintegrated: Record<string, unknown>[];\n    other: Array<MinimalFeature>;\n  } | null>(null);\n  const processData = useProcessData<EntryMetadata>(\n    (\n      data?.payload as PayloadList<\n        EndpointWithMatchesPayload<EntryMetadata, MatchI>\n      >\n    )?.results,\n    'protein',\n  );\n  useEffect(() => {\n    const payload = data?.payload as PayloadList<\n      EndpointWithMatchesPayload<EntryMetadata>\n    >;\n    if (data && !data.loading) {\n      if (processData) {\n        onMatchesLoaded?.(payload?.results || []);\n        const {\n          interpro,\n          unintegrated,\n          representativeDomains,\n          representativeFamilies,\n          other,\n        } = processData;\n        setProcessedData({\n          interpro,\n          unintegrated,\n          representativeDomains,\n          representativeFamilies,\n          other,\n        });\n        onFamiliesFound?.(interpro.filter((entry) => entry.type === 'family'));\n      }\n    }\n  }, [data, processData]);\n\n  if (data?.loading && dataFeatures?.loading) return <Loading />;\n  const payload = data?.payload as PayloadList<\n    EndpointWithMatchesPayload<EntryMetadata>\n  >;\n  if (!payload?.results) {\n    const edgeCaseText = edgeCases.get(STATUS_TIMEOUT);\n    if ((data?.payload as ErrorPayload)?.detail === 'Query timed out')\n      return <EdgeCase text={edgeCaseText || ''} status={STATUS_TIMEOUT} />;\n  }\n  if (!processedData) return null;\n  const {\n    interpro,\n    unintegrated,\n    other,\n    representativeDomains,\n    representativeFamilies,\n  } = processedData;\n  const mergedData = makeTracks({\n    interpro: interpro as Array<{ accession: string; type: string }>,\n    unintegrated: unintegrated as Array<{ accession: string; type: string }>,\n    other: other as Array<MinimalFeature>,\n    representativeDomains: representativeDomains as Array<MinimalFeature>,\n    representativeFamilies: representativeFamilies as Array<MinimalFeature>,\n  });\n  if (externalSourcesData.length) {\n    mergedData.external_sources = externalSourcesData;\n  }\n\n  if (dataResidues && !dataResidues.loading && dataResidues.payload) {\n    mergeResidues(mergedData, dataResidues.payload);\n  }\n\n  if (dataFeatures && !dataFeatures.loading && dataFeatures.payload) {\n    mergeExtraFeatures(mergedData, dataFeatures?.payload);\n    mergedData['intrinsically_disordered_regions'] = filterMobiDBLiteFeatures(\n      mergedData,\n    ) as MinimalFeature[];\n\n    /* Splitting the \"other features\" section in mulitple subsets.\n       Using this logic we can go back to having the \"other_features\" section again.\n    */\n\n    // Create a section for each of the following types\n    const CPST = ['coils', 'phobius', 'signalp', 'tmhmm'];\n    mergedData['coiled-coils,_signal_peptides,_transmembrane_regions'] =\n      getFeature(CPST, mergedData) as MinimalFeature[];\n    mergedData['pfam-n'] = getFeature('pfam-n', mergedData) as MinimalFeature[];\n    mergedData['short_linear_motifs'] = getFeature(\n      'elm',\n      mergedData,\n    ) as MinimalFeature[];\n    mergedData['funfam'] = getFeature('funfam', mergedData) as MinimalFeature[];\n\n    if (Object.keys(mergedData).includes('region')) {\n      mergedData['spurious_proteins'] = mergedData['region'];\n      delete mergedData['region'];\n    }\n\n    //\n\n    // Filter the types above out of the \"other_features\" section\n    const toRemove = CPST.concat([\n      'pfam-n',\n      'short_linear_motifs',\n      'mobidblt',\n      'funfam',\n      'elm',\n    ]);\n    mergedData['other_features'] = mergedData['other_features'].filter(\n      (entry) => {\n        return !toRemove.some((item) => entry.source_database?.includes(item));\n      },\n    );\n\n    /* End of logic for splitting \"other_features\" */\n  }\n\n  if (\n    (!Object.keys(mergedData).length ||\n      !Object.values(mergedData)\n        .map((x) => x.length)\n        .reduce((agg, v) => agg + v, 0)) &&\n    !data?.loading &&\n    !dataFeatures?.loading &&\n    !dataResidues?.loading\n  ) {\n    return <Callout type=\"info\">No entries match this protein.</Callout>;\n  }\n\n  return (\n    <>\n      <DomainsOnProteinLoaded\n        title={title}\n        mainData={mainData}\n        dataMerged={mergedData}\n        dataConfidence={dataConfidence}\n        dataVariation={dataVariation}\n        dataProteomics={dataProteomics}\n        loading={\n          data?.loading ||\n          dataFeatures?.loading ||\n          dataResidues?.loading ||\n          false\n        }\n        // Disabling Conservation until hmmer is working\n        // conservationError={conservation.error}\n        // showConservationButton={showConservationButton}\n        // handleConservationLoad={fetchConservationData}\n      >\n        {children}\n      </DomainsOnProteinLoaded>\n    </>\n  );\n};\n\nconst getRelatedEntriesURL = createSelector(\n  (state: GlobalState) => state.settings.api,\n  (state: GlobalState) => state.customLocation.description.protein.accession,\n  (\n    { protocol, hostname, port, root }: ParsedURLServer,\n    accession: string | null,\n  ) => {\n    const newDesc: InterProPartialDescription = {\n      main: { key: 'entry' },\n      protein: { isFilter: true, db: 'uniprot', accession },\n      entry: { db: 'all' },\n    };\n    return format({\n      protocol,\n      hostname,\n      port,\n      pathname: root + descriptionToPath(newDesc),\n      query: {\n        page_size: 200,\n        extra_fields: 'hierarchy,short_name',\n      },\n    });\n  },\n);\n\nconst getExtraURL = (query: string) =>\n  createSelector(\n    (state: GlobalState) => state.settings.api,\n    (state: GlobalState) => state.customLocation.description,\n    (\n      { protocol, hostname, port, root }: ParsedURLServer,\n      description: InterProDescription,\n    ) => {\n      const url = format({\n        protocol,\n        hostname,\n        port,\n        pathname: root + descriptionToPath(description),\n        query: {\n          [query]: null,\n        },\n      });\n      return url;\n    },\n  );\n\nconst getVariationURL = createSelector(\n  (state: GlobalState) => state.settings.proteinsAPI,\n  (state: GlobalState) =>\n    state.customLocation.description.protein?.accession || '',\n  ({ protocol, hostname, port, root }: ParsedURLServer, accession: string) => {\n    const url = format({\n      protocol,\n      hostname,\n      port,\n      pathname: root + 'variation/' + accession,\n    });\n    return url;\n  },\n);\n\nconst getPTMPayload = createSelector(\n  (state: GlobalState) => state.settings.proteinsAPI,\n  (state: GlobalState) =>\n    state.customLocation.description.protein?.accession || '',\n  ({ protocol, hostname, port, root }: ParsedURLServer, accession: string) => {\n    const url = format({\n      protocol,\n      hostname,\n      port,\n      pathname: root + 'proteomics/ptm/' + accession,\n    });\n    return url;\n  },\n);\n\nexport default loadExternalSources(\n  loadData<AlphafoldPayload, 'Prediction'>({\n    getUrl: getAlphaFoldPredictionURL,\n    propNamespace: 'Prediction',\n  } as LoadDataParameters)(\n    loadData<AlphafoldConfidencePayload, 'Confidence'>({\n      getUrl: getConfidenceURLFromPayload('Prediction'),\n      propNamespace: 'Confidence',\n    } as LoadDataParameters)(\n      loadData<ExtraFeaturesPayload, 'Features'>({\n        getUrl: getExtraURL('extra_features'),\n        propNamespace: 'Features',\n      } as LoadDataParameters)(\n        loadData<ResiduesPayload, 'Residues'>({\n          getUrl: getExtraURL('residues'),\n          propNamespace: 'Residues',\n        } as LoadDataParameters)(\n          loadData<ProteinsAPIProteomics, 'Proteomics'>({\n            getUrl: getPTMPayload,\n            propNamespace: 'Proteomics',\n          } as LoadDataParameters)(\n            loadData<ProteinsAPIVariation, 'Variation'>({\n              getUrl: getVariationURL,\n              propNamespace: 'Variation',\n            } as LoadDataParameters)(\n              loadData(getRelatedEntriesURL as LoadDataParameters)(\n                DomainOnProteinWithoutData,\n              ),\n            ),\n          ),\n        ),\n      ),\n    ),\n  ),\n);\n","import React, { useRef, useEffect, useState } from 'react';\n\nimport loadData from 'higherOrder/loadData/ts';\nimport loadable from 'higherOrder/loadable';\nimport { createSelector } from 'reselect';\n\nimport { format } from 'url';\nimport descriptionToPath from 'utils/processDescription/descriptionToPath';\nimport { useProcessData } from 'components/ProteinViewer/utils';\nimport {\n  getAlphaFoldPredictionURL,\n  getConfidenceURLFromPayload,\n} from 'components/AlphaFold/selectors';\nimport { Selection } from 'components/Structure/ViewerAndEntries';\n\nimport Loading from 'components/SimpleCommonComponents/Loading';\n\nimport {\n  flattenTracksObject,\n  makeTracks,\n} from 'components/Related/DomainsOnProtein/DomainsOnProteinLoaded';\n\nconst ProteinViewer = loadable({\n  loader: () =>\n    import(/* webpackChunkName: \"protein-viewer\" */ 'components/ProteinViewer'),\n  loading: null,\n});\n\n/* Processing of the payload needs to be slightly different\nto add tracks to the groups object instead of the dataSorted object */\nexport const addConfidenceTrack = (\n  dataConfidence: RequestedData<AlphafoldConfidencePayload>,\n  protein: string,\n  tracks: ProteinViewerDataObject,\n) => {\n  if (dataConfidence?.payload?.confidenceCategory?.length) {\n    tracks['alphafold_confidence'] = [];\n    tracks['alphafold_confidence'][0] = {\n      accession: `confidence_af_${protein}`,\n      data: dataConfidence.payload.confidenceCategory.join(''),\n      type: 'confidence',\n      protein,\n      source_database: 'alphafold',\n    };\n  }\n};\n\ntype Props = {\n  protein: string;\n  onChangeSelection: (s: Selection[] | null) => void;\n  isSplitScreen: boolean;\n};\ninterface LoadedProps\n  extends Props,\n    LoadDataProps<{ metadata: ProteinMetadata }, 'Protein'>,\n    LoadDataProps<AlphafoldConfidencePayload, 'Confidence'>,\n    LoadDataProps<AlphafoldPayload, 'Prediction'>,\n    LoadDataProps<PayloadList<EndpointWithMatchesPayload<EntryMetadata>>> {}\nconst ProteinViewerForAlphafold = ({\n  data,\n  protein,\n  dataProtein,\n  dataConfidence,\n  onChangeSelection,\n  isSplitScreen = false,\n}: LoadedProps) => {\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const [fixedSelection, _setFixedSelection] = useState<Selection[]>([]);\n  const [hoverSelection, _setHoverSelection] = useState<Selection[]>([]);\n  const hoverSelectionRef = useRef(hoverSelection);\n  const fixedSelectionRef = useRef(fixedSelection);\n  const processedData = useProcessData(data?.payload?.results, 'protein');\n  const setFixedSelection = (data: Selection[]) => {\n    fixedSelectionRef.current = data;\n    _setFixedSelection(data);\n  };\n  const setHoverSelection = (data: Selection[]) => {\n    hoverSelectionRef.current = data;\n    _setHoverSelection(data);\n  };\n  useEffect(() => {\n    const selection = [...hoverSelection, ...fixedSelection];\n    onChangeSelection(selection.length ? selection : null);\n  }, [fixedSelection, hoverSelection]);\n  useEffect(() => {\n    containerRef.current?.addEventListener('change', (rawEvent: Event) => {\n      const event = rawEvent as CustomEvent;\n      if (!event.detail) return;\n      const { eventType, highlight } = event.detail;\n      switch (eventType) {\n        case 'click':\n          if (fixedSelectionRef.current.length) {\n            setFixedSelection([]);\n          } else {\n            setFixedSelection(hoverSelectionRef.current);\n          }\n          break;\n        case 'mouseover': {\n          const colour =\n            parseInt(event?.detail?.feature?.color?.substring(1), 16) || 0;\n\n          const selection =\n            highlight?.split(',').map((block: string) => {\n              const parts = block.split(':');\n              const start = Number(parts?.[0]) || 1;\n              const end = Number(parts?.[1]) || 1;\n              return { chain: 'A', start, end, colour };\n            }) || [];\n          setHoverSelection(selection);\n          break;\n        }\n        case 'mouseout':\n          setHoverSelection([]);\n          break;\n        default:\n          break;\n      }\n    });\n  }, [containerRef.current]);\n  if (\n    !data ||\n    data.loading ||\n    !dataProtein ||\n    dataProtein.loading ||\n    !processedData\n  )\n    return <Loading />;\n  const {\n    interpro,\n    unintegrated,\n    representativeDomains,\n    representativeFamilies,\n  } = processedData;\n\n  const groups = makeTracks({\n    interpro: interpro as Array<{ accession: string; type: string }>,\n    unintegrated: unintegrated as Array<{ accession: string; type: string }>,\n    representativeDomains: representativeDomains as Array<MinimalFeature>,\n    representativeFamilies: representativeFamilies as Array<MinimalFeature>,\n  });\n\n  if (groups.domain) {\n    groups.domains = groups.domain.slice();\n    groups.domain = [];\n  }\n\n  if (groups.family) {\n    groups.families = groups.family.slice();\n    groups.family = [];\n  }\n\n  if (dataConfidence) addConfidenceTrack(dataConfidence, protein, groups);\n  const tracks = flattenTracksObject(groups);\n\n  const mainTracks = [\n    'alphafold confidence',\n    'domains',\n    'families',\n    'active site',\n    'conserved site',\n  ];\n\n  const hideCategories = {\n    'alphafold confidence': false,\n    domains: false,\n    families: false,\n    'active site': false,\n    'conserved site': false,\n  };\n\n  if (!dataProtein.payload?.metadata) return null;\n  return (\n    <div ref={containerRef}>\n      <ProteinViewer\n        protein={dataProtein.payload.metadata}\n        data={tracks}\n        mainTracks={mainTracks}\n        hideCategories={hideCategories}\n        title=\"Protein domains\"\n        showOptions={!isSplitScreen}\n      />\n    </div>\n  );\n};\n\nconst getProteinURL = createSelector(\n  (state) => state.settings.api,\n  (_, props) => props.protein,\n  ({ protocol, hostname, port, root }, accession) => {\n    const newDesc: InterProPartialDescription = {\n      main: { key: 'protein' },\n      protein: { db: 'uniprot', accession },\n    };\n    return format({\n      protocol,\n      hostname,\n      port,\n      pathname: root + descriptionToPath(newDesc),\n    });\n  },\n);\nconst getInterproRelatedEntriesURL = createSelector(\n  (state) => state.settings.api,\n  (_, props) => props.protein,\n  ({ protocol, hostname, port, root }, protein) => {\n    const newDesc: InterProPartialDescription = {\n      main: { key: 'entry' },\n      entry: { db: 'all' },\n      protein: { isFilter: true, db: 'uniprot', accession: protein },\n    };\n    return format({\n      protocol,\n      hostname,\n      port,\n      pathname: root + descriptionToPath(newDesc),\n      query: {\n        page_size: 200,\n        extra_fields: 'short_name',\n      },\n    });\n  },\n);\n\nexport default loadData<AlphafoldPayload, 'Prediction'>({\n  getUrl: getAlphaFoldPredictionURL,\n  propNamespace: 'Prediction',\n} as LoadDataParameters)(\n  loadData<AlphafoldConfidencePayload, 'Confidence'>({\n    getUrl: getConfidenceURLFromPayload('Prediction'),\n    propNamespace: 'Confidence',\n  } as LoadDataParameters)(\n    loadData<{ metadata: ProteinMetadata }, 'Protein'>({\n      getUrl: getProteinURL,\n      propNamespace: 'Protein',\n    } as LoadDataParameters)(\n      loadData(getInterproRelatedEntriesURL as LoadDataParameters)(\n        ProteinViewerForAlphafold,\n      ),\n    ),\n  ),\n);\n","'use strict';\nvar $TypeError = TypeError;\nvar MAX_SAFE_INTEGER = 0x1FFFFFFFFFFFFF; // 2 ** 53 - 1 == 9007199254740991\n\nmodule.exports = function (it) {\n  if (it > MAX_SAFE_INTEGER) throw $TypeError('Maximum allowed index exceeded');\n  return it;\n};\n","'use strict';\nvar isArray = require('../internals/is-array');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar doesNotExceedSafeInteger = require('../internals/does-not-exceed-safe-integer');\nvar bind = require('../internals/function-bind-context');\n\n// `FlattenIntoArray` abstract operation\n// https://tc39.github.io/proposal-flatMap/#sec-FlattenIntoArray\nvar flattenIntoArray = function (target, original, source, sourceLen, start, depth, mapper, thisArg) {\n  var targetIndex = start;\n  var sourceIndex = 0;\n  var mapFn = mapper ? bind(mapper, thisArg) : false;\n  var element, elementLen;\n\n  while (sourceIndex < sourceLen) {\n    if (sourceIndex in source) {\n      element = mapFn ? mapFn(source[sourceIndex], sourceIndex, original) : source[sourceIndex];\n\n      if (depth > 0 && isArray(element)) {\n        elementLen = lengthOfArrayLike(element);\n        targetIndex = flattenIntoArray(target, original, element, elementLen, targetIndex, depth - 1) - 1;\n      } else {\n        doesNotExceedSafeInteger(targetIndex + 1);\n        target[targetIndex] = element;\n      }\n\n      targetIndex++;\n    }\n    sourceIndex++;\n  }\n  return targetIndex;\n};\n\nmodule.exports = flattenIntoArray;\n","'use strict';\nvar $ = require('../internals/export');\nvar flattenIntoArray = require('../internals/flatten-into-array');\nvar toObject = require('../internals/to-object');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\nvar arraySpeciesCreate = require('../internals/array-species-create');\n\n// `Array.prototype.flat` method\n// https://tc39.es/ecma262/#sec-array.prototype.flat\n$({ target: 'Array', proto: true }, {\n  flat: function flat(/* depthArg = 1 */) {\n    var depthArg = arguments.length ? arguments[0] : undefined;\n    var O = toObject(this);\n    var sourceLen = lengthOfArrayLike(O);\n    var A = arraySpeciesCreate(O, 0);\n    A.length = flattenIntoArray(A, O, O, sourceLen, 0, depthArg === undefined ? 1 : toIntegerOrInfinity(depthArg));\n    return A;\n  }\n});\n","'use strict';\n// this method was added to unscopables after implementation\n// in popular engines, so it's moved to a separate module\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\n// https://tc39.es/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('flat');\n"],"names":["getAlphaFoldPredictionURL","createSelector","state","settings","alphafold","customLocation","description","protein","accession","_ref","protocol","hostname","port","root","query","format","pathname","getConfidenceURLFromPayload","namespace","_","props","dataPrediction","cifURL","_b","_a","payload","cifUrl","length","replace","selectRepresentativeData","entries","locationKey","type","flatRepresentativeData","entry","short_name","name","source_database","integrated","chain","location","fragment","fragments","start","end","representative","push","color","getTrackColor","EntryColorMode","MEMBER_DB","useProcessData","results","endpoint","useMemo","processData","dataResults","_loop","item","splice","toPlural","map","match","Object","assign","metadata","extra_fields","interpro","filter","toLowerCase","representativeData","domains","families","representativeDomains","representativeFamilies","interproMap","Map","ipro","unintegrated","concat","indexOf","NOT_MEMBER_DBS","has","forEach","get","children","sort","a","b","localeCompare","other","ProteinViewer","loadable","loader","loading","UNDERSCORE","FIRST_IN_ORDER","LASTS_IN_ORDER","byEntryType","_ref2","__","label","l","getBoundaries","undefined","Array","isArray","entry_protein_locations","_d","_c","locations","_f","_e","_h","_g","sortTracks","aAccession","aStart","aEnd","bAccession","bStart","bEnd","makeTracks","_ref3","disorderedRegions","mergedData","groupByEntryType","domain","family","homologous_superfamily","repeat","other_features","values","group","flat","flattenTracksObject","tracksObject","_ref4","key","value","_ref5","types","features","mainData","dataMerged","dataConfidence","dataVariation","dataProteomics","conservationError","showConservationButton","handleConservationLoad","title","addConfidenceTrack","ok","filteredVariationPayload","f","clinicalSignificances","cs","includes","addVariationTrack","variationPayload","tracks","data","addPTMTrack","proteomicsPayload","uniqueResidues","pirsrFound","i","residues","currentResidue","residueStart","residueEnd","residueDescription","dictKey","toString","conserved_residues","slice","renamedTracks","flattenedData","track","mainTracks","hideCategories","startsWith","representative_domains","representative_families","console","log","ptm","funfam","React","show","ervationButton","mobiConsensus","mergeResidues","residuesPayload","residuesWithEntryDetails","newResidues","keys","acc","newAcc","substring","mergePIRSFRResidues","otherGroups","__rest","resAccession","matchedEntry","linked","child","childResAccession","unlinkedResidues","residue","residueEntry","status","panelsData","items","proteinAcc","content","structure","feature","loci","TYPES","F","S","D","T","I","region","disprot_consensus","full","getRepeatsDBURL","repeatsDB","skip","limit","getDisProtURL","disprot","orderByAccession","groups","g","getFeature","entryDB","some","getRelatedEntriesURL","api","newDesc","main","isFilter","db","descriptionToPath","page_size","getExtraURL","getVariationURL","proteinsAPI","getPTMPayload","WrappedComponent","loadData","getUrl","propNamespace","dataResidues","dataFeatures","onMatchesLoaded","onFamiliesFound","externalSourcesData","processedData","setProcessedData","useState","useEffect","Loading","edgeCaseText","edgeCases","STATUS_TIMEOUT","detail","EdgeCase","text","external_sources","mergeExtraFeatures","extraFeatures","newFeatures","loc","seq_feature","splitMobiFeatures","accA","dbA","accB","dbB","mobiDBLiteEntries","k","mobiDBLiteConsensusWithChildren","mobiDBLiteChildren","filterMobiDBLiteFeatures","CPST","toRemove","x","reduce","agg","v","DomainsOnProteinLoaded","Callout","displayName","ComponentWithExternalData","dataRepeatsDB","isStaleRepeatsDB","dataDisProt","isStaleDisProt","___","otherProps","newProps","formatRepeatsDB","formatDisProt","confidenceCategory","join","getProteinURL","getInterproRelatedEntriesURL","dataProtein","onChangeSelection","isSplitScreen","containerRef","useRef","fixedSelection","_setFixedSelection","hoverSelection","_setHoverSelection","hoverSelectionRef","fixedSelectionRef","setFixedSelection","current","setHoverSelection","selection","addEventListener","rawEvent","event","eventType","highlight","colour","parseInt","split","block","parts","Number","ref","showOptions","$TypeError","TypeError","module","exports","it","lengthOfArrayLike","doesNotExceedSafeInteger","bind","flattenIntoArray","target","original","source","sourceLen","depth","mapper","thisArg","element","elementLen","targetIndex","sourceIndex","mapFn","$","toObject","toIntegerOrInfinity","arraySpeciesCreate","proto","depthArg","arguments","O","this","A","addToUnscopables"],"sourceRoot":""}