{"version":3,"file":"js/5562.module.5562.1bc.js","mappings":"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","sources":["webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-interpro-track/src/InterproEntryLayout.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-interpro-track/src/coverage/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-interpro-track/src/residues.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-interpro-track/src/nightingale-interpro-track.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-interpro-track/src/coverage/render.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-interpro-track/src/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/mixins/withDimensions/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/mixins/withPosition/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/mixins/withMargin/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/mixins/withResizable/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/mixins/withManager/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/utils/Region.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/mixins/withHighlight/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/mixins/withZoom/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/mixins/withHighlight/SVG/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/utils/bindEvents.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/utils/colors.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/decorators/customElementOnce.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/nightingale-base-element.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-track/src/FeatureShape.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-track/src/DefaultLayout.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-track/src/NonOverlappingLayout.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-track/src/config.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-track/src/ConfigHelper.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-track/src/nightingale-track.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-track/src/index.ts"],"sourcesContent":["/* eslint-disable no-param-reassign */\nimport {\n  DefaultLayout,\n  Feature,\n  FeatureLocation,\n  LayoutOptions,\n} from \"@nightingale-elements/nightingale-track\";\n\nexport const COLLAPSED_HEIGHT = 16;\nexport const EXPANDED_HEIGHT = 14;\nexport const CHILD_HEIGHT = 10;\n\nexport type ResidueLocation = FeatureLocation & {\n  length: number;\n  accession: string;\n  feature: InterProFeature;\n  description: string;\n};\nexport type Residue = {\n  accession: string;\n  locations: Array<ResidueLocation>;\n  feature: InterProFeature;\n  location: ResidueLocation;\n  i: number;\n  j: number;\n};\n\nexport type InterProFeature = Feature & {\n  residues: Residue[];\n  expanded?: boolean;\n  i?: number;\n  j?: number;\n  k?: number;\n};\n\nexport default class InterproEntryLayout extends DefaultLayout {\n  #heightMap = new Map<string, number>();\n  #yPositionMap = new Map<string, number>();\n  maxYPos = 0;\n  expanded = false;\n  padding = 1;\n  samesize = false;\n  constructor({\n    expanded,\n    padding,\n    samesize,\n    ...otherOptions\n  }: LayoutOptions & { expanded: boolean; padding: number, samesize?: boolean }) {\n    super(otherOptions);\n    if (samesize !== undefined){\n      this.samesize = samesize;\n    }\n    this.expanded = expanded;\n    this.padding = padding;\n  }\n\n  init(features: InterProFeature[], children?: InterProFeature[]) {\n\n    let childHeight = this.samesize ? EXPANDED_HEIGHT : CHILD_HEIGHT\n    let yPos = 0;\n    this.#heightMap = new Map();\n    this.#yPositionMap = new Map();\n    this.maxYPos = 0;\n    if (!features) return;\n    const innerPadding = (COLLAPSED_HEIGHT - childHeight) / 2;\n    const residuesPos: Record<\n      string,\n      Record<string, Record<string, { height: number; yPos: number }>>\n    > = {};\n    for (let k = 0; k < features.length; k++) {\n      const feature = features[k];\n      const isCollapsible = feature?.residues?.length || children?.length;\n\n      if (this.samesize){\n        this.#heightMap.set(\n          feature.accession,\n          childHeight\n        );\n      }\n\n      else {\n        this.#heightMap.set(\n          feature.accession,\n          isCollapsible && !this.expanded ? COLLAPSED_HEIGHT : EXPANDED_HEIGHT,\n        );\n      }\n\n      this.#yPositionMap.set(feature.accession, this.padding);\n      yPos = (this.#heightMap.get(feature.accession) || 0) + 2 * this.padding;\n      this.maxYPos = Math.max(this.maxYPos, yPos);\n      if (!(feature.accession in residuesPos))\n        residuesPos[feature.accession] = {};\n      if (feature.residues)\n        yPos = this.#initResidues(\n          feature.residues,\n          feature.accession,\n          this.expanded ? yPos : this.#yPositionMap.get(feature.accession) || 0,\n          k,\n          innerPadding,\n          feature.locations,\n          residuesPos,\n          this.expanded,\n        );\n    }\n    if (children)\n      for (let k = 0; k < children.length; k++) {\n        const child: InterProFeature = children[k];\n        if (!this.#heightMap.has(child.accession)) {\n          this.#heightMap.set(child.accession, childHeight);\n          this.#yPositionMap.set(\n            child.accession,\n            (this.expanded ? this.maxYPos : innerPadding) + this.padding,\n          );\n          yPos += this.expanded\n            ? 2 * this.padding +\n              (this.#heightMap.get(child.accession) || EXPANDED_HEIGHT)\n            : 0;\n          this.maxYPos = Math.max(this.maxYPos, yPos);\n        }\n        if (!(child.accession in residuesPos))\n          residuesPos[child.accession] = {};\n        if (child.residues) {\n          yPos = this.#initResidues(\n            child.residues,\n            child.accession,\n            child.expanded\n              ? yPos\n              : this.#yPositionMap.get(child.accession) || 0,\n            k,\n            innerPadding,\n            child.locations,\n            residuesPos,\n            this.expanded && child.expanded,\n          );\n        }\n      }\n    this.maxYPos += this.padding;\n  }\n\n  #initResidues(\n    residues: Residue[],\n    featureAcc: string,\n    yPos: number,\n    k: number,\n    innerPadding: number,\n    locs?: FeatureLocation[],\n    residuesPos: Record<\n      string,\n      Record<string, Record<string, { height: number; yPos: number }>>\n    > = {},\n    expanded = true,\n  ) {\n\n    let childHeight = this.samesize ? EXPANDED_HEIGHT : CHILD_HEIGHT\n\n    for (let i = 0; i < residues.length; i++) {\n      const resGroup = residues[i];\n      InterproEntryLayout.filterOutResidueFragmentsOutOfLocation(\n        resGroup,\n        locs || [],\n      );\n      if (!(resGroup.accession in residuesPos[featureAcc]))\n        residuesPos[featureAcc][resGroup.accession] = {};\n      for (let j = 0; j < resGroup.locations.length; j++) {\n        const desc = resGroup.locations[j].description;\n        if (!(desc in residuesPos[featureAcc][resGroup.accession])) {\n          residuesPos[featureAcc][resGroup.accession][desc] = {\n            height: expanded\n              ? CHILD_HEIGHT\n              : (this.#heightMap.get(featureAcc) || EXPANDED_HEIGHT) -\n                2 * innerPadding,\n            yPos: expanded ? this.maxYPos + this.padding : yPos + innerPadding,\n          };\n          yPos = expanded\n            ? this.maxYPos + 2 * this.padding + childHeight\n            : yPos;\n        }\n        this.#heightMap.set(\n          `${resGroup.accession}_${k}_${i}_${j}`,\n          residuesPos[featureAcc][resGroup.accession][desc].height,\n        );\n        this.#yPositionMap.set(\n          `${resGroup.accession}_${k}_${i}_${j}`,\n          residuesPos[featureAcc][resGroup.accession][desc].yPos,\n        );\n        this.maxYPos = Math.max(this.maxYPos, yPos);\n      }\n    }\n    return expanded ? yPos : this.maxYPos + 2 * this.padding;\n  }\n\n  static filterOutResidueFragmentsOutOfLocation(\n    residue: Residue,\n    featureLocations: FeatureLocation[],\n  ) {\n    residue.locations.forEach(\n      (locRes) =>\n        (locRes.fragments = locRes.fragments.filter((fragRes) =>\n          featureLocations.some((loc) =>\n            loc.fragments.some(\n              (frag) => fragRes.start >= frag.start && fragRes.end <= frag.end,\n            ),\n          ),\n        )),\n    );\n    residue.locations = residue.locations.filter(\n      (locRes) => locRes.fragments.length,\n    );\n  }\n\n  static getAccFromFeature(feature: Feature | string) {\n    let acc = \"\";\n    if (typeof feature === \"string\") {\n      acc = feature;\n    } else if (feature.accession) {\n      acc = feature.accession;\n    }\n    return acc;\n  }\n\n  getFeatureYPos(feature: Feature | string) {\n    const acc = InterproEntryLayout.getAccFromFeature(feature);\n    return this.#yPositionMap.get(acc) || 0;\n  }\n\n  getFeatureHeight(feature: Feature | string) {\n    const acc = InterproEntryLayout.getAccFromFeature(feature);\n    return this.#heightMap.get(acc) || 0;\n  }\n}\n","import { Feature } from \"@nightingale-elements/nightingale-track\";\n\nexport type Segment = {\n  start: number;\n  end: number;\n  value?: number;\n};\nexport const addContributor = (contributor: Segment, coverage: Segment[]) => {\n  let toContribute: Segment | null = { value: 1, ...contributor };\n  const newCoverage = [];\n  for (const segment of coverage) {\n    if (!toContribute) {\n      newCoverage.push(segment);\n      // Segment to contribute is before the current segment\n      // __|--TC--|__||--S--||__\n    } else if (toContribute.end < segment.start) {\n      newCoverage.push(toContribute);\n      toContribute = null;\n      newCoverage.push(segment);\n      // Segment to contribute contains the segment\n      // __|--TC-||==S==||-|__\n    } else if (\n      toContribute.start < segment.start &&\n      toContribute.end >= segment.end\n    ) {\n      newCoverage.push({\n        start: toContribute.start,\n        end: segment.start - 1,\n        value: toContribute.value,\n      });\n      newCoverage.push({\n        start: segment.start,\n        end: segment.end,\n        value: (segment.value || 0) + (toContribute?.value || 0),\n      });\n      toContribute =\n        segment.end === toContribute.end\n          ? null\n          : {\n              start: segment.end + 1,\n              end: toContribute.end,\n              value: toContribute.value,\n            };\n      // Segment to contribute is contained by the segment\n      // __||--S-|==TC==|-||__\n    } else if (\n      segment.start < toContribute.start &&\n      segment.end > toContribute.end\n    ) {\n      newCoverage.push({\n        start: segment.start,\n        end: toContribute.start - 1,\n        value: segment.value,\n      });\n      newCoverage.push({\n        start: toContribute.start,\n        end: toContribute.end,\n        value: (segment.value || 0) + (toContribute?.value || 0),\n      });\n      newCoverage.push({\n        start: toContribute.end + 1,\n        end: segment.end,\n        value: segment.value,\n      });\n      toContribute = null;\n      // Segment to contribute overlaps at the end of the segment\n      // __||--S--|==||--TC--|__\n    } else if (\n      segment.end >= toContribute.start &&\n      segment.end <= toContribute.end\n    ) {\n      if (segment.start < toContribute.start)\n        newCoverage.push({\n          start: segment.start,\n          end: toContribute.start - 1,\n          value: segment.value,\n        });\n      newCoverage.push({\n        start: toContribute.start,\n        end: segment.end,\n        value: (segment.value || 0) + (toContribute?.value || 0),\n      });\n      toContribute =\n        segment.end < toContribute.end\n          ? {\n              start: segment.end + 1,\n              end: toContribute.end,\n              value: toContribute.value,\n            }\n          : null;\n      // Segment to contribute overlaps at the beggining of the segment\n      // __|--TC--||==|--S--||__\n    } else if (\n      toContribute.end >= segment.start &&\n      toContribute.end < segment.end\n    ) {\n      newCoverage.push({\n        start: toContribute.start,\n        end: segment.start - 1,\n        value: toContribute.value,\n      });\n      newCoverage.push({\n        start: segment.start,\n        end: toContribute.end,\n        value: (segment.value || 0) + (toContribute?.value || 0),\n      });\n      newCoverage.push({\n        start: toContribute.end + 1,\n        end: segment.end,\n        value: segment.value,\n      });\n      toContribute = null;\n    } else {\n      newCoverage.push(segment);\n    }\n\n    // position++;\n  }\n  if (toContribute) newCoverage.push(toContribute);\n  return newCoverage;\n};\n\nexport const getCoverage = (\n  contributors: Feature[],\n  length = 100,\n  createEmptyFragments = true,\n) => {\n  let coverage: Segment[] = [];\n  if (createEmptyFragments) {\n    coverage = addContributor({ start: 1, end: length, value: 0 }, coverage);\n  }\n  contributors.forEach((f) =>\n    f.locations?.forEach((loc) =>\n      loc.fragments.forEach((fr) => {\n        coverage = addContributor(fr, coverage);\n      }),\n    ),\n  );\n  return coverage;\n};\n","import { Selection } from \"d3\";\nimport NightingaleElement, {\n  bindEvents,\n} from \"@nightingale-elements/nightingale-new-core\";\n\nimport { InterProFeature, ResidueLocation } from \"./InterproEntryLayout\";\n\nconst MAX_OPACITY_WHILE_COLAPSED = 0.8;\n\nexport type ResidueDatum = {\n  accession: string;\n  feature: InterProFeature;\n  location: ResidueLocation;\n  i: number;\n  j: number;\n  k?: number;\n  fragments: {\n    start: number;\n    end: number;\n  }[];\n  start?: number;\n  end?: number;\n  length: number;\n  description: string;\n};\n\nexport type ResidueGroup = Selection<\n  SVGGElement,\n  ResidueDatum,\n  HTMLElement | SVGElement | null,\n  unknown\n>;\ntype BaseGroup = Selection<\n  SVGGElement,\n  InterProFeature,\n  HTMLElement | SVGElement | null,\n  unknown\n>;\nexport const createResidueGroup = (baseG: BaseGroup) => {\n  return baseG\n    .selectAll(\"g.residues-group\")\n    .data(\n      (d) =>\n        (d as InterProFeature).residues?.map((r, i) => ({\n          ...r,\n          feature: d,\n          i,\n        })) || [],\n    )\n    .enter()\n    .append(\"g\")\n    .attr(\"class\", \"residues-group\")\n    .selectAll(\"g.residues-locations\")\n    .data((d) =>\n      d.locations.map((loc, j) => ({\n        ...loc,\n        accession: d.accession,\n        feature: d.feature as InterProFeature,\n        location: loc,\n        i: d.i,\n        j,\n      })),\n    )\n    .enter()\n    .append(\"g\")\n    .attr(\"class\", \"residues-locations\");\n};\n\nexport const createResiduePaths = ({\n  baseG,\n  getResidueShape,\n  getResidueTransform,\n  getResidueFill,\n  element,\n}: {\n  baseG: ResidueGroup;\n  getResidueShape: (x: ResidueDatum) => string;\n  getResidueTransform: (x: ResidueDatum) => string;\n  getResidueFill: (x: ResidueDatum) => string;\n  element: NightingaleElement;\n}) => {\n  return baseG\n    .selectAll<SVGPathElement, ResidueDatum>(\"path.residue\")\n    .data((d) =>\n      d.fragments.map(\n        (loc) =>\n          ({\n            ...loc,\n            accession: d.accession,\n            feature: {\n              ...d.feature,\n              currentResidue: { ...loc, description: d.location.description },\n            } as InterProFeature,\n            location: d.location,\n            k: d.feature.k,\n            i: d.i,\n            j: d.j,\n          }) as ResidueDatum,\n      ),\n    )\n    .enter()\n    .append(\"path\")\n    .attr(\"class\", \"feature rectangle residue\")\n    .attr(\"d\", getResidueShape)\n    .attr(\"transform\", getResidueTransform)\n    .attr(\"fill\", getResidueFill)\n    .attr(\"stroke\", \"transparent\")\n    .call(bindEvents, element);\n};\n\nexport const refreshResiduePaths = ({\n  baseG,\n  expanded,\n  getResidueShape,\n  getResidueTransform,\n  getResidueFill,\n}: {\n  baseG: ResidueGroup;\n  expanded: boolean;\n  getResidueShape: (x: ResidueDatum) => string;\n  getResidueTransform: (x: ResidueDatum) => string;\n  getResidueFill: (x: ResidueDatum) => string;\n}) => {\n  const paths = baseG.selectAll<SVGPathElement, ResidueDatum>(\"path.residue\");\n  const numberOfSibillings = new Set(\n    paths\n      .data()\n      .map((f) => `${f.feature?.accession}-${f.location?.description}`),\n  ).size;\n  paths\n    .attr(\"d\", getResidueShape)\n    .attr(\"transform\", getResidueTransform)\n    .style(\"pointer-events\", (f) =>\n      expanded || (f.feature && f.feature.expanded) ? \"auto\" : \"none\",\n    )\n    .style(\"stroke\", () => (expanded ? null : \"none\"))\n    .style(\"opacity\", () =>\n      expanded ? null : MAX_OPACITY_WHILE_COLAPSED / numberOfSibillings,\n    )\n    .attr(\"fill\", getResidueFill);\n};\n","import { customElement, property } from \"lit/decorators.js\";\nimport { Selection, select } from \"d3\";\nimport _get from \"lodash-es/get\";\nimport { Feature } from \"@nightingale-elements/nightingale-track\";\n\nimport {\n  bindEvents,\n  contrastingColor,\n} from \"@nightingale-elements/nightingale-new-core\";\nimport NightingaleTrack from \"@nightingale-elements/nightingale-track\";\nimport InterproEntryLayout, { InterProFeature } from \"./InterproEntryLayout\";\nimport { getCoverage, Segment } from \"./coverage\";\nimport {\n  ResidueGroup,\n  ResidueDatum,\n  createResidueGroup,\n  createResiduePaths,\n  refreshResiduePaths,\n} from \"./residues\";\nimport { createCoverage, refreshCoverage } from \"./coverage/render\";\n\nexport type BaseGroup = Selection<\n  SVGGElement,\n  InterProFeature,\n  HTMLElement | SVGElement | null,\n  unknown\n>;\nexport type LabelGroup = Selection<\n  SVGTextContentElement,\n  InterProFeature,\n  HTMLElement | SVGElement | null,\n  unknown\n>;\n\nconst MAX_OPACITY_WHILE_COLAPSED = 0.8;\n\nconst colorCache: Record<string, number[] | null> = {};\n\nfunction colorKeywordToRGB(colorKeyword: string) {\n  if (colorCache[colorKeyword]) return colorCache[colorKeyword];\n\n  const el = document.createElement(\"div\");\n  el.style.color = colorKeyword;\n  document.body.appendChild(el);\n  const rgbValue = window.getComputedStyle(el).color;\n  document.body.removeChild(el);\n  const res = rgbValue?.match(/[.\\d]+/g)?.map(Number) || null;\n  colorCache[colorKeyword] = res;\n  return res;\n}\n\n@customElement(\"nightingale-interpro-track\")\nclass NightingaleInterproTrack extends NightingaleTrack {\n  @property({ type: Boolean, reflect: true })\n  samesize?: boolean = false;\n  @property({ type: Boolean })\n  expanded?: boolean = false;\n  @property({ type: String })\n  label?: string | null = null;\n  @property({ type: Boolean })\n  \"show-label\"?: boolean = false;\n\n  layout = undefined;\n  protected layoutObj?: InterproEntryLayout;\n  #contributors?: InterProFeature[];\n  #coverage?: Segment[];\n  #haveCreatedFeatures = false;\n\n  #childrenG?: Selection<\n    SVGGElement,\n    unknown,\n    HTMLElement | SVGElement | null,\n    unknown\n  >;\n  #featuresG?: BaseGroup;\n  #residuesG?: ResidueGroup;\n  #childResiduesG?: ResidueGroup;\n  accession?: string;\n\n  constructor() {\n    super();\n    this[\"margin-top\"] = 2;\n    this[\"margin-bottom\"] = 2;\n  }\n\n  protected createTrack() {\n    if (!this.layoutObj) return;\n    this.layoutObj.expanded = !!this.expanded;\n    this.#childrenG = undefined;\n    super.createTrack();\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.#haveCreatedFeatures = false;\n  }\n\n  attributeChangedCallback(\n    name: string,\n    oldValue: string | null,\n    newValue: string | null,\n  ): void {\n    super.attributeChangedCallback(name, oldValue, newValue);\n    if (name === \"expanded\" && oldValue !== newValue && this.#contributors) {\n      for (const c of this.#contributors) {\n        c.expanded = !oldValue;\n      }\n    }\n  }\n\n  set contributors(contributors: InterProFeature[]) {\n    this.#contributors = NightingaleInterproTrack.normalizeLocations(\n      contributors,\n    ) as InterProFeature[];\n    this.#coverage = getCoverage(this.#contributors, this.length);\n    if (this.data) this.createTrack();\n  }\n\n  getLayout() {\n    return new InterproEntryLayout({\n      samesize: this.samesize,\n      layoutHeight: this.height,\n      expanded: !!this.expanded,\n      padding: (this[\"margin-top\"] + this[\"margin-bottom\"]) / 2,\n    });\n  }\n\n  protected createFeatures() {\n    if (!this.seqG) return;\n    this.layoutObj?.init(this.data as InterProFeature[], this.#contributors);\n    // eslint-disable-next-line\n    this.data.forEach((d, i) => ((d as InterProFeature).k = i));\n    this.#featuresG = this.seqG\n      .selectAll<SVGGElement, InterProFeature>(\"g.feature-group\")\n      .data(this.data as InterProFeature[])\n      .enter()\n      .append(\"g\")\n      .attr(\"class\", \"feature-group\")\n      .attr(\"id\", (d) => `g_${d.accession}`);\n\n    const locations = this.#featuresG\n      .selectAll(\"g.location-group\")\n      .data((d) => d.locations?.map((loc) => ({ ...loc, feature: d })) || [])\n      .enter()\n      .append(\"g\")\n      .attr(\"class\", \"location-group\")\n      .style(\"cursor\", this.#contributors ? \"pointer\" : \"default\");\n\n    locations\n      .selectAll(\"line.cover\")\n      .data((d) => [\n        d.fragments.reduce(\n          (agg, v) => ({\n            start: Math.min(agg.start, v.start),\n            end: Math.max(agg.end, v.end),\n            feature: d.feature,\n          }),\n          { start: Infinity, end: -Infinity },\n        ),\n      ])\n      .enter()\n      .append(\"line\")\n      .attr(\"class\", \"cover\");\n\n    locations\n      .selectAll(\"path.feature\")\n      .data((d) =>\n        d.fragments.map((loc) => ({\n          ...loc,\n          feature: d.feature,\n          fragments: d.fragments,\n        })),\n      )\n      .enter()\n      .append(\"path\")\n      .attr(\"class\", (f) => `${this.getShape(f)} feature`)\n      .on(\"click.expanded\", () => {\n        if (this.expanded) this.removeAttribute(\"expanded\");\n        else this.setAttribute(\"expanded\", \"expanded\");\n      })\n      .call(bindEvents, this);\n\n    locations\n      .selectAll(\"text.feature-label\")\n      .data((d) =>\n        d.fragments.map((loc) => ({\n          ...loc,\n          feature: d.feature,\n          fragments: d.fragments,\n        })),\n      )\n      .enter()\n      .append(\"text\")\n      .attr(\"class\", \"feature-label\")\n      .attr(\"dominant-baseline\", \"middle\")\n      .attr(\"text-anchor\", \"middle\")\n      .style(\"cursor\", \"inherit\")\n      .style(\"pointer-events\", \"none\");\n\n    this.#residuesG = createResidueGroup(this.#featuresG);\n    createResiduePaths({\n      baseG: this.#residuesG,\n      getResidueShape: (d) => this.getResidueShape(d),\n      getResidueTransform: (d) => this.getResidueTransform(d),\n      getResidueFill: (d) => this.getResidueFill(d, !!this.expanded),\n      element: this,\n    });\n\n    if (this.#contributors) {\n      // eslint-disable-next-line\n      this.#contributors.forEach((d, i) => (d.k = i));\n      if (!this.#childrenG)\n        this.#childrenG = this.svg\n          ?.append(\"g\")\n          .attr(\"class\", \"children-features\");\n\n      const childrenGroup = this.#childrenG\n        ?.append(\"g\")\n        .attr(\"class\", \"children-group\");\n      const childGroup = childrenGroup\n        ?.selectAll(\"g.child-group\")\n        .data(this.#contributors)\n        .enter()\n        .append(\"g\")\n        .attr(\"class\", \"child-group\");\n      if (!childGroup) return;\n      const locationChildrenG = childGroup\n        .selectAll(\"g.child-location-group\")\n        .data((d) => {\n          // eslint-disable-next-line\n          d.expanded = this.expanded;\n          return (d.locations || []).map((loc) => ({ ...loc, feature: d }));\n        })\n        .enter()\n        .append(\"g\")\n        .attr(\"class\", (_, i) => `child-location-group clg-${i}`);\n\n      locationChildrenG\n        ?.selectAll(\"line.cover\")\n        .data((d) => [\n          d.fragments.reduce(\n            (agg, v) => ({\n              start: Math.min(agg.start, v.start),\n              end: Math.max(agg.end, v.end),\n              feature: d.feature,\n            }),\n            { start: Infinity, end: -Infinity },\n          ),\n        ])\n        .enter()\n        .append(\"line\")\n        .attr(\"class\", \"cover\");\n\n      locationChildrenG\n        ?.selectAll(\"path.child-fragment\")\n        .data((d) =>\n          d.fragments.map((fragment) => ({\n            ...fragment,\n            feature: d.feature,\n            fragments: d.fragments,\n          })),\n        )\n        .enter()\n        .append(\"path\")\n        .attr(\"class\", (f) => `${this.getShape(f)} child-fragment feature`)\n        .call(bindEvents, this)\n        .on(\"click.expanded\", (_event, f) => {\n          // eslint-disable-next-line\n          f.feature.expanded = !f.feature.expanded;\n          this.refresh();\n        });\n      locationChildrenG\n        .selectAll(\"text.child-label\")\n        .data((d) =>\n          d.fragments.map((fragment) => ({\n            ...fragment,\n            feature: d.feature,\n            fragments: d.fragments,\n          })),\n        )\n        .enter()\n        .append(\"text\")\n        .attr(\"class\", \"child-label\")\n        .attr(\"dominant-baseline\", \"middle\")\n        .attr(\"text-anchor\", \"middle\")\n        .style(\"cursor\", \"default\")\n        .style(\"pointer-events\", \"none\");\n\n      this.#childResiduesG = createResidueGroup(childGroup);\n      // this.child_residuesLoc =\n      createResiduePaths({\n        baseG: this.#childResiduesG,\n        getResidueShape: (d) => this.getResidueShape(d),\n        getResidueTransform: (d) => this.getResidueTransform(d),\n        getResidueFill: (d) => this.getResidueFill(d, !!d.feature?.expanded),\n        element: this,\n      });\n      if (this.#coverage?.length)\n        createCoverage({\n          element: this,\n          coverage: this.#coverage,\n        });\n    }\n    this.svg?.attr(\n      \"height\",\n      (this.layoutObj?.maxYPos || 0) + this[\"margin-bottom\"],\n    );\n    this.#haveCreatedFeatures = true;\n  }\n  private getResidueShape(f: ResidueDatum) {\n    return this.featureShape.getFeatureShape(\n      this.getSingleBaseWidth(),\n      this.layoutObj?.getFeatureHeight(`${f.accession}_${f.k}_${f.i}_${f.j}`) ||\n        0,\n      f.end && f.start ? f.end - f.start + 1 : 1,\n      \"rectangle\",\n    );\n  }\n  private getResidueTransform(f: ResidueDatum) {\n    return `translate(${this.getXFromSeqPosition(f.start || 1)},${\n      this[\"margin-top\"] +\n      (this.layoutObj?.getFeatureYPos(`${f.accession}_${f.k}_${f.i}_${f.j}`) ||\n        0)\n    })`;\n  }\n  private getResidueFill(f: ResidueDatum, expanded: boolean) {\n    return expanded ? this.getFeatureColor(f) : \"white\";\n  }\n\n  private getTextLabel(datum: Feature) {\n    if (this.label?.length) {\n      if (this.label.startsWith(\".\")) {\n        return _get(datum, this.label.slice(1), null);\n      }\n      return this.label;\n    }\n    return datum?.feature?.accession || null;\n  }\n\n  private refreshLabels(base: LabelGroup, padding = 2) {\n    base\n      .attr(\"x\", (f) => {\n        const start = getVisibleStart(this[\"display-start\"], f.start);\n        const end = getVisibleEnd(this[\"display-end\"], f.end, this.length);\n        return this.getXFromSeqPosition(start + (end - start) / 2 || 1);\n      })\n      .attr(\n        \"y\",\n        (f) =>\n          this[\"margin-top\"] +\n          (this.layoutObj?.getFeatureYPos(f.feature as Feature) || 0) +\n          (this.layoutObj?.getFeatureHeight(f.feature as Feature) || 0) / 2,\n      )\n      .attr(\"fill\", (f, i, nodes) => {\n        const element = nodes[i];\n        const firstPath = element.parentElement?.querySelector(\"path.feature\");\n\n        if (firstPath) {\n          return contrastingColor(\n            colorKeywordToRGB(this.getFeatureFillColor(f)),\n          );\n        }\n        return null;\n      })\n      .attr(\n        \"font-size\",\n        (f) =>\n          (this.layoutObj?.getFeatureHeight(f.feature as Feature) || 2) -\n          padding,\n      )\n      .text((d) => (this[\"show-label\"] ? this.getTextLabel(d) : null))\n      .each(\n        wrap(\n          this[\"display-start\"],\n          this[\"display-end\"],\n          this[\"length\"],\n          (n) => this.getXFromSeqPosition(n),\n          (feature) => this.layoutObj?.getFeatureHeight(feature) || 0,\n        ),\n      );\n  }\n  private refreshFeatures(base: BaseGroup, expanded = true) {\n    const numberOfSibillings = new Set(\n      base.data().map((f) => f.feature?.accession),\n    ).size;\n    base\n      .attr(\"d\", (f) =>\n        this.featureShape.getFeatureShape(\n          this.getSingleBaseWidth(),\n          this.layoutObj?.getFeatureHeight(f.feature || \"\") || 0,\n          f.end && f.start ? f.end - f.start + 1 : 1,\n          expanded\n            ? this.getShape(f.shape ? f : (f.feature as Feature))\n            : \"rectangle\",\n        ),\n      )\n      .style(\"fill\", (f) =>\n        expanded ? this.getFeatureColor(f.feature as Feature) : \"white\",\n      )\n      .attr(\n        \"opacity\",\n        expanded ? 1 : MAX_OPACITY_WHILE_COLAPSED / numberOfSibillings,\n      )\n      .style(\"stroke\", (f) =>\n        expanded ? this.getFeatureColor(f.feature as Feature) : \"none\",\n      )\n      .attr(\n        \"transform\",\n        (f) =>\n          `translate(${this.getXFromSeqPosition(f.start || 1)},${\n            this[\"margin-top\"] +\n            (this.layoutObj?.getFeatureYPos(f.feature as Feature) || 0)\n          })`,\n      )\n      .style(\"pointer-events\", expanded ? \"auto\" : \"none\");\n  }\n\n  private refreshCoverLine(base: BaseGroup, expanded = true) {\n    base\n      .attr(\"x1\", (f) => this.getXFromSeqPosition(f.start || 1))\n      .attr(\"x2\", (f) => this.getXFromSeqPosition((f.end || 0) + 1))\n      .attr(\n        \"y1\",\n        (f) =>\n          this[\"margin-top\"] +\n          (this.layoutObj?.getFeatureYPos(f.feature as Feature) || 0) +\n          (this.layoutObj?.getFeatureHeight(f.feature as Feature) || 0) / 2,\n      )\n      .attr(\n        \"y2\",\n        (f) =>\n          this[\"margin-top\"] +\n          (this.layoutObj?.getFeatureYPos(f.feature as Feature) || 0) +\n          (this.layoutObj?.getFeatureHeight(f.feature as Feature) || 0) / 2,\n      )\n      .attr(\"stroke\", (f) => this.getFeatureColor(f.feature as Feature))\n      .attr(\"visibility\", expanded ? \"visible\" : \"hidden\");\n  }\n\n  refresh() {\n    if (this.#haveCreatedFeatures && this.layoutObj) {\n      this.layoutObj.expanded = !!this.expanded;\n      this.layoutObj.init(this.data as InterProFeature[], this.#contributors);\n      this.height = this.layoutObj.maxYPos;\n\n      this.refreshCoverLine(\n        this.#featuresG?.selectAll(\"g.location-group line.cover\") as BaseGroup,\n      );\n      this.refreshFeatures(\n        this.#featuresG?.selectAll(\n          \"g.location-group path.feature\",\n        ) as BaseGroup,\n      );\n      this.refreshLabels(\n        this.#featuresG?.selectAll(\n          \"g.location-group text.feature-label\",\n        ) as LabelGroup,\n      );\n\n      // this.#residuesG?.attr(\"visibility\", this.expanded ? \"visible\" : \"hidden\");\n      if (this.#residuesG)\n        refreshResiduePaths({\n          baseG: this.#residuesG,\n          expanded: !!this.expanded,\n          getResidueShape: (d) => this.getResidueShape(d),\n          getResidueTransform: (d) => this.getResidueTransform(d),\n          getResidueFill: (d) => this.getResidueFill(d, !!this.expanded),\n        });\n\n      if (this.#contributors) {\n        const childrenGroup = this.#childrenG?.select(\"g.children-group\");\n        childrenGroup?.attr(\"visibility\", this.expanded ? \"visible\" : \"hidden\");\n        const childGroup = childrenGroup?.selectAll(\"g.child-group\");\n        const locationChildrenG = childGroup?.selectAll(\n          \"g.child-location-group\",\n        );\n        const coverLinesChildren = locationChildrenG?.selectAll(\"line.cover\");\n        const featureChildren = locationChildrenG?.selectAll(\n          \"path.child-fragment\",\n        );\n\n        this.refreshCoverLine(\n          coverLinesChildren as unknown as BaseGroup,\n          this.expanded,\n        );\n        this.refreshFeatures(\n          featureChildren as unknown as BaseGroup,\n          this.expanded,\n        );\n        this.refreshLabels(\n          childGroup?.selectAll(\n            \"g.child-location-group text.child-label\",\n          ) as LabelGroup,\n          0,\n        );\n\n        this.#childResiduesG?.attr(\"visibility\", () =>\n          this.expanded ? \"visible\" : \"hidden\",\n        );\n        if (this.#childResiduesG)\n          refreshResiduePaths({\n            baseG: this.#childResiduesG,\n            expanded: !!this.expanded,\n            getResidueShape: (d) => this.getResidueShape(d),\n            getResidueTransform: (d) => this.getResidueTransform(d),\n            getResidueFill: (d) =>\n              this.getResidueFill(d, !!d.feature?.expanded),\n          });\n\n        if (this.#coverage?.length)\n          refreshCoverage({\n            element: this,\n            featuresG: this.#featuresG,\n            contributorsLength: this.#contributors?.length,\n          });\n      }\n      this.svg?.attr(\"height\", this.layoutObj.maxYPos + this[\"margin-bottom\"]);\n\n      this.updateHighlight();\n\n      this.renderMarginOnGroup(this.margins);\n    }\n  }\n}\nfunction wrap(\n  displayStart: number | undefined,\n  displayEnd: number | undefined,\n  length: number | undefined,\n  getXFromSeqPosition: (x: number) => number,\n  getFeatureHeight: (feature: Feature) => number,\n) {\n  function wrapFn(this: SVGTextContentElement, feature: InterProFeature) {\n    const self = select(this);\n    const start = getVisibleStart(displayStart, feature.start);\n    const end = getVisibleEnd(displayEnd, feature.end, length);\n    const width = getXFromSeqPosition(end) - getXFromSeqPosition(start);\n    const padding = getFeatureHeight(feature.feature as Feature) / 2;\n    let textLength = self.node()?.getComputedTextLength?.() || 0;\n    let text = self.text();\n    while (textLength > width - 2 * padding && text.length > 0) {\n      text = text.slice(0, -1);\n      self.text(text.length ? text + \"\\u2026\" : \"\");\n      textLength = self.node()?.getComputedTextLength() || 0;\n    }\n  }\n  return wrapFn;\n}\n\nfunction getVisibleStart(\n  displayStart: number | undefined,\n  featureStart: number | undefined,\n) {\n  const dStart = displayStart && displayStart > 0 ? displayStart : 0;\n  return Math.max(featureStart || 0, dStart);\n}\nfunction getVisibleEnd(\n  displayEnd: number | undefined,\n  featureEnd: number | undefined,\n  length: number | undefined,\n) {\n  const dEnd = displayEnd && displayEnd > 0 ? displayEnd : length || 0;\n  return Math.min(featureEnd || 0, dEnd);\n}\nexport default NightingaleInterproTrack;\n","import { Segment } from \".\";\nimport NightingaleInterproTrack, {\n  BaseGroup,\n} from \"../nightingale-interpro-track\";\n\nconst MIN_OPACITY_WHILE_COLAPSED = 0.3;\n\nconst cheapScale = (x: number) =>\n  (x + MIN_OPACITY_WHILE_COLAPSED) / (1 + MIN_OPACITY_WHILE_COLAPSED);\n\nexport const createCoverage = ({\n  element,\n  coverage,\n}: {\n  element: NightingaleInterproTrack;\n  coverage: Segment[];\n}) => {\n  element.accession = element?.data?.[0]?.accession || \"_\";\n\n  let mask = element.svg?.select<SVGMaskElement>(\"defs mask\");\n\n  if (!mask?.size())\n    mask = element.svg\n      ?.append(\"defs\")\n      .append(\"mask\")\n      .attr(\"id\", `mask-${element.accession}`);\n\n  mask\n    ?.selectAll(\"rect\")\n    .data(coverage)\n    .enter()\n    .append(\"rect\")\n    .attr(\"y\", 0)\n    .attr(\"height\", element.height);\n};\n\nexport const refreshCoverage = ({\n  element,\n  featuresG,\n  contributorsLength,\n}: {\n  element: NightingaleInterproTrack;\n  featuresG?: BaseGroup;\n  contributorsLength: number;\n}) => {\n  featuresG?.attr(\n    \"mask\",\n    element.expanded ? null : `url(#mask-${element.accession})`,\n  );\n  element.svg\n    ?.selectAll<SVGRectElement, Segment>(\"defs mask rect\")\n    .attr(\"x\", (f) => element.getXFromSeqPosition(f.start))\n    .attr(\"width\", (f) => element.getSingleBaseWidth() * (f.end - f.start + 1))\n    .attr(\"height\", element.height)\n    .attr(\"fill\", \"white\")\n    .attr(\"opacity\", (f) => {\n      return cheapScale((f.value || 0) / (contributorsLength || 1));\n    });\n};\n","import NightingaleInterproTrack from \"./nightingale-interpro-track\";\nexport type { BaseGroup, LabelGroup } from \"./nightingale-interpro-track\";\n\nexport default NightingaleInterproTrack;\n","import { property } from \"lit/decorators.js\";\nimport NightingaleBaseElement, {\n  Constructor,\n} from \"../../nightingale-base-element\";\n\nexport declare class WithDimensionsInterface {\n  width: number;\n  height: number;\n}\n\nconst withDimensions = <T extends Constructor<NightingaleBaseElement>>(\n  superClass: T,\n  options?: {\n    width?: number;\n    height?: number;\n  },\n) => {\n  class WithDimensions extends superClass {\n    // TODO: Making the width reflective makes the withResizable not responsive\n    @property({ type: Number })\n    width?: number = options?.width;\n    @property({ type: Number, reflect: true })\n    height?: number = options?.height;\n  }\n  return WithDimensions as Constructor<WithDimensionsInterface> & T;\n};\n\nexport default withDimensions;\n","import NightingaleBaseElement, {\n  Constructor,\n} from \"../../nightingale-base-element\";\nimport { property } from \"lit/decorators.js\";\n\nexport interface withPositionInterface extends NightingaleBaseElement {\n  \"display-start\"?: number;\n  \"display-end\"?: number;\n  length?: number;\n}\nexport const WHOLE_SEQ = -1;\nconst defaultOptions = {\n  \"display-start\": 1,\n  \"display-end\": WHOLE_SEQ,\n  length: 0,\n};\nconst withPosition = <T extends Constructor<NightingaleBaseElement>>(\n  superClass: T,\n  options: {\n    \"display-start\"?: number;\n    \"display-end\"?: number;\n    length?: number;\n  } = {},\n) => {\n  class WithPosition extends superClass {\n    #intitialOptions = { ...defaultOptions, ...options };\n    #length: number = this.#intitialOptions.length;\n    @property({ type: Number, reflect: true })\n    get length() {\n      return this.#length;\n    }\n    set length(value: number) {\n      this.#length = value;\n      if ((this[\"display-end\"] || 0) > this.#length)\n        this[\"display-end\"] = this.length;\n    }\n\n    @property({ type: Number, reflect: true })\n    \"display-start\"?: number = this.#intitialOptions[\"display-start\"];\n    @property({ type: Number, reflect: true })\n    \"display-end\"?: number = this.#intitialOptions[\"display-end\"];\n  }\n  return WithPosition as Constructor<withPositionInterface> & T;\n};\n\nexport default withPosition;\n","import NightingaleBaseElement, {\n  Constructor,\n} from \"../../nightingale-base-element\";\nimport { property } from \"lit/decorators.js\";\nimport { Selection } from \"d3\";\n\nimport withDimensions, { WithDimensionsInterface } from \"../withDimensions\";\n\nconst DEFAULT_MARGIN_COLOR = \"#FFFFFFDD\";\nexport interface withMarginInterface\n  extends NightingaleBaseElement,\n    WithDimensionsInterface {\n  \"margin-top\": number;\n  \"margin-bottom\": number;\n  \"margin-left\": number;\n  \"margin-right\": number;\n  \"margin-color\": string;\n  getWidthWithMargins: () => number;\n  getHeightWithMargins: () => number;\n  renderMarginOnGroup: (\n    g?: Selection<\n      SVGGElement,\n      unknown,\n      HTMLElement | SVGElement | null,\n      unknown\n    >\n  ) => void;\n}\n\nconst defaultOptions = {\n  \"margin-top\": 0,\n  \"margin-bottom\": 0,\n  \"margin-left\": 10,\n  \"margin-right\": 10,\n  \"margin-color\": DEFAULT_MARGIN_COLOR,\n};\nconst withMargin = <T extends Constructor<NightingaleBaseElement>>(\n  superClass: T,\n  options: {\n    \"margin-top\"?: number;\n    \"margin-bottom\"?: number;\n    \"margin-left\"?: number;\n    \"margin-right\"?: number;\n    \"margin-color\"?: string | null;\n  } = {}\n) => {\n  class WithMargin extends withDimensions(superClass) {\n    #intitialOptions = { ...defaultOptions, ...options };\n    @property({ type: Number })\n    \"margin-top\": number = this.#intitialOptions[\"margin-top\"];\n    @property({ type: Number })\n    \"margin-bottom\": number = this.#intitialOptions[\"margin-bottom\"];\n    @property({ type: Number })\n    \"margin-left\": number = this.#intitialOptions[\"margin-left\"];\n    @property({ type: Number })\n    \"margin-right\": number = this.#intitialOptions[\"margin-right\"];\n    @property({ type: String })\n    \"margin-color\" = this.#intitialOptions[\"margin-color\"];\n\n    #created = false;\n\n    getWidthWithMargins() {\n      return this.width\n        ? this.width - this[\"margin-left\"] - this[\"margin-right\"]\n        : 0;\n    }\n    getHeightWithMargins() {\n      return this.height\n        ? this.height - this[\"margin-top\"] - this[\"margin-bottom\"]\n        : 0;\n    }\n    renderMarginOnGroup(\n      g?: Selection<\n        SVGGElement,\n        unknown,\n        HTMLElement | SVGElement | null,\n        unknown\n      >\n    ) {\n      if (!g) return;\n\n      if (!this.#created || g.select(\"rect\").empty()) {\n        g.append(\"rect\")\n          .style(\"pointer-events\", \"none\")\n          .attr(\"class\", \"margin-left\")\n          .attr(\"x\", 0);\n        g.append(\"rect\")\n          .style(\"pointer-events\", \"none\")\n          .attr(\"class\", \"margin-right\");\n        g.append(\"rect\")\n          .style(\"pointer-events\", \"none\")\n          .attr(\"class\", \"margin-top\")\n          .attr(\"width\", this.width)\n          .attr(\"x\", 0)\n          .attr(\"y\", 0);\n        g.append(\"rect\")\n          .style(\"pointer-events\", \"none\")\n          .attr(\"class\", \"margin-bottom\")\n          .attr(\"width\", this.width)\n          .attr(\"x\", 0);\n\n        this.#created = true;\n      }\n\n      g.select(\"rect.margin-left\")\n        .attr(\"fill\", this[\"margin-color\"] || DEFAULT_MARGIN_COLOR)\n        .attr(\"height\", this.height)\n        .attr(\"width\", this[\"margin-left\"]);\n      g.select(\"rect.margin-right\")\n        .attr(\"fill\", this[\"margin-color\"] || DEFAULT_MARGIN_COLOR)\n        .attr(\"height\", this.height)\n        .attr(\"x\", this.width - this[\"margin-right\"])\n        .attr(\"width\", this[\"margin-right\"]);\n      g.select(\"rect.margin-top\")\n        .attr(\"fill\", this[\"margin-color\"] || DEFAULT_MARGIN_COLOR)\n        .attr(\"height\", this[\"margin-top\"]);\n      g.select(\"rect.margin-bottom\")\n        .attr(\"fill\", this[\"margin-color\"] || DEFAULT_MARGIN_COLOR)\n        .attr(\"y\", this.height - this[\"margin-bottom\"])\n        .attr(\"height\", this[\"margin-bottom\"]);\n    }\n  }\n  return WithMargin as Constructor<withMarginInterface> & T;\n};\n\nexport default withMargin;\n","import { property } from \"lit/decorators.js\";\nimport NightingaleBaseElement, {\n  Constructor,\n} from \"../../nightingale-base-element\";\nimport withDimensions, { WithDimensionsInterface } from \"../withDimensions\";\n\nconst DEFAULT_MIN_HEIGHT = 10;\nconst DEFAULT_MIN_WIDTH = 10;\n\nexport interface WithResizableInterface extends WithDimensionsInterface {\n  \"min-width\": number;\n  \"min-height\": number;\n  onDimensionsChange(): void;\n}\nconst defaultOptions = {\n  \"min-width\": DEFAULT_MIN_WIDTH,\n  \"min-height\": DEFAULT_MIN_HEIGHT,\n};\nconst withResizable = <T extends Constructor<NightingaleBaseElement>>(\n  superClass: T,\n  options: {\n    \"min-width\"?: number;\n    \"min-height\"?: number;\n  } = {}\n) => {\n  class WithResizable extends withDimensions(superClass) {\n    #intitialOptions = { ...defaultOptions, ...options };\n    #observer?: ResizeObserver;\n    @property({ type: Number, reflect: true })\n    \"min-width\": number = this.#intitialOptions[\"min-width\"];\n    @property({ type: Number, reflect: true })\n    \"min-height\": number = this.#intitialOptions[\"min-height\"];\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    constructor(...rest: any[]) {\n      super(...rest);\n      this.onResize = this.onResize.bind(this);\n      this.listenForResize = this.listenForResize.bind(this);\n    }\n\n    private useAvailableWidth() {\n      //Only change this.width if the value in width hasn't been set via its attribute\n      if (this.getAttribute(\"width\") === null) {\n        this.style.width = \"100%\";\n        this.width = Math.max(this.offsetWidth, this[\"min-width\"]);\n      }\n    }\n    private useAvailableHeight() {\n      //Only change this.height if the value in height hasn't been set via its attribute\n      if (this.getAttribute(\"height\") === null) {\n        this.style.height = \"100%\";\n        this.height = Math.max(this.offsetHeight, this[\"min-height\"]);\n      }\n    }\n    onDimensionsChange() {}\n\n    connectedCallback() {\n      this.useAvailableWidth();\n      this.useAvailableHeight();\n      this.listenForResize();\n      super.connectedCallback();\n    }\n    disconnectedCallback() {\n      if (this.#observer) {\n        this.#observer.unobserve(this);\n      }\n      super.disconnectedCallback();\n    }\n\n    private onResize() {\n      const w = this.width;\n      const h = this.height;\n      this.useAvailableWidth();\n      this.useAvailableHeight();\n      if (w !== this.width || h !== this.height) {\n        this.onDimensionsChange();\n      }\n    }\n\n    private listenForResize() {\n      this.#observer = new ResizeObserver(this.onResize);\n      this.#observer.observe(this);\n    }\n  }\n  return WithResizable as Constructor<WithResizableInterface> & T;\n};\n\nexport default withResizable;\n","import NightingaleBaseElement, {\n  Constructor,\n} from \"../../nightingale-base-element\";\n\nconst withManager = <T extends Constructor<NightingaleBaseElement>>(\n  superClass: T,\n) => {\n  class WithManager extends superClass {\n    manager?: HTMLElement | null;\n\n    connectedCallback() {\n      if (this.closest(\"nightingale-manager\")) {\n        customElements.whenDefined(\"nightingale-manager\").then(() => {\n          this.manager = this.closest(\"nightingale-manager\");\n          if (this.manager) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            (this.manager as any).register(this);\n          }\n        });\n      }\n      super.connectedCallback();\n    }\n\n    disconnectedCallback() {\n      if (this.manager) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (this.manager as any).unregister(this);\n      }\n      super.disconnectedCallback();\n    }\n  }\n  return WithManager as T;\n};\n\nexport default withManager;\n","export type SegmentType = { start: number; end: number };\nexport default class Region {\n  segments: SegmentType[];\n  max: number;\n  min: number;\n  regionString: string | null;\n\n  constructor({ min = -Infinity, max = Infinity } = {}) {\n    this.segments = [];\n    this.max = max;\n    this.min = min;\n    this.regionString = null;\n  }\n\n  encode(full = false) {\n    return this.segments\n      .map(({ start, end }) => {\n        if (full) return `${start}:${end}`;\n        const s = start === this.min ? \"\" : start;\n        const e = end === this.max ? \"\" : end;\n        return `${s}:${e}`;\n      })\n      .join(\",\");\n  }\n\n  decode(regionString: string | null) {\n    if (typeof regionString !== \"undefined\") this.regionString = regionString;\n    if (!this.regionString) {\n      this.segments = [];\n      return;\n    }\n    this.segments = this.regionString.split(\",\").map((region) => {\n      const [_start, _end, _] = region.split(\":\");\n      if (typeof _ !== \"undefined\")\n        throw new Error(\n          `there should be at most 1 ':' per region. Region: ${region}`,\n        );\n      let start = _start ? Number(_start) : this.min;\n      let end = _end ? Number(_end) : this.max;\n      if (start > end) [start, end] = [end, start];\n      if (start < this.min) start = this.min;\n      if (end > this.max) end = this.max;\n      if (Number.isNaN(start))\n        throw new Error(\n          `The parsed value of ${_start} is NaN. Region: ${region}`,\n        );\n      if (Number.isNaN(end))\n        throw new Error(\n          `The parsed value of ${_end} is NaN. Region: ${region}`,\n        );\n      return {\n        start,\n        end,\n      };\n    });\n  }\n}\n","import { property } from \"lit/decorators.js\";\nimport NightingaleBaseElement, {\n  Constructor,\n} from \"../../nightingale-base-element\";\nimport Region from \"../../utils/Region\";\n\nconst combineRegions = (region1: string, region2: string): string => {\n  if (!region1) return region2;\n  if (!region2) return region1;\n  return `${region1},${region2}`;\n};\n\nexport declare class WithHighlightInterface {\n  highlight: string;\n  \"highlight-color\": string;\n  highlightedRegion: Region;\n}\nexport const DEFAULT_HIGHLIGHT_COLOR = \"#FFEB3B66\";\n\nconst defaultOptions = {\n  highlight: null,\n  \"highlight-color\": DEFAULT_HIGHLIGHT_COLOR,\n};\nconst withHighlight = <T extends Constructor<NightingaleBaseElement>>(\n  superClass: T,\n  options: {\n    highlight?: string | null;\n    \"highlight-color\"?: string | null;\n  } = {},\n) => {\n  class WithHighlight extends superClass {\n    #initialOptions = { ...defaultOptions, ...options };\n    @property({ type: String, reflect: true })\n    highlight = this.#initialOptions.highlight;\n    @property({ type: String, reflect: true })\n    \"highlight-color\" = this.#initialOptions[\"highlight-color\"];\n\n    highlightedRegion: Region;\n    #fixedHighlight: string | null;\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    constructor(...args: any[]) {\n      super(...args);\n      this.highlightedRegion = new Region({ min: 1 });\n      this.#fixedHighlight = null;\n    }\n    set fixedHighlight(value: string | null) {\n      this.#fixedHighlight = value;\n      this.highlightedRegion.decode(\n        combineRegions(this.highlight || \"\", this.#fixedHighlight || \"\"),\n      );\n      this.updateHighlight();\n    }\n    attributeChangedCallback(\n      name: string,\n      oldValue: string | null,\n      newValue: string | null,\n    ): void {\n      super.attributeChangedCallback(name, oldValue, newValue);\n      if (newValue === \"null\") newValue = null;\n      if (oldValue !== newValue) {\n        if (name === \"length\") {\n          this.highlightedRegion.max = Number(newValue);\n        }\n        if (name === \"highlight\") {\n          this.highlightedRegion.decode(\n            combineRegions(newValue || \"\", this.#fixedHighlight || \"\"),\n          );\n        }\n      }\n    }\n    protected updateHighlight() {\n      return;\n    }\n  }\n  return WithHighlight as Constructor<WithHighlightInterface> & T;\n};\n\nexport default withHighlight;\n","import { property } from \"lit/decorators.js\";\nimport {\n  scaleLinear,\n  zoom as d3zoom,\n  zoomIdentity,\n  ScaleLinear,\n  ZoomBehavior,\n  D3ZoomEvent,\n  Selection,\n} from \"d3\";\n\nimport NightingaleBaseElement, {\n  Constructor,\n} from \"../../nightingale-base-element\";\nimport withDimensions, { WithDimensionsInterface } from \"../withDimensions\";\nimport withPosition, { withPositionInterface } from \"../withPosition\";\nimport withMargin, { withMarginInterface } from \"../withMargin\";\nimport withResizable, { WithResizableInterface } from \"../withResizable\";\n\nexport interface WithZoomInterface\n  extends WithDimensionsInterface,\n    withPositionInterface,\n    withMarginInterface,\n    WithResizableInterface {\n  xScale?: ScaleLinear<number, number>;\n  svg?: Selection<\n    SVGSVGElement,\n    unknown,\n    HTMLElement | SVGElement | null,\n    unknown\n  >;\n  updateScaleDomain(): void;\n  getSingleBaseWidth(): number;\n  getXFromSeqPosition(position: number): number;\n  applyZoomTranslation(): void;\n}\nconst ATTRIBUTES_THAT_TRIGGER_REFRESH = [\"length\", \"width\", \"height\"];\n\nconst withZoom = <T extends Constructor<NightingaleBaseElement>>(\n  superClass: T\n) => {\n  class WithZoom extends withMargin(\n    withPosition(withResizable(withDimensions(superClass)))\n  ) {\n    _applyZoomTranslation: () => void;\n    /**\n     * Base scale without any transformations, only updated in `updateScaleDomain`\n     */\n    private originXScale?: ScaleLinear<number, number>;\n    /**\n     * Temporary scale. It contains the transformations caused by zoom events, but not yet reflected in `display-start` and `display-end`.\n     */\n    private tmpXScale?: ScaleLinear<number, number>;\n    /**\n     * Current scale, the one used to calculate any positions. Calculated based on `display-start` and `display-end`.\n     */\n    xScale?: ScaleLinear<number, number>;\n    _zoom?: ZoomBehavior<HTMLElement, unknown>;\n    _svg?: Selection<HTMLElement, unknown, HTMLElement, unknown>;\n    dontDispatch?: boolean;\n\n    @property({ type: Boolean })\n    \"use-ctrl-to-zoom\" = false;\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    constructor(...args: any[]) {\n      super(...args);\n\n      this.updateScaleDomain = this.updateScaleDomain.bind(this);\n      this._initZoom = this._initZoom.bind(this);\n      this.zoomed = this.zoomed.bind(this);\n      this._applyZoomTranslation = this.applyZoomTranslation.bind(this);\n      let aboutToApply = false;\n      // Postponing the zoom translation to the next frame.\n      // This helps in case several attributes are changed almost at the same time,\n      // in this way, only one refresh will be called.\n      this.applyZoomTranslation = () => {\n        if (aboutToApply) return;\n        aboutToApply = true;\n        requestAnimationFrame(() => {\n          aboutToApply = false;\n          this._applyZoomTranslation();\n        });\n      };\n      // this.scrollFilter = new ScrollFilter(this);\n      // this.wheelListener = (event) => this.scrollFilter.wheel(event);\n    }\n\n    connectedCallback() {\n      this.updateScaleDomain();\n      this._initZoom();\n      // if (this.hasAttribute(\"filter-scroll\")) {\n      //   document.addEventListener(\"wheel\", this.wheelListener, { capture: true });\n      // }\n      super.connectedCallback();\n      this.onDimensionsChange();\n    }\n\n    disconnectedCallback() {\n      // document.removeEventListener(\"wheel\", this.wheelListener);\n      super.disconnectedCallback();\n    }\n\n    get zoom() {\n      return this._zoom;\n    }\n\n    set svg(svg) {\n      if (!svg || !this._zoom) return;\n      this._svg = svg;\n      svg.call(this._zoom).on(\"dblclick.zoom\", null);\n      this.applyZoomTranslation();\n    }\n\n    get svg() {\n      return this._svg;\n    }\n\n    updateScaleDomain() {\n      this.xScale = scaleLinear()\n        // The max width should match the start of the n+1 base\n        .domain([1, (this.length || 0) + 1])\n        .range([0, this.getWidthWithMargins()]);\n      this.originXScale = this.xScale?.copy();\n      this.tmpXScale = this.xScale?.copy();\n      this.zoom?.translateExtent([\n        [0, 0],\n        [this.getWidthWithMargins(), 0],\n      ]);\n    }\n\n    _initZoom() {\n      this._zoom = d3zoom<HTMLElement, unknown>()\n        .scaleExtent([1, Infinity])\n        .translateExtent([\n          [0, 0],\n          [this.getWidthWithMargins(), 0],\n        ])\n        .extent([\n          [0, 0],\n          [this.getWidthWithMargins(), 0],\n        ])\n        .filter((event) => {\n          if (event?.type === \"wheel\") {\n            return !this[\"use-ctrl-to-zoom\"] || event.ctrlKey;\n          }\n          return true;\n          // TODO: deal with event filters\n          //   if (this.hasAttribute(\"scroll-filter\")) {\n          //     const scrollableAttribute = this.getAttribute(\"scrollable\");\n          //     if (scrollableAttribute) return scrollableAttribute === \"true\";\n          //   }\n        })\n        .on(\"zoom\", this.zoomed);\n    }\n\n    attributeChangedCallback(\n      name: string,\n      oldValue: string | null,\n      newValue: string | null\n    ): void {\n      super.attributeChangedCallback(name, oldValue, newValue);\n\n      const newV = newValue === \"null\" ? null : newValue;\n      if (oldValue !== newV) {\n        if (ATTRIBUTES_THAT_TRIGGER_REFRESH.includes(name)) {\n          this.updateScaleDomain();\n        }\n        // One of the observable attributes changed, so the scale needs to be redefined.\n        this.applyZoomTranslation();\n      }\n    }\n\n    zoomed(d3Event: D3ZoomEvent<SVGSVGElement, unknown>) {\n      // Redefines the xScale using the original scale and transform it with the captured event data.\n      if (this.originXScale)\n        this.tmpXScale = d3Event.transform.rescaleX(this.originXScale);\n\n      // New positions based in the updated scale\n      const [start, end] = this?.tmpXScale?.domain() || [0, 0];\n\n      if (this.tmpXScale) {\n        if (this.dontDispatch) {\n          this.xScale = this.tmpXScale;\n        } else {\n          this.dispatchEvent(\n            // Dispatches the event so the manager can propagate this changes to other  components\n            new CustomEvent(\"change\", {\n              detail: {\n                \"display-start\": Math.max(1, start),\n                \"display-end\": Math.min(\n                  this.length || 0,\n                  Math.max(end - 1, start + 1) // To make sure it never zooms in deeper than showing 2 bases covering the full width\n                ),\n              },\n              bubbles: true,\n              cancelable: true,\n            })\n          );\n        }\n      }\n    }\n\n    applyZoomTranslation() {\n      if (!this.svg || !this.originXScale) return;\n      // Calculating the scale factor based in the current start/end coordinates and the length of the sequence.\n      const k = Math.max(\n        1,\n        // +1 because the displayend base should be included\n        (this.length || 0) /\n          (1 + (this[\"display-end\"] || 0) - (this[\"display-start\"] || 0))\n      );\n      // The deltaX gets calculated using the position of the first base to display in original scale\n      const dx = -this.originXScale(this[\"display-start\"] || 0);\n      this.dontDispatch = true; // This is to avoid infinite loops\n      if (this.zoom) {\n        this.svg.call(\n          // We trigger a zoom action\n          this.zoom.transform,\n          zoomIdentity // Identity transformation\n            .scale(k) // Scaled by our scaled factor\n            .translate(dx, 0) // Translated by the delta\n        );\n      }\n      this.dontDispatch = false;\n      this.zoomRefreshed();\n    }\n    zoomRefreshed() {\n      super.render();\n    }\n\n    render() {\n      this.applyZoomTranslation();\n      return super.render();\n    }\n    public override onDimensionsChange() {\n      super.onDimensionsChange();\n      this.svg?.attr(\"width\", this.width);\n      this.svg?.attr(\"height\", this.height);\n      this.updateScaleDomain();\n      this.applyZoomTranslation();\n    }\n\n    getXFromSeqPosition(position: number) {\n      if (!this.xScale) return -1;\n      return this[\"margin-left\"] + this.xScale(position);\n    }\n\n    getSingleBaseWidth() {\n      if (!this.xScale) return -1;\n      return this.xScale(2) - this.xScale(1);\n    }\n  }\n  return WithZoom as Constructor<WithZoomInterface> & T;\n};\n\nexport default withZoom;\n","import { select, Selection } from \"d3\";\n\nimport NightingaleBaseElement, {\n  Constructor,\n} from \"../../../nightingale-base-element\";\n\nimport withHighlight, { WithHighlightInterface } from \"..\";\nimport withZoom, { WithZoomInterface } from \"../../withZoom\";\n\nexport interface WithSVGHighlightInterface\n  extends WithZoomInterface,\n    WithHighlightInterface {\n  createHighlightGroup: () => void;\n  updateHighlight: () => void;\n}\nconst withSVGHighlight = <T extends Constructor<NightingaleBaseElement>>(\n  superClass: T\n) => {\n  class WithSVGHighlight extends withZoom(withHighlight(superClass)) {\n    protected highlighted?: Selection<\n      SVGGElement,\n      unknown,\n      HTMLElement | SVGElement | null,\n      unknown\n    >;\n\n    createHighlightGroup() {\n      const svg = select(this as unknown as NightingaleBaseElement).selectAll<\n        SVGSVGElement,\n        unknown\n      >(\"svg\");\n\n      this.highlighted = svg.append(\"g\").attr(\"class\", \"highlighted\");\n    }\n    updateHighlight() {\n      if (!this.highlighted) return;\n      const highlighs = this.highlighted\n        .selectAll<\n          SVGRectElement,\n          {\n            start: number;\n            end: number;\n          }[]\n        >(\"rect\")\n        .data(this.highlightedRegion.segments);\n\n      highlighs\n        .enter()\n        .append(\"rect\")\n        .style(\"pointer-events\", \"none\")\n        .merge(highlighs)\n        .attr(\"fill\", this[\"highlight-color\"])\n        .attr(\"height\", this.height)\n        .attr(\"x\", (d) => this.getXFromSeqPosition(d.start))\n        .attr(\"width\", (d) =>\n          Math.max(0, this.getSingleBaseWidth() * (d.end - d.start + 1))\n        );\n\n      highlighs.exit().remove();\n    }\n  }\n  return WithSVGHighlight as Constructor<WithSVGHighlightInterface> & T;\n};\n\nexport default withSVGHighlight;\n","import NightingaleBaseElement from \"../nightingale-base-element\";\nimport { WithHighlightInterface } from \"../mixins/withHighlight\";\nimport { Selection, BaseType } from \"d3\";\n\nexport const HIGHLIGHT_EVENT = \"highlight-event\";\n\ntype EventType = \"click\" | \"mouseover\" | \"mouseout\" | \"reset\";\n\ntype FeatureData = {\n  feature?: FeatureData | null;\n  fragments?: Array<{\n    start: number;\n    end: number;\n  }>;\n  start?: number;\n  end?: number;\n  protvistaFeatureId: string;\n};\ntype SequenceBaseData = {\n  position: number;\n  aa: string;\n};\n\ntype detailInterface = {\n  eventType: EventType;\n  // coords: null | [number, number];\n  feature?: FeatureData | SequenceBaseData | null;\n  target?: HTMLElement;\n  highlight?: string;\n  selectedId?: string | null;\n  parentEvent?: Event;\n};\n\nexport function createEvent(\n  type: EventType,\n  feature: FeatureData | SequenceBaseData | null = null,\n  withHighlight = false,\n  withId = false,\n  start?: number,\n  end?: number,\n  target?: HTMLElement,\n  event?: Event,\n  element?: NightingaleBaseElement & WithHighlightInterface,\n): Event {\n  // Variation features have a different shape\n  if (feature) {\n    // eslint-disable-next-line no-param-reassign\n    feature = (feature as FeatureData)?.feature || feature;\n  }\n  const detail: detailInterface = {\n    eventType: type,\n    // TODO: add coordinates\n    // coords: WithNightingaleEvents._getClickCoords(),\n    feature,\n    target,\n    parentEvent: event,\n  };\n  if (withHighlight) {\n    if ((feature as FeatureData)?.fragments) {\n      detail.highlight = ((feature as FeatureData)?.fragments || [])\n        .map((fr) => `${fr.start}:${fr.end}`)\n        .join(\",\");\n    } else if ((event as KeyboardEvent)?.shiftKey && element?.highlight) {\n      // If holding shift, add to the highlights\n      detail.highlight = `${element.highlight},${start}:${end}`;\n    } else {\n      detail.highlight = start && end ? `${start}:${end}` : undefined;\n    }\n  }\n  if (withId) {\n    detail.selectedId = (feature as FeatureData)?.protvistaFeatureId;\n  }\n  return new CustomEvent(\"change\", {\n    detail,\n    bubbles: true,\n    cancelable: true,\n  });\n}\n\nexport default function bindEvents<T extends BaseType>(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  feature: Selection<T, any, any, any>,\n  element: NightingaleBaseElement,\n) {\n  feature\n    .on(\"mouseover\", function (event: Event, datum: unknown) {\n      element.dispatchEvent(\n        createEvent(\n          \"mouseover\",\n          datum as FeatureData | SequenceBaseData,\n          element.getAttribute(HIGHLIGHT_EVENT) === \"onmouseover\",\n          false,\n          (datum as FeatureData).start ?? (datum as SequenceBaseData).position,\n          (datum as FeatureData).end ?? (datum as SequenceBaseData).position,\n          this as unknown as HTMLElement,\n          event,\n        ),\n      );\n    })\n    .on(\"mouseout\", () => {\n      element.dispatchEvent(\n        createEvent(\n          \"mouseout\",\n          null,\n          element.getAttribute(HIGHLIGHT_EVENT) === \"onmouseover\",\n        ),\n      );\n    })\n    .on(\"click\", function (event: Event, datum: unknown) {\n      element.dispatchEvent(\n        createEvent(\n          \"click\",\n          datum as FeatureData | SequenceBaseData,\n          element.getAttribute(HIGHLIGHT_EVENT) === \"onclick\",\n          true,\n          (datum as FeatureData).start ?? (datum as SequenceBaseData).position,\n          (datum as FeatureData).end ?? (datum as SequenceBaseData).position,\n          this as unknown as HTMLElement,\n          event,\n          element as NightingaleBaseElement & WithHighlightInterface,\n        ),\n      );\n    });\n}\n","/* Adapting it from this stack overflow answer: https://stackoverflow.com/a/6511606 */\n\ntype ColorProperty = \"fill\" | \"stroke\" | \"color\";\n\nexport function contrastingColor(color: number[] | null) {\n  if (!color) return \"black\";\n  return luma(color) >= 165 ? \"black\" : \"white\";\n}\nexport function luma(rgb: number[]) {\n  return 0.2126 * rgb[0] + 0.7152 * rgb[1] + 0.0722 * rgb[2]; // SMPTE C, Rec. 709 weightings\n}\n\nexport function getColor(\n  element: Element,\n  property: ColorProperty,\n): number[] | null {\n  const style = getComputedStyle(element);\n  const prop = style?.[property];\n  const res = prop?.match(/[.\\d]+/g)?.map(Number) || null;\n  return res;\n}\n","import { customElement } from \"lit/decorators.js\";\nimport { CustomElementDecorator } from \"lit/decorators\";\n\ntype Constructor<T> = {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  new (...args: any[]): T;\n};\n\ntype CustomElementClass = Omit<typeof HTMLElement, \"new\">;\n\n/**\n * Extending the decorator to define custom elements in order to make sure only gets defined once.\n *\n * ```js\n * @customElementOnce('my-element')\n * class MyElement extends LitElement {\n *   render() {\n *     return html``;\n *   }\n * }\n * ```\n * @category Decorator\n * @param tagName The tag name of the custom element to define.\n */\nexport const customElementOnce =\n  (tagName: string): CustomElementDecorator =>\n  (\n    classOrTarget: CustomElementClass | Constructor<HTMLElement>,\n    context?: ClassDecoratorContext<Constructor<HTMLElement>>\n  ) => {\n    if (!window.customElements.get(tagName))\n      if (context) customElement(tagName)(classOrTarget, context);\n      else customElement(tagName)(classOrTarget);\n  };\n\nexport default customElementOnce;\n","import { LitElement } from \"lit\";\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type Constructor<T = {}> = new (...args: any[]) => T;\n\nclass NightingaleElement extends LitElement {\n  connectedCallback() {\n    super.connectedCallback();\n    this.style.display = \"inline-block\";\n    this.style.lineHeight = \"0\";\n  }\n  createRenderRoot() {\n    return this;\n  }\n}\n\nexport default NightingaleElement;\n","export { default as withDimensions } from \"./mixins/withDimensions/index\";\nexport { default as withPosition } from \"./mixins/withPosition/index\";\nexport { default as withMargin } from \"./mixins/withMargin/index\";\nexport { default as withResizable } from \"./mixins/withResizable/index\";\nexport { default as withManager } from \"./mixins/withManager/index\";\nexport { default as withHighlight } from \"./mixins/withHighlight/index\";\nexport { default as withSVGHighlight } from \"./mixins/withHighlight/SVG/index\";\nexport { default as withZoom } from \"./mixins/withZoom/index\";\nexport { default as bindEvents } from \"./utils/bindEvents\";\nexport { contrastingColor, getColor } from \"./utils/colors\";\nexport { default as Region } from \"./utils/Region\";\nexport { default as customElementOnce } from \"./decorators/customElementOnce\";\nimport NightingaleElement from \"./nightingale-base-element\";\nexport default NightingaleElement;\n","const symbolSize = 10;\n\nexport type Shapes =\n  | \"rectangle\"\n  | \"roundRectangle\"\n  | \"bridge\"\n  | \"line\"\n  | \"bridge\"\n  | \"diamond\"\n  | \"chevron\"\n  | \"catFace\"\n  | \"triangle\"\n  | \"wave\"\n  | \"hexagon\"\n  | \"pentagon\"\n  | \"circle\"\n  | \"arrow\"\n  | \"doubleBar\"\n  | \"discontinuosStart\"\n  | \"discontinuos\"\n  | \"discontinuosEnd\"\n  | \"helix\"\n  | \"strand\";\n\nexport default class FeatureShape {\n  #ftLength = 1;\n  #ftHeight = 1;\n  #ftWidth = 1;\n\n  private shape2function(shape: Shapes) {\n    switch (shape) {\n      case \"rectangle\":\n        return () => this.rectangle();\n      case \"roundRectangle\":\n        return () => this.roundRectangle();\n      case \"line\":\n        return () => this.line();\n      case \"bridge\":\n        return () => this.bridge();\n      case \"diamond\":\n        return () => this.diamond();\n      case \"chevron\":\n        return () => this.chevron();\n      case \"catFace\":\n        return () => this.catFace();\n      case \"triangle\":\n        return () => this.triangle();\n      case \"wave\":\n        return () => this.wave();\n      case \"hexagon\":\n        return () => this.hexagon();\n      case \"pentagon\":\n        return () => this.pentagon();\n      case \"circle\":\n        return () => this.circle();\n      case \"arrow\":\n        return () => this.arrow();\n      case \"doubleBar\":\n        return () => this.doubleBar();\n      case \"discontinuosStart\":\n        return () => this.discontinuosStart();\n      case \"discontinuos\":\n        return () => this.discontinuos();\n      case \"discontinuosEnd\":\n        return () => this.discontinuosEnd();\n      case \"helix\":\n        return () => this.helix();\n      case \"strand\":\n        return () => this.strand();\n      default:\n        return () => this.rectangle();\n    }\n  }\n  getFeatureShape(\n    aaWidth: number,\n    ftHeight: number,\n    ftLength: number,\n    shape: Shapes,\n  ) {\n    shape = shape || \"rectangle\";\n    this.#ftLength = ftLength;\n    this.#ftHeight = ftHeight;\n    this.#ftWidth = aaWidth * ftLength;\n    const shapeFn = this.shape2function(shape);\n    return shapeFn();\n  }\n\n  static isContinuous(shape: Shapes) {\n    return shape.toLowerCase() !== \"bridge\";\n  }\n\n  private rectangle() {\n    return `M0,0L${this.#ftWidth},0L${this.#ftWidth},${this.#ftHeight}L0,${this.#ftHeight}Z`;\n  }\n\n  private roundRectangle() {\n    const radius = 6;\n    return `M${radius},0h${\n      this.#ftWidth - 2 * radius\n    },0a${radius},${radius} 0 0 1 ${radius},${radius}v${\n      this.#ftHeight - 2 * radius\n    }a${radius},${radius} 0 0 1 ${-radius},${radius}h${\n      2 * radius - this.#ftWidth\n    }a${radius},${radius} 0 0 1 ${-radius},${-radius}v${\n      2 * radius - this.#ftHeight\n    }a${radius},${radius} 0 0 1 ${radius},${-radius}Z`;\n  }\n\n  line() {\n    return `M0,${this.#ftHeight / 2} L${this.#ftWidth},${this.#ftHeight / 2}`;\n  }\n\n  bridge() {\n    if (this.#ftLength !== 1) {\n      return `M0,${this.#ftHeight}L0,0L${this.#ftWidth},0L${this.#ftWidth},${this.#ftHeight}L${this.#ftWidth},2L0,2Z`;\n    }\n    return `M0,${this.#ftHeight}L0,${this.#ftHeight / 2}L${this.#ftWidth / 2},${\n      this.#ftHeight / 2\n    }L${this.#ftWidth / 2},0L${this.#ftWidth / 2},${this.#ftHeight / 2}L${\n      this.#ftWidth\n    },${this.#ftHeight / 2}L${this.#ftWidth},${this.#ftHeight}Z`;\n  }\n\n  #getMiddleLine(centerx: number) {\n    return `M0,${centerx}L${this.#ftWidth},${centerx}Z`;\n  }\n\n  diamond() {\n    const centerx = symbolSize / 2;\n    const m = this.#ftWidth / 2;\n    const shape = `M${m},0L${m + centerx},${centerx}L${m},${symbolSize}L${\n      m - centerx\n    },${centerx}`;\n    return this.#ftLength !== 1\n      ? shape + this.#getMiddleLine(centerx)\n      : `${shape}Z`;\n  }\n\n  chevron() {\n    const m = this.#ftWidth / 2;\n    const centerx = symbolSize / 2;\n    const shape = `M${m},${centerx}L${centerx + m},0L${\n      centerx + m\n    },${centerx}L${m},${symbolSize}L${-centerx + m},${centerx}L${\n      -centerx + m\n    },0`;\n    return this.#ftLength !== 1\n      ? `${shape}L${m},${centerx}${this.#getMiddleLine(centerx)}Z`\n      : shape + \"Z\";\n  }\n\n  catFace() {\n    const centerx = symbolSize / 2;\n    const step = symbolSize / 10;\n    const m = this.#ftWidth / 2;\n    const shape = `M${-centerx + m},0L${-centerx + m},${6 * step}L${\n      -2 * step + m\n    },${symbolSize}L${2 * step + m},${symbolSize}L${centerx + m},${6 * step}L${\n      centerx + m\n    },0L${2 * step + m},${4 * step}L${-2 * step + m},${4 * step}`;\n    return this.#ftLength !== 1\n      ? `${shape}M${m},0${this.#getMiddleLine(centerx)}Z`\n      : `${shape}Z`;\n  }\n\n  triangle() {\n    const centerx = symbolSize / 2;\n    const m = this.#ftWidth / 2;\n    const shape = `M${m},0L${centerx + m},${symbolSize}L${\n      -centerx + m\n    },${symbolSize}`;\n    return this.#ftLength !== 1\n      ? `${shape}L${m},0${this.#getMiddleLine(centerx)}Z`\n      : `${shape}Z`;\n  }\n\n  wave() {\n    const rx = symbolSize / 4;\n    const ry = symbolSize / 2;\n    const m = this.#ftWidth / 2;\n    const shape = `M${\n      -symbolSize / 2 + m\n    },${ry}A${rx},${ry} 0 1,1 ${m},${ry}A${rx},${ry} 0 1,0 ${\n      symbolSize / 2 + m\n    },${ry}`;\n    return this.#ftLength !== 1\n      ? `${shape + this.#getMiddleLine(ry)}Z`\n      : `${shape}Z`;\n  }\n\n  private getPolygon(sidesNumber: number) {\n    const r = symbolSize / 2;\n    let polygon = \"M \";\n    const m = this.#ftWidth / 2;\n    for (let i = 0; i < sidesNumber; i++) {\n      polygon += `${r * Math.cos((2 * Math.PI * i) / sidesNumber) + m},${\n        r * Math.sin((2 * Math.PI * i) / sidesNumber) + r\n      } `;\n    }\n    return this.#ftLength !== 1\n      ? `${polygon} ${r * Math.cos(0) + m},${\n          r * Math.sin(0) + r\n        } ${this.#getMiddleLine(r)}Z`\n      : `${polygon}Z`;\n  }\n\n  hexagon() {\n    return this.getPolygon(6);\n  }\n\n  pentagon() {\n    return this.getPolygon(5);\n  }\n\n  circle() {\n    const m = this.#ftWidth / 2;\n    const r = Math.sqrt(symbolSize / Math.PI);\n    const shape = `M${m},0A${r},${r} 0 1,1 ${m},${symbolSize}A${r},${r} 0 1,1 ${m},0`;\n    return this.#ftLength !== 1\n      ? `${shape + this.#getMiddleLine(symbolSize / 2)}Z`\n      : `${shape}Z`;\n  }\n\n  arrow() {\n    const step = symbolSize / 10;\n    const m = this.#ftWidth / 2;\n    const shape = `M${m},0L${-step + m},0L${-5 * step + m},${4 * step}L${\n      -step + m\n    },${this.#ftHeight}L${m},${this.#ftHeight}L${4 * step + m},${4 * step}`;\n    return this.#ftLength !== 1\n      ? `${shape}L${m},0${this.#getMiddleLine(symbolSize / 2)}Z`\n      : `${shape}Z`;\n  }\n\n  doubleBar() {\n    const m = this.#ftWidth / 2;\n    const centerx = symbolSize / 2;\n    const shape = `M${m},0L${-centerx + m},${symbolSize}L${m},${symbolSize}L${\n      centerx + m\n    },0`;\n    return this.#ftLength !== 1\n      ? `${shape}L${m},0${this.#getMiddleLine(symbolSize / 2)}Z`\n      : `${shape}Z`;\n  }\n\n  #getBrokenEnd() {\n    const qh = this.#ftHeight / 4.0;\n    return `L${this.#ftWidth - qh},${qh}L${this.#ftWidth},${2 * qh}L${\n      this.#ftWidth - qh\n    },${3 * qh}L${this.#ftWidth},${this.#ftHeight}`;\n  }\n\n  #getBrokenStart() {\n    const qh = this.#ftHeight / 4.0;\n    return `L${qh},${3 * qh}L0,${2 * qh}L${qh},${qh}`;\n  }\n\n  discontinuosStart() {\n    return `M0,0L${this.#ftWidth},0L${this.#ftWidth},${this.#ftHeight}L0,${\n      this.#ftHeight\n    }${this.#getBrokenStart()}Z`;\n  }\n\n  discontinuos() {\n    return `M0,0L${this.#ftWidth},0${this.#getBrokenEnd()}L0,${\n      this.#ftHeight\n    }${this.#getBrokenStart()}Z`;\n  }\n\n  discontinuosEnd() {\n    return `M0,0L${this.#ftWidth},0${this.#getBrokenEnd()}L0,${\n      this.#ftHeight\n    }Z`;\n  }\n\n  helix() {\n    const x = symbolSize / 2; // Fitting two loops in a symbol\n    const y = symbolSize / 4;\n    let center = x / 2;\n    const nw = Math.round(this.#ftWidth / x);\n\n    let loop = \"\";\n    for (let i = 0; i < nw; i++) {\n      const shape = `M${-(x / 2) + center},${this.#ftHeight} C${center + y},${\n        3 * y\n      } ${x / 2 + center},${y} ${center}, 0 C${center - y},${y} ${center},${\n        3 * y\n      } ${x / 2 + center},${this.#ftHeight}`;\n      loop += shape;\n      center += x;\n    }\n    return loop;\n  }\n\n  strand() {\n    let rl = 0;\n    if (this.#ftWidth > symbolSize / 2) {\n      rl = this.#ftWidth - symbolSize / 2;\n    }\n    const qh = this.#ftHeight / 4;\n    const rect = `M0,${qh}L${rl},${qh}L${rl},${3 * qh}L0,${3 * qh}L0,${qh}`;\n    const triangle = `M${rl},${0}L${this.#ftWidth},${2 * qh}L${rl},${\n      this.#ftHeight\n    }Z`;\n    return rect + triangle;\n  }\n}\n","import { Feature } from \"./nightingale-track\";\n\nexport type LayoutOptions = {\n  layoutHeight: number;\n  margin?: Margin;\n  minHeight?: number;\n};\ntype Margin = {\n  top: number;\n  bottom: number;\n  left: number;\n  right: number;\n};\n\nexport default class DefaultLayout {\n  protected margin: Margin;\n  protected minHeight: number;\n  protected layoutHeight: number;\n\n  features: Feature[];\n\n  constructor({\n    layoutHeight,\n    margin = {\n      top: 1,\n      bottom: 1,\n      left: 0,\n      right: 0,\n    },\n    minHeight = 17,\n  }: LayoutOptions) {\n    this.margin = margin;\n    this.minHeight = minHeight;\n    this.layoutHeight = layoutHeight;\n    this.features = [];\n  }\n\n  init(features: Feature[], ..._args: unknown[]) {\n    this.features = features;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  getFeatureYPos(feature?: Feature | string) {\n    // Position right in the middle of the space between the margins\n    const featureHeight = this.getFeatureHeight();\n    return (\n      this.margin.top +\n      (this.layoutHeight - this.margin.top - this.margin.bottom) / 2 -\n      featureHeight / 2\n    );\n  }\n\n  getFeatureHeight(..._args: unknown[]) {\n    return Math.max(\n      this.minHeight,\n      this.layoutHeight - this.margin.top - this.margin.bottom,\n    );\n  }\n}\n","import DefaultLayout, { LayoutOptions } from \"./DefaultLayout\";\nimport { Feature } from \"./nightingale-track\";\n\nconst featuresOverlap = (feature1: Feature, feature2: Feature) =>\n  !(\n    Number(feature2.start) > Number(feature1.end) ||\n    Number(feature2.end) < Number(feature1.start)\n  );\n\nconst featureOvelapsInRow = (feature: Feature, row: Feature[]) =>\n  row.some((rowFeature) => featuresOverlap(feature, rowFeature));\n\nexport default class NonOverlappingLayout extends DefaultLayout {\n  protected rowHeight: number;\n  featuresMap = new Map();\n  #rows: Feature[][];\n\n  constructor(options: LayoutOptions) {\n    super(options);\n    this.rowHeight = 0;\n    this.minHeight = 15;\n    this.#rows = [];\n  }\n\n  init(features: Feature[]) {\n    features.forEach((feature) => {\n      const rowIndex = this.#rows.findIndex(\n        (row) => !featureOvelapsInRow(feature, row),\n      );\n      if (rowIndex >= 0) {\n        this.#rows[rowIndex].push(feature);\n        this.featuresMap.set(feature, rowIndex);\n      } else {\n        this.#rows.push([feature]);\n        this.featuresMap.set(feature, this.#rows.length - 1);\n      }\n    });\n    this.rowHeight = Math.min(\n      this.layoutHeight / this.#rows.length,\n      this.minHeight,\n    );\n  }\n\n  getOffset() {\n    // this offset is required for centering if the number of rows doesn't\n    // fill the layout\n    if (this.#rows.length * this.rowHeight < this.layoutHeight) {\n      return this.layoutHeight / 2 - (this.#rows.length * this.rowHeight) / 2;\n    }\n    return 0;\n  }\n\n  getFeatureYPos(feature: Feature) {\n    const rowNumber = this.featuresMap.get(feature);\n    return (\n      this.getOffset() +\n      this.rowHeight * rowNumber +\n      this.margin.top +\n      this.margin.bottom\n    );\n  }\n\n  getFeatureHeight() {\n    return this.rowHeight - this.margin.top - this.margin.bottom;\n  }\n}\n","export const config = {\n  CHAIN: {\n    name: \"chain\",\n    label: \"Chain\",\n    tooltip:\n      \"(aka mature region). This describes the extent of a polypeptide chain in the mature protein following processing\",\n    shape: \"rectangle\",\n    color: \"#CC9933\",\n  },\n  TRANSIT: {\n    name: \"transit peptide\",\n    label: \"Transit peptide\",\n    tooltip: \"This describes the extent of a transit peptide\",\n    shape: \"rectangle\",\n    color: \"#009966\",\n  },\n  INIT_MET: {\n    name: \"initiator methionine\",\n    label: \"Initiator methionine\",\n    tooltip:\n      \"This indicates that the initiator methionine is cleaved from the mature protein\",\n    shape: \"arrow\",\n    color: \"#996633\",\n  },\n  PROPEP: {\n    name: \"propeptide\",\n    label: \"Propeptide\",\n    tooltip:\n      \"Part of a protein that is cleaved during maturation or activation\",\n    shape: \"rectangle\",\n    color: \"#99CCCC\",\n  },\n  PEPTIDE: {\n    name: \"peptide\",\n    label: \"Peptide\",\n    tooltip:\n      \"The position and length of an active peptide in the mature protein\",\n    shape: \"rectangle\",\n    color: \"#006699\",\n  },\n  SIGNAL: {\n    name: \"signal peptide\",\n    label: \"Signal peptide\",\n    tooltip: \"N-terminal signal peptide\",\n    shape: \"rectangle\",\n    color: \"#CC0033\",\n  },\n  HELIX: {\n    name: \"helix\",\n    label: \"Helix\",\n    tooltip: \"The positions of experimentally determined helical regions\",\n    shape: \"rectangle\",\n    color: \"#FF0066\",\n  },\n  STRAND: {\n    name: \"strand\",\n    label: \"Beta strand\",\n    tooltip: \"The positions of experimentally determined beta strands\",\n    shape: \"rectangle\",\n    color: \"#FFCC00\",\n  },\n  TURN: {\n    name: \"turn\",\n    label: \"Turn\",\n    tooltip: \"The positions of experimentally determined hydrogen-bonded turns\",\n    shape: \"rectangle\",\n    color: \"#0571AF\",\n  },\n  DISULFID: {\n    name: \"disulfide bond\",\n    label: \"Disulfide bond\",\n    tooltip:\n      \"The positions of cysteine residues participating in disulphide bonds\",\n    shape: \"bridge\",\n    color: \"#23B14D\",\n  },\n  CROSSLNK: {\n    name: \"cross-link\",\n    label: \"Cross-link\",\n    tooltip:\n      \"Covalent linkages of various types formed between two proteins or between two parts of the same protein\",\n    shape: \"bridge\",\n    color: \"#FF6600\",\n  },\n  REGION: {\n    name: \"region of interest\",\n    label: \"Region of interest\",\n    tooltip:\n      \"Regions in multifunctional enzymes or fusion proteins, or characteristics of a region, e.g., protein-protein interactions mediation\",\n    shape: \"rectangle\",\n    color: \"#B33E00\",\n  },\n  COILED: {\n    name: \"coiled-coil region\",\n    label: \"Coiled-coil region\",\n    tooltip:\n      \"Coiled coils are built by two or more alpha-helices that wind around each other to form a supercoil\",\n    shape: \"rectangle\",\n    color: \"#006699\",\n  },\n  MOTIF: {\n    name: \"short sequence motif\",\n    label: \"Short sequence motif\",\n    tooltip: \"Short conserved sequence motif of biological significance\",\n    shape: \"rectangle\",\n    color: \"#402060\",\n  },\n  REPEAT: {\n    name: \"repeat\",\n    label: \"Repeat\",\n    tooltip: \"Repeated sequence motifs or repeated domains within the protein\",\n    shape: \"rectangle\",\n    color: \"#9900FF\",\n  },\n  CA_BIND: {\n    name: \"calcium-binding region\",\n    label: \"Calcium-binding region\",\n    tooltip: \"Calcium-binding regions, such as the EF-hand motif\",\n    shape: \"rectangle\",\n    color: \"#FF3399\",\n  },\n  DNA_BIND: {\n    name: \"DNA-binding region\",\n    label: \"DNA binding\",\n    tooltip:\n      \"DNA-binding domains such as AP2/ERF domain, the ETS domain, the Fork-Head domain, the HMG box and the Myb domain\",\n    shape: \"rectangle\",\n    color: \"#009933\",\n  },\n  DOMAIN: {\n    name: \"other domain of interest\",\n    label: \"Other domain of interest\",\n    tooltip:\n      \"Specific combination of secondary structures organized into a characteristic three-dimensional structure or fold\",\n    shape: \"rectangle\",\n    color: \"#9999FF\",\n  },\n  ZN_FING: {\n    name: \"zinc finger region\",\n    label: \"Zinc finger\",\n    tooltip:\n      \"Small, functional, independently folded domain that coordinates one or more zinc ions\",\n    shape: \"rectangle\",\n    color: \"#990066\",\n  },\n  NP_BIND: {\n    name: \"nucleotide-binding region\",\n    label: \"Nucleotide-binding region\",\n    tooltip:\n      \"(aka flavin-binding). Region in the protein which binds nucleotide phosphates\",\n    shape: \"rectangle\",\n    color: \"#FF9900\",\n  },\n  METAL: {\n    name: \"metal ion-binding site\",\n    label: \"Metal ion-binding site\",\n    tooltip: \"Binding site for a metal ion\",\n    shape: \"diamond\",\n    color: \"#009900\",\n  },\n  SITE: {\n    name: \"other site of interest\",\n    label: \"Other site of interest\",\n    tooltip: \"Any interesting single amino acid site on the sequence\",\n    shape: \"chevron\",\n    color: \"#660033\",\n  },\n  BINDING: {\n    name: \"other binding site\",\n    label: \"Other binding site\",\n    tooltip:\n      \"Binding site for any chemical group (co-enzyme, prosthetic group, etc.)\",\n    shape: \"rectangle\",\n    color: \"#catFace\",\n  },\n  ACT_SITE: {\n    name: \"active site\",\n    label: \"Active site\",\n    tooltip: \"Amino acid(s) directly involved in the activity of an enzyme\",\n    shape: \"circle\",\n    color: \"#FF6666\",\n  },\n  MOD_RES: {\n    name: \"Post-translationally modified residue\",\n    label: \"Modified residue\",\n    tooltip:\n      \"Modified residues such as phosphorylation, acetylation, acylation, methylation\",\n    shape: \"triangle\",\n    color: \"#000066\",\n  },\n  LIPID: {\n    name: \"lipid moiety-binding region\",\n    label: \"Lipidation\",\n    tooltip: \"Covalently attached lipid group(s)\",\n    shape: \"wave\",\n    color: \"#99CC33\",\n  },\n  CARBOHYD: {\n    name: \"glycosylation site\",\n    label: \"Glycosylation\",\n    tooltip: \"Covalently attached glycan group(s)\",\n    shape: \"hexagon\",\n    color: \"#CC3366\",\n  },\n  COMPBIAS: {\n    name: \"compositionally biased region\",\n    label: \"Compositionally biased region\",\n    tooltip:\n      \"Position of regions of compositional bias within the protein and the particular amino acids that are over-represented within those regions\",\n    shape: \"rectangle\",\n    color: \"#FF3366\",\n  },\n  CONFLICT: {\n    name: \"sequence conflict\",\n    label: \"Sequence conflict\",\n    tooltip: \"Sequence discrepancies of unknown origin\",\n    shape: \"rectangle\",\n    color: \"#6633CC\",\n  },\n  NON_CONS: {\n    name: \"non-consecutive residues\",\n    label: \"Non-adjacent residues\",\n    tooltip:\n      \"Indicates that two residues in a sequence are not consecutive and that there is an undetermined number of unsequenced residues between them\",\n    shape: \"doubleBar\",\n    color: \"#FF0033\",\n  },\n  NON_TER: {\n    name: \"non-terminal residue\",\n    label: \"Non-terminal residue\",\n    tooltip:\n      \"The sequence is incomplete. The residue is not the terminal residue of the complete protein\",\n    shape: \"doubleBar\",\n    color: \"#339933\",\n  },\n  UNSURE: {\n    name: \"unsure residue\",\n    label: \"Sequence uncertainty\",\n    tooltip:\n      \"Regions of a sequence for which the authors are unsure about the sequence assignment\",\n    shape: \"rectangle\",\n    color: \"#33FF00\",\n  },\n  NON_STD: {\n    name: \"non-standard amino acid\",\n    label: \"Non-standard residue\",\n    tooltip: \"Non-standard amino acids (selenocysteine and pyrrolysine)\",\n    shape: \"pentagon\",\n    color: \"#330066\",\n  },\n  MUTAGEN: {\n    name: \"mutagenesis site\",\n    label: \"Mutagenesis\",\n    tooltip: \"Site which has been experimentally altered by mutagenesis\",\n    shape: \"rectangle\",\n    color: \"#FF9900\",\n  },\n  TOPO_DOM: {\n    name: \"topological domain\",\n    label: \"Topological domain\",\n    tooltip: \"Location of non-membrane regions of membrane-spanning proteins\",\n    shape: \"rectangle\",\n    color: \"#CC0000\",\n  },\n  TRANSMEM: {\n    name: \"transmembrane region\",\n    label: \"Transmembrane\",\n    tooltip: \"Extent of a membrane-spanning region\",\n    shape: \"rectangle\",\n    color: \"#CC00CC\",\n  },\n  INTRAMEM: {\n    name: \"intramembrane region\",\n    label: \"Intramembrane\",\n    tooltip: \"Extent of a region located in a membrane without crossing it\",\n    shape: \"rectangle\",\n    color: \"#0000CC\",\n  },\n  VAR_SEQ: {\n    name: \"splice variant\",\n    label: \"Splice variant\",\n    tooltip: \"\",\n    shape: \"rectangle\",\n    color: \"#CC11CC\",\n  },\n  VARIANT: {\n    name: \"sequence variant\",\n    label: \"Natural variant\",\n    tooltip:\n      \"Natural variant of the protein, including polymorphisms, variations between strains, isolates or cultivars, disease-associated mutations and RNA editing events\",\n    shape: \"circle\",\n    color: \"black\",\n  },\n  UNIQUE: {\n    name: \"unique\",\n    label: \"Unique peptide\",\n    tooltip: \"\",\n    shape: \"rectangle\",\n    color: \"#fc3133\",\n  },\n  NON_UNIQUE: {\n    name: \"non-unique\",\n    label: \"Non-unique peptide\",\n    tooltip: \"\",\n    shape: \"rectangle\",\n    color: \"#8585fc\",\n  },\n  ANTIGEN: {\n    name: \"antigen\",\n    label: \"Antibody binding sequences\",\n    tooltip: \"\",\n    shape: \"rectangle\",\n    color: \"#996699\",\n  },\n  PDBE_COVER: {\n    name: \"pdbe coverage\",\n    label: \"PDBe 3D structure coverage\",\n    tooltip: \"\",\n    shape: \"rectangle\",\n    color: \"#669966\",\n  },\n};\n","import { config } from \"./config\";\ntype ConfigOption = keyof typeof config;\n\nexport const getShapeByType = (type: string) => {\n  if (type.toUpperCase() in config) {\n    return config[type.toUpperCase() as ConfigOption].shape;\n  }\n  const info = Object.values(config).find(\n    (typeInfo) => typeInfo.name.toUpperCase() === type.toUpperCase(),\n  );\n  if (info) {\n    return info.shape;\n  }\n  return \"rectangle\";\n};\n\nexport const getColorByType = (type: string) => {\n  if (type.toUpperCase() in config) {\n    return config[type.toUpperCase() as ConfigOption].color;\n  }\n  const info = Object.values(config).find(\n    (typeInfo) => typeInfo.name.toUpperCase() === type.toUpperCase(),\n  );\n  if (!info) {\n    console.log(type);\n  }\n  if (info) {\n    return info.color;\n  }\n  return \"black\";\n};\n","import { select, Selection } from \"d3\";\nimport NightingaleElement, {\n  withDimensions,\n  withPosition,\n  withMargin,\n  withResizable,\n  withHighlight,\n  withManager,\n  withZoom,\n  bindEvents,\n  customElementOnce,\n} from \"@nightingale-elements/nightingale-new-core\";\n\n// import _includes from \"lodash-es/includes\";\n// import _groupBy from \"lodash-es/groupBy\";\n// import _union from \"lodash-es/union\";\n// import _intersection from \"lodash-es/intersection\";\n\nimport { html } from \"lit\";\nimport { property } from \"lit/decorators.js\";\n\nimport FeatureShape, { Shapes } from \"./FeatureShape\";\nimport NonOverlappingLayout from \"./NonOverlappingLayout\";\nimport DefaultLayout from \"./DefaultLayout\";\nimport { getShapeByType, getColorByType } from \"./ConfigHelper\";\n\nexport type FeatureLocation = {\n  fragments: Array<{\n    start: number;\n    end: number;\n  }>;\n};\nexport type Feature = {\n  accession: string;\n  color?: string;\n  fill?: string;\n  shape?: Shapes;\n  tooltipContent?: string;\n  type?: string;\n  locations?: Array<FeatureLocation>;\n  feature?: Feature;\n  start?: number;\n  end?: number;\n  opacity?: number;\n};\n\n// TODO: height is not triggering a full redrawn when is changed after first render\nconst ATTRIBUTES_THAT_TRIGGER_REFRESH = [\"length\", \"width\", \"height\"];\n\n@customElementOnce(\"nightingale-track\")\nclass NightingaleTrack extends withManager(\n  withZoom(\n    withResizable(\n      withMargin(\n        withPosition(withDimensions(withHighlight(NightingaleElement))),\n      ),\n    ),\n  ),\n) {\n  @property({ type: String })\n  color?: string | null;\n  @property({ type: String })\n  shape?: string | null;\n  @property({ type: String })\n  layout?: \"non-overlapping\" | \"default\";\n\n  protected featureShape = new FeatureShape();\n  protected layoutObj?: DefaultLayout | NonOverlappingLayout;\n  #originalData: Feature[] = [];\n  #data: Feature[] = [];\n  filters = null;\n\n  protected seqG?: Selection<\n    SVGGElement,\n    unknown,\n    HTMLElement | SVGElement | null,\n    unknown\n  >;\n  #highlighted?: Selection<\n    SVGGElement,\n    unknown,\n    HTMLElement | SVGElement | null,\n    unknown\n  >;\n  protected margins?: Selection<\n    SVGGElement,\n    unknown,\n    HTMLElement | SVGElement | null,\n    unknown\n  >;\n\n  getLayout() {\n    if (String(this.layout).toLowerCase() === \"non-overlapping\")\n      return new NonOverlappingLayout({\n        layoutHeight: this.height,\n      });\n    return new DefaultLayout({\n      layoutHeight: this.height,\n      margin: {\n        top: this[\"margin-top\"],\n        bottom: this[\"margin-bottom\"],\n        left: this[\"margin-left\"],\n        right: this[\"margin-right\"],\n      },\n    });\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.layoutObj = this.getLayout();\n    if (this.#data) this.createTrack();\n\n    // TODO: re-enable when the dataloadre is implemented\n    // this.addEventListener(\"load\", (e) => {\n    //   if (_includes(this.children, e.target)) {\n    //     this.data = e.detail.payload;\n    //   }\n    // });\n  }\n\n  static normalizeLocations(data: Feature[]) {\n    return data.map((obj) => {\n      const { locations, start, end } = obj;\n      return locations\n        ? obj\n        : Object.assign(obj, {\n            locations: [\n              {\n                fragments: [\n                  {\n                    start,\n                    end,\n                  },\n                ],\n              },\n            ],\n          });\n    });\n  }\n\n  processData(data: Feature[]) {\n    this.#originalData = NightingaleTrack.normalizeLocations(data);\n  }\n\n  set data(data: Feature[]) {\n    this.processData(data);\n    this.applyFilters();\n    this.layoutObj = this.getLayout();\n    this.createTrack();\n  }\n  get data() {\n    return this.#data;\n  }\n  // TODO: re-enable filters\n  // set filters(filters) {\n  //   this._filters = filters;\n  //   this.applyFilters();\n  //   this.createTrack();\n  // }\n\n  attributeChangedCallback(\n    name: string,\n    oldValue: string | null,\n    newValue: string | null,\n  ): void {\n    super.attributeChangedCallback(name, oldValue, newValue);\n    if (\n      ATTRIBUTES_THAT_TRIGGER_REFRESH.includes(name) ||\n      name.startsWith(\"margin-\")\n    ) {\n      this.applyFilters();\n      this.layoutObj = this.getLayout();\n      this.createTrack();\n    }\n  }\n\n  protected getFeatureColor(f: Feature | { feature: Feature }): string {\n    const defaultColor = \"gray\";\n    if ((f as Feature).color) {\n      return (f as Feature).color || defaultColor;\n    }\n    if ((f as { feature: Feature })?.feature?.color) {\n      return (f as { feature: Feature })?.feature?.color || defaultColor;\n    }\n    if (this.color) {\n      return this.color;\n    }\n    if ((f as Feature).type) {\n      return getColorByType((f as Feature).type as string);\n    }\n    if ((f as { feature: Feature })?.feature?.type) {\n      return getColorByType((f as { feature: Feature }).feature.type as string);\n    }\n    return defaultColor;\n  }\n\n  protected getFeatureFillColor(f: Feature | { feature: Feature }) {\n    const defaultColor = \"gray\";\n    if ((f as Feature).fill) {\n      return (f as Feature).fill || defaultColor;\n    }\n    if ((f as { feature: Feature })?.feature?.fill) {\n      return (f as { feature: Feature }).feature.fill || defaultColor;\n    }\n    return this.getFeatureColor(f);\n  }\n\n  protected getShape(f: Feature | { feature: Feature }): Shapes {\n    const defaultShape = \"rectangle\";\n    if ((f as Feature).shape) {\n      return (f as Feature).shape || defaultShape;\n    }\n    if ((f as { feature: Feature })?.feature?.shape) {\n      return (f as { feature: Feature }).feature.shape || defaultShape;\n    }\n    if (this.shape) {\n      return this.shape as Shapes;\n    }\n    if ((f as Feature).type) {\n      return getShapeByType((f as Feature).type as string) as Shapes;\n    }\n    if ((f as { feature: Feature }).feature?.type) {\n      return getShapeByType(\n        (f as { feature: Feature }).feature.type as string,\n      ) as Shapes;\n    }\n    return defaultShape;\n  }\n\n  protected createTrack() {\n    if (!this.#data) {\n      return;\n    }\n    this.layoutObj?.init(this.#data);\n\n    this.svg?.selectAll(\"g\").remove();\n\n    this.svg = select(this as unknown as NightingaleElement)\n      .selectAll<SVGSVGElement, unknown>(\"svg\")\n      .attr(\"width\", this.width)\n      .attr(\"height\", this.height);\n\n    if (!this.svg) return;\n    this.seqG = this.svg.append(\"g\").attr(\"class\", \"sequence-features\");\n    this.createFeatures();\n    this.#highlighted = this.svg.append(\"g\").attr(\"class\", \"highlighted\");\n    this.margins = this.svg.append(\"g\").attr(\"class\", \"margin\");\n  }\n\n  protected createFeatures() {\n    if (!this.seqG) return;\n    const featuresG = this.seqG.selectAll(\"g.feature-group\").data(this.#data);\n\n    const locationsG = featuresG\n      .enter()\n      .append(\"g\")\n      .attr(\"class\", \"feature-group\")\n      .attr(\"id\", (d) => `g_${d.accession}`)\n      .selectAll(\"g.location-group\")\n      .data((d) =>\n        (d.locations || []).map((loc) =>\n          Object.assign({}, loc, {\n            feature: d,\n          }),\n        ),\n      )\n      .enter()\n      .append(\"g\")\n      .attr(\"class\", \"location-group\");\n\n    const fragmentGroup = locationsG\n      .selectAll(\"g.fragment-group\")\n      .data((d) =>\n        d.fragments.map((loc) =>\n          Object.assign({}, loc, {\n            feature: d.feature,\n          }),\n        ),\n      )\n      .enter()\n      .append(\"g\")\n      .attr(\"class\", \"fragment-group\");\n\n    fragmentGroup\n      .append(\"path\")\n      .attr(\"class\", (f) => `${this.getShape(f)} feature`)\n      .attr(\"d\", (f) =>\n        this.featureShape.getFeatureShape(\n          this.getSingleBaseWidth(),\n          this.layoutObj?.getFeatureHeight() || 0,\n          f.end ? f.end - f.start + 1 : 1,\n          this.getShape(f),\n        ),\n      )\n      .attr(\n        \"transform\",\n        (f) =>\n          `translate(${this.getXFromSeqPosition(f.start)},${\n            this.layoutObj?.getFeatureYPos(f.feature) || 0\n          })`,\n      )\n      .style(\"fill\", (f) => this.getFeatureFillColor(f))\n      .attr(\"stroke\", (f) => this.getFeatureColor(f))\n      .style(\"fill-opacity\", ({ feature }) =>\n        feature.opacity ? feature.opacity : 0.9,\n      )\n      .style(\"stroke-opacity\", ({ feature }) =>\n        feature.opacity ? feature.opacity : 0.9,\n      );\n\n    fragmentGroup\n      .append(\"rect\")\n      .attr(\"class\", \"outer-rectangle feature\")\n      .attr(\"width\", (f) =>\n        Math.max(\n          0,\n          this.getSingleBaseWidth() * (f.end ? f.end - f.start + 1 : 1),\n        ),\n      )\n      .attr(\"height\", this.layoutObj?.getFeatureHeight() || 0)\n      .attr(\n        \"transform\",\n        (f) =>\n          `translate(${this.getXFromSeqPosition(f.start)},${\n            this.layoutObj?.getFeatureYPos(f.feature) || 0\n          })`,\n      )\n      .style(\"fill\", \"transparent\")\n      .attr(\"stroke\", \"transparent\")\n      .call(bindEvents, this);\n  }\n\n  private applyFilters() {\n    if ((this.filters || []).length <= 0) {\n      this.#data = this.#originalData;\n      return;\n    }\n    // TODO: re-enable filters\n    //   // Filters are OR-ed within a category and AND-ed between categories\n    //   const groupedFilters = _groupBy(this._filters, \"category\");\n    //   const filteredGroups = Object.values(groupedFilters).map((filterGroup) => {\n    //     const filteredData = filterGroup.map((filterItem) =>\n    //       filterItem.filterFn(this.#originalData)\n    //     );\n    //     return _union(...filteredData);\n    //   });\n    //   const intersection = _intersection(...filteredGroups);\n    //   this._data = intersection;\n  }\n\n  refresh() {\n    if (this.xScale && this.seqG) {\n      const fragmentG = this.seqG.selectAll(\"g.fragment-group\").data(\n        this.#data.reduce(\n          (acc: unknown[], f) =>\n            acc.concat(\n              (f.locations || []).reduce(\n                (acc2: unknown[], e) =>\n                  acc2.concat(\n                    e.fragments.map((loc) =>\n                      Object.assign({}, loc, {\n                        feature: f,\n                      }),\n                    ),\n                  ),\n                [],\n              ),\n            ),\n          [],\n        ),\n      );\n\n      fragmentG\n        .selectAll<SVGPathElement, Feature>(\"path.feature\")\n        .attr(\"d\", (f) =>\n          this.featureShape.getFeatureShape(\n            this.getSingleBaseWidth(),\n            this.layoutObj?.getFeatureHeight() || 0,\n            f?.end && f?.start ? f.end - f.start + 1 : 1,\n            this.getShape(f),\n          ),\n        )\n        .attr(\n          \"transform\",\n          (f) =>\n            `translate(${this.getXFromSeqPosition(\n              f.start || 0,\n            )},${this.layoutObj?.getFeatureYPos(f.feature as Feature)})`,\n        );\n\n      fragmentG\n        .selectAll<SVGRectElement, Feature>(\"rect.outer-rectangle\")\n        .attr(\"width\", (f) =>\n          Math.max(\n            0,\n            this.getSingleBaseWidth() *\n              (f?.end && f?.start ? f.end - f.start + 1 : 1),\n          ),\n        )\n        .attr(\"height\", this.layoutObj?.getFeatureHeight() || 0)\n        .attr(\n          \"transform\",\n          (f) =>\n            `translate(${this.getXFromSeqPosition(f.start || 0)},${\n              this.layoutObj?.getFeatureYPos(f.feature as Feature) || 0\n            })`,\n        );\n    }\n    this.updateHighlight();\n\n    this.renderMarginOnGroup(this.margins);\n  }\n\n  protected updateHighlight() {\n    if (!this.#highlighted) return;\n    const highlighs = this.#highlighted\n      .selectAll<\n        SVGRectElement,\n        {\n          start: number;\n          end: number;\n        }[]\n      >(\"rect\")\n      .data(this.highlightedRegion.segments);\n\n    highlighs\n      .enter()\n      .append(\"rect\")\n      .style(\"pointer-events\", \"none\")\n      .merge(highlighs)\n      .attr(\"fill\", this[\"highlight-color\"])\n      .attr(\"height\", this.height)\n      .attr(\"x\", (d) => this.getXFromSeqPosition(d.start))\n      .attr(\"width\", (d) =>\n        Math.max(0, this.getSingleBaseWidth() * (d.end - d.start + 1)),\n      );\n\n    highlighs.exit().remove();\n  }\n\n  zoomRefreshed() {\n    if (this.getWidthWithMargins() > 0) this.refresh();\n  }\n\n  firstUpdated() {\n    this.createTrack();\n  }\n\n  render() {\n    return html`<svg class=\"container\"></svg>`;\n  }\n}\n\nexport default NightingaleTrack;\n\nexport { DefaultLayout };\nexport { getColorByType };\n","import NightingaleTrack from \"./nightingale-track\";\nexport { default as DefaultLayout } from \"./DefaultLayout\";\nexport { default as NonOverlappingLayout } from \"./NonOverlappingLayout\";\nexport type { Feature, FeatureLocation } from \"./nightingale-track\";\nexport type { LayoutOptions } from \"./DefaultLayout\";\nexport type { Shapes } from \"./FeatureShape\";\n\nexport default NightingaleTrack;\n"],"names":["InterproEntryLayout","DefaultLayout","constructor","_b","expanded","padding","samesize","super","__rest","_InterproEntryLayout_heightMap","set","Map","_InterproEntryLayout_yPositionMap","maxYPos","undefined","this","init","features","children","childHeight","yPos","__classPrivateFieldSet","innerPadding","residuesPos","k","length","feature","isCollapsible","residues","__classPrivateFieldGet","accession","get","Math","max","_InterproEntryLayout_instances","_InterproEntryLayout_initResidues","call","locations","child","has","filterOutResidueFragmentsOutOfLocation","residue","featureLocations","forEach","locRes","fragments","filter","fragRes","some","loc","frag","start","end","getAccFromFeature","acc","getFeatureYPos","_a","getFeatureHeight","featureAcc","locs","i","resGroup","j","desc","description","height","addContributor","contributor","coverage","toContribute","Object","assign","value","newCoverage","segment","push","createResidueGroup","baseG","selectAll","data","d","map","r","enter","append","attr","location","createResiduePaths","_ref","getResidueShape","getResidueTransform","getResidueFill","element","currentResidue","bindEvents","refreshResiduePaths","_ref2","paths","numberOfSibillings","Set","f","size","style","colorCache","NightingaleInterproTrack","NightingaleInterproTrack_1","NightingaleTrack","label","layout","_NightingaleInterproTrack_contributors","_NightingaleInterproTrack_coverage","_NightingaleInterproTrack_haveCreatedFeatures","_NightingaleInterproTrack_childrenG","_NightingaleInterproTrack_featuresG","_NightingaleInterproTrack_residuesG","_NightingaleInterproTrack_childResiduesG","createTrack","layoutObj","connectedCallback","attributeChangedCallback","name","oldValue","newValue","c","contributors","normalizeLocations","createEmptyFragments","fr","getCoverage","getLayout","layoutHeight","createFeatures","seqG","reduce","agg","v","min","Infinity","getShape","on","removeAttribute","setAttribute","svg","childrenGroup","_c","childGroup","locationChildrenG","_","fragment","_event","refresh","_d","mask","select","createCoverage","_e","_f","featureShape","getFeatureShape","getSingleBaseWidth","getXFromSeqPosition","getFeatureColor","getTextLabel","datum","startsWith","_get","slice","refreshLabels","base","displayStart","displayEnd","getVisibleStart","getVisibleEnd","nodes","parentElement","querySelector","contrastingColor","colorKeyword","el","document","createElement","color","body","appendChild","rgbValue","window","getComputedStyle","removeChild","res","match","Number","colorKeywordToRGB","getFeatureFillColor","text","each","n","self","width","textLength","node","getComputedTextLength","refreshFeatures","shape","refreshCoverLine","coverLinesChildren","featureChildren","featuresG","contributorsLength","refreshCoverage","_g","_h","updateHighlight","renderMarginOnGroup","margins","featureStart","dStart","featureEnd","dEnd","__decorate","property","type","Boolean","reflect","String","customElement","withDimensions","superClass","options","WithDimensions","defaultOptions","WithPosition","_WithPosition_intitialOptions","_WithPosition_length","DEFAULT_MARGIN_COLOR","WithMargin","_WithMargin_intitialOptions","_WithMargin_created","getWidthWithMargins","getHeightWithMargins","g","empty","WithResizable","arguments","_WithResizable_intitialOptions","_WithResizable_observer","onResize","bind","listenForResize","useAvailableWidth","getAttribute","offsetWidth","useAvailableHeight","offsetHeight","onDimensionsChange","disconnectedCallback","unobserve","w","h","ResizeObserver","observe","closest","customElements","whenDefined","then","manager","register","unregister","Region","_temp","segments","regionString","encode","full","join","decode","split","region","_start","_end","Error","isNaN","combineRegions","region1","region2","highlight","WithHighlight","_WithHighlight_initialOptions","_WithHighlight_fixedHighlight","highlightedRegion","fixedHighlight","ATTRIBUTES_THAT_TRIGGER_REFRESH","WithZoom","withMargin","withPosition","withResizable","updateScaleDomain","_initZoom","zoomed","_applyZoomTranslation","applyZoomTranslation","aboutToApply","requestAnimationFrame","zoom","_zoom","_svg","xScale","scaleLinear","domain","range","originXScale","copy","tmpXScale","translateExtent","d3zoom","scaleExtent","extent","event","ctrlKey","includes","d3Event","transform","rescaleX","dontDispatch","dispatchEvent","CustomEvent","detail","bubbles","cancelable","dx","zoomIdentity","scale","translate","zoomRefreshed","render","position","WithSVGHighlight","withZoom","withHighlight","createHighlightGroup","highlighted","highlighs","merge","exit","remove","HIGHLIGHT_EVENT","createEvent","withId","target","eventType","parentEvent","shiftKey","selectedId","protvistaFeatureId","rgb","tagName","classOrTarget","context","NightingaleElement","LitElement","display","lineHeight","createRenderRoot","centerx","_FeatureShape_ftWidth","_FeatureShape_getBrokenEnd","qh","_FeatureShape_ftHeight","_FeatureShape_getBrokenStart","_FeatureShape_ftLength","shape2function","rectangle","roundRectangle","line","bridge","diamond","chevron","catFace","triangle","wave","hexagon","pentagon","circle","arrow","doubleBar","discontinuosStart","discontinuos","discontinuosEnd","helix","strand","aaWidth","ftHeight","ftLength","shapeFn","isContinuous","toLowerCase","m","symbolSize","_FeatureShape_instances","_FeatureShape_getMiddleLine","getPolygon","sidesNumber","polygon","cos","PI","sin","sqrt","y","center","x","nw","round","loop","rl","margin","top","bottom","left","right","minHeight","featureHeight","featuresMap","_NonOverlappingLayout_rows","rowHeight","rowIndex","findIndex","row","featureOvelapsInRow","rowFeature","featuresOverlap","feature1","feature2","getOffset","rowNumber","config","CHAIN","tooltip","TRANSIT","INIT_MET","PROPEP","PEPTIDE","SIGNAL","HELIX","STRAND","TURN","DISULFID","CROSSLNK","REGION","COILED","MOTIF","REPEAT","CA_BIND","DNA_BIND","DOMAIN","ZN_FING","NP_BIND","METAL","SITE","BINDING","ACT_SITE","MOD_RES","LIPID","CARBOHYD","COMPBIAS","CONFLICT","NON_CONS","NON_TER","UNSURE","NON_STD","MUTAGEN","TOPO_DOM","TRANSMEM","INTRAMEM","VAR_SEQ","VARIANT","UNIQUE","NON_UNIQUE","ANTIGEN","PDBE_COVER","getShapeByType","toUpperCase","info","values","find","typeInfo","getColorByType","console","log","NightingaleTrack_1","withManager","FeatureShape","_NightingaleTrack_originalData","_NightingaleTrack_data","filters","_NightingaleTrack_highlighted","NonOverlappingLayout","obj","processData","applyFilters","defaultColor","fill","defaultShape","fragmentGroup","opacity","fragmentG","concat","acc2","e","firstUpdated","html","_templateObject","customElementOnce"],"sourceRoot":""}