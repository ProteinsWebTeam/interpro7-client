"use strict";(self.webpackChunkinterpro7_client=self.webpackChunkinterpro7_client||[]).push([[8759],{66888:(e,r,t)=>{t.d(r,{Z:()=>a}),t(73964);var i=t(75490);function s(e,r,t,i,s,n,a){try{var o=e[n](a),c=o.value}catch(e){return void t(e)}o.done?r(c):Promise.resolve(c).then(i,s)}function n(e){return function(){var r=this,t=arguments;return new Promise((function(i,n){var a=e.apply(r,t);function o(e){s(a,i,n,o,c,"next",e)}function c(e){s(a,i,n,o,c,"throw",e)}o(void 0)}))}}const a="ResizeObserver"in window?window.ResizeObserver:class{constructor(e){var r=this;if(this._handleResize=n((function*(){yield(0,i.Os)(),r._node&&r._onResizeEvent([{target:r._node,contentRect:r._node.getBoundingClientRect()}])})),"function"!=typeof e)throw new Error("missing resize handler");this._onResizeEvent=e}observe(e){if(!e instanceof HTMLElement)throw new Error("ResizeObserver only works on HTML elements");if(this._node)throw new Error("ResizeObserver fallback only supports one node");this._node=e,window.addEventListener("resize",this._handleResize),this._handleResize(),(0,i._v)(1e3).then(this._handleResize)}unobserve(e){if(this._node&&this._node!==e)throw new Error("Trying to unobserve the wrong node");this._node=null,window.removeEventListener("resize",this._handleResize)}}},12062:(e,r,t)=>{t.d(r,{Z:()=>l}),t(752),t(76265),t(60429);var i=t(67294),s=t(45697),n=t.n(s),a=t(66888),o=["children","element","measurements","updateCallback"];function c(){return c=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},c.apply(this,arguments)}class u extends i.PureComponent{constructor(e){super(e),this.state={},this._resizeObserver=new a.Z(this._handleResizeEvent.bind(this)),this._ref=i.createRef()}componentDidMount(){this._resizeObserver.observe(this._ref.current)}componentDidUpdate(){this.props.updateCallback&&this.props.updateCallback()}componentWillUnmount(){this._resizeObserver.unobserve(this._ref.current)}_handleResizeEvent(e){var r;for(var{target:t,contentRect:i}of e)t===this._ref.current&&(r=i);if(r){var s={},{measurements:n}=this.props;for(var a of(Array.isArray(n)||(n=[n]),n))s[a]=r[a];this.setState(s)}}render(){var e=this.props,{children:r,element:t}=e,s=function(e,r){if(null==e)return{};var t,i,s={},n=Object.keys(e);for(i=0;i<n.length;i++)t=n[i],r.indexOf(t)>=0||(s[t]=e[t]);return s}(e,o),n=t||"span";return i.createElement(n,c({},s,{ref:this._ref}),r(this.state))}}u.propTypes={element:n().string,children:n().func.isRequired,measurements:n().oneOfType([n().arrayOf(n().string).isRequired,n().string]),updateCallback:n().func};const l=u},8074:(e,r,t)=>{t.r(r),t.d(r,{default:()=>Y}),t(73964),t(60429),t(752),t(76265);var i=t(67294),s=t(64281),n=t(14572),a=t(30478),o=t(67306),c=t(7093),u=t(68845),l=t(71499),d=t(39153),h=t(92376),v=t(50527),p=t(69132),m=t(12062),f=t(76371);const w={"viewer-resizer":"Viewer_style__viewer-resizer___d3","structure-and-label":"Viewer_style__structure-and-label___d8","structure-viewer-ref":"Viewer_style__structure-viewer-ref___a9","structure-label":"Viewer_style__structure-label___ba"};var _=(0,f.Z)(w);const g=e=>{var[r,t]=(0,i.useState)();return(0,i.useEffect)((()=>{e.viewer&&e.viewer.behaviors.interaction.hover.subscribe((i=>{var s=i.current.loci;if("element-loci"===s.kind&&1===s.elements.length){var n=c.G$.Stats.ofLoci(s),{residueCount:a}=n;if(a>0){var o=n.firstResidueLoc,u={accession:o.unit.model.entryId,residue:c.kY.atom.label_comp_id(o),location:c.kY.residue.auth_seq_id(o),chain:c.kY.chain.auth_asym_id(o),seq_location:c.kY.residue.label_seq_id(o),seq_chain:c.kY.chain.label_asym_id(o)};u.accession.length>20&&(u.accession=e.accession),void 0!==r&&u.location===r.location||t(u)}}else t(void 0)}))}),[e.viewer]),r&&void 0!==r.location?i.createElement("div",{className:_("structure-label")},i.createElement("small",null,r.accession," "),"Chain: ",i.createElement("b",null,r.chain," "),"Residue: ",i.createElement("b",null,r.residue," "),r.location):i.createElement("div",{className:_("structure-label")})};var b=t(97684);function y(e,r,t,i,s,n,a){try{var o=e[n](a),c=o.value}catch(e){return void t(e)}o.done?r(c):Promise.resolve(c).then(i,s)}var S,C,R,P=(0,h.Il)(7829367),k=h.qe.create({listOrName:"turbo",domain:[1,0]}),E=b.P.create({label:"Colour by Residue pLDDT score",name:"basic-wrapper-residue-striping",getData:(S=function*(e){for(var r=new Map,t=e.entry.split("structure")[0]+"lddt",i=e.atomicHierarchy.residueAtomSegments.index,s=e.atomicHierarchy.atoms._rowCount,n=yield fetch(t),a=yield n.json(),o=0,c=s;o<c;o++)r.set(o,a[i[o]]);return{value:r}},C=function(){var e=this,r=arguments;return new Promise((function(t,i){var s=S.apply(e,r);function n(e){y(s,t,i,n,a,"next",e)}function a(e){y(s,t,i,n,a,"throw",e)}n(void 0)}))},function(e){return C.apply(this,arguments)}),coloring:{getColor:e=>k.color(e),defaultColor:P},getLabel:function(e){return"pLDDT: "+e}}),O=(t(76801),t(43843),t(87723)),I=t(62939),T=t(82650),V=t(83507),z=t(95477),D=t(82253),L=t(37942),x=function(e,r,t,i){return new(t||(t=Promise))((function(s,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function o(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var r;e.done?s(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(a,o)}c((i=i.apply(e,r||[])).next())}))};!function(e){function r(r,t){var i=function(e,r){if(T.rg.is(r.sourceData)&&r.sourceData.data.frame.categoryNames.includes(e)){var t=r.sourceData.data.frame.categories[e].getField("metric_value");if(t&&0!==t.rowCount)return{timestamp_utc:t.str(0)||(0,D._)(new Date)}}}("ma_qa_metric_local",t);if(i){var s=function(r){if(!T.rg.is(r.sourceData))throw new Error("Data format must be mmCIF.");return{residues:(0,I.sf)(e.Schema.local_metric_values,r.sourceData.data.frame.categories.ma_qa_metric_local)}}(t);return{info:i,data:function(e,r){for(var t=new Map,{label_asym_id:i,label_seq_id:s,metric_value:n,_rowCount:a}=r,o=[],u=0;u<a;u++){var l=n.value(u),d=e.atomicHierarchy.index.findResidue("1",i.value(u),s.value(u),""),h="Very low";l>50&&l<=70?h="Low":l>70&&l<=90?h="Medium":l>90&&(h="High"),t.set(d,[l,h]),(0,L.S8)(o,h)}return{score:c.X$.fromResidueMap(t),category:o}}(t,s.residues)}}}e.DefaultServerUrl="",e.isApplicable=function(e){return!!e},e.Schema={local_metric_values:{label_asym_id:O.sg.Schema.str,label_comp_id:O.sg.Schema.str,label_seq_id:O.sg.Schema.int,metric_id:O.sg.Schema.int,metric_value:O.sg.Schema.float,model_id:O.sg.Schema.int,ordinal_id:O.sg.Schema.int}},e.fromCif=r,e.fromCifOrServer=function(e,t){return x(this,void 0,void 0,(function*(){return{value:r(0,t)}}))},e.getConfidenceScore=function(e){if(!c.fb.isAtomic(e.unit))return[-1,"No Score"];var r=A.get(e.unit.model).value;if(!r||!r.data)return[-1,"No Score"];var t=e.unit.residueIndex[e.element];return r.data.score.has(t)?r.data.score.get(t):[-1,"No Score"]};var t=[];e.getCategories=function(e){if(!e)return t;var r=A.get(e.models[0]).value;return r&&r.data?r.data.category:t}}(R||(R={}));var N={serverUrl:l.e.Text(R.DefaultServerUrl,{description:"JSON API Server URL"})},A=V.c.createProvider({label:"AF Confidence Score",descriptor:(0,z.d)({name:"af_confidence_score"}),type:"static",defaultParams:N,getParams:e=>N,isApplicable:e=>R.isApplicable(e),obtain:(e,r)=>x(void 0,void 0,void 0,(function*(){return yield R.fromCifOrServer(e,r)}))}),M={"No Score":h.Il.fromRgb(170,170,170),"Very low":h.Il.fromRgb(255,125,69),Low:h.Il.fromRgb(255,219,19),Medium:h.Il.fromRgb(101,203,243),High:h.Il.fromRgb(0,83,214)},q={type:l.e.MappedStatic("score",{score:l.e.Group({}),category:l.e.Group({kind:l.e.Text()})})},j={name:"af-confidence",label:"AF Confidence",factory:function e(r,t){var i;if(r.structure&&!r.structure.isEmpty&&r.structure.models[0].customProperties.has(A.descriptor)){var s=R.getConfidenceScore;if("score"===t.type.name)i=e=>{if(c.G$.Location.is(e)){var r=s(e),t=r?r[1]:"No Score";return M[t]}return M["No Score"]};else{var n=t.type.params.kind;i=e=>{if(c.G$.Location.is(e)){var r=s(e);return(null==r?void 0:r[1])===n?M[r[1]]:M["No Score"]}return M["No Score"]}}}else i=()=>M["No Score"];return{factory:e,granularity:"group",color:i,props:t,description:"Assigns residue colors according to the AF Confidence score"}},getParams:e=>{var r=R.getCategories(e.structure);return 0===r.length?{type:l.e.MappedStatic("score",{score:l.e.Group({})})}:{type:l.e.MappedStatic("score",{score:l.e.Group({}),category:l.e.Group({kind:l.e.Select(r[0],l.e.arrayToOptions(r))},{isFlat:!0})})}},defaultValues:l.e.getDefaultValues(q),isApplicable:e=>{var r;return R.isApplicable(null===(r=e.structure)||void 0===r?void 0:r.models[0])},ensureCustomProperties:{attach:(e,r)=>r.structure?A.attach(e,r.structure.models[0],void 0,!0):Promise.resolve(),detach:e=>e.structure&&e.structure.models[0].customProperties.reference(A.descriptor,!1)},category:""},G=t(82806),U=function(e,r,t,i){return new(t||(t=Promise))((function(s,n){function a(e){try{c(i.next(e))}catch(e){n(e)}}function o(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var r;e.done?s(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(a,o)}c((i=i.apply(e,r||[])).next())}))},Z=(0,f.Z)(w,G.Z),F="mmcif";class H extends i.PureComponent{constructor(e){super(e),this.viewer=null,this.name=""+this.props.id,this._structureViewer=i.createRef(),this._structureViewerCanvas=i.createRef(),this.highlightColour=null,this.selections=null}componentDidMount(){return U(this,void 0,void 0,(function*(){if(!this.viewer){var e=Object.assign(Object.assign({},(0,s.u)()),{layout:{initial:{isExpanded:!1,showControls:!0}},config:[[n.OW.VolumeStreaming.Enabled,!1]]});this.viewer=new a.Z(e),yield this.viewer.init(),this._structureViewerCanvas.current&&this._structureViewer.current&&(this.viewer.initViewer(this._structureViewerCanvas.current,this._structureViewer.current),E.colorThemeProvider&&this.viewer.representation.structure.themes.colorThemeRegistry.add(E.colorThemeProvider),E.labelProvider&&this.viewer.managers.lociLabels.addProvider(E.labelProvider),this.viewer.customModelProperties.register(E.propertyProvider,!0),this.viewer.customModelProperties.register(A,!0),this.viewer.representation.structure.themes.colorThemeRegistry.add(j))}this.props.url?this.loadStructureInViewer(this.props.url,this.props.ext||F):this.loadStructureInViewer("https://www.ebi.ac.uk/pdbe/static/entry/"+this.name+"_updated.cif","mmcif")}))}componentDidUpdate(e){var r;this.name===""+this.props.id&&e.url===this.props.url||(this.name=""+this.props.id,this.props.url?this.loadStructureInViewer(this.props.url,this.props.ext||F):this.loadStructureInViewer("https://www.ebi.ac.uk/pdbe/static/entry/"+this.name+"_updated.cif","mmcif")),this.viewer&&(this.setSpin(this.props.isSpinning),this.props.shouldResetViewer&&(o.I.Camera.Reset(this.viewer,{}),this.clearSelections(),this.applyChainIdTheme(),this.props.onReset&&this.props.onReset()),((null===(r=this.props.selections)||void 0===r?void 0:r.length)||0)>0?this.highlightSelections(this.props.selections):(this.clearSelections(),this.applyChainIdTheme()))}loadStructureInViewer(e,r){requestAnimationFrame((()=>U(this,void 0,void 0,(function*(){try{if(this.viewer){yield this.viewer.clear();var t=yield this.viewer.builders.data.download({url:e},{state:{isGhost:!1}}),i=yield this.viewer.builders.structure.parseTrajectory(t,r),s=this.viewer.builders.structure.hierarchy.applyPreset(i,"default",{structure:{name:"model",params:{}},showUnitcell:!1,representationPreset:"auto"});s&&s.then((()=>{this.props.onStructureLoaded&&this.props.onStructureLoaded(),this.setSpin(this.props.isSpinning),this.applyChainIdTheme()}))}}catch(e){console.log("Molstar error",e)}}))))}setSpin(e){if(void 0===e&&(e=!1),this.viewer&&this.viewer.canvas3d){var r=this.viewer.canvas3d.props.trackball,t={settings:{trackball:Object.assign({},r)}};e&&(t.settings.trackball.animate={name:"spin",params:{}}),o.I.Canvas3D.SetSettings(this.viewer,t)}}highlightSelections(e){var r,t,i=this;if(this.viewer){var s=null===(t=null===(r=this.viewer.managers.structure.hierarchy.current.structures[0])||void 0===r?void 0:r.cell.obj)||void 0===t?void 0:t.data;s&&(this.clearSelections(),this.viewer.dataTransaction((()=>U(this,void 0,void 0,(function*(){var e,r;for(var t of(p.QG.value=l.e.Color(v.t.white),(null===(e=this.viewer)||void 0===e?void 0:e.managers.structure.hierarchy.current.structures)||[]))yield null===(r=this.viewer)||void 0===r?void 0:r.managers.structure.component.updateRepresentationsTheme(t.components,{color:p.bL.name})})))).then((()=>{if(this.viewer){var r=d.X.getStructureSelection((r=>{if(this.viewer){var t=[],s=!0,n=function(e){s&&(i.highlightColour!==e.color&&(i.highlightColour=e.color,o.I.Canvas3D.SetSettings(i.viewer,{settings:r=>{r.renderer.selectColor=(0,h.Il)(e.color),r.renderer.selectStrength=.8,r.marking.enabled=!1}})),s=!1);for(var n=[],a=e.start;a<=e.end;a++)n.push(a);t.push(r.struct.generator.atomGroups({"chain-test":r.core.rel.eq([e.chain,r.ammp("auth_asym_id")]),"residue-test":r.core.set.has([r.set(...n),r.ammp("auth_seq_id")])}))};for(var a of e)n(a);return r.struct.combinator.merge(t)}}),s),t=c.b8.toLociWithSourceUnits(r);this.viewer.managers.interactivity.lociSelects.select({loci:t})}})))}}applyChainIdTheme(){var e,r;switch(this.props.theme){case"residue":r=E.propertyProvider.descriptor.name;break;case"af":r=j.name;break;default:r=u.WT.name}null===(e=this.viewer)||void 0===e||e.dataTransaction((()=>U(this,void 0,void 0,(function*(){var e,t;for(var i of(null===(e=this.viewer)||void 0===e?void 0:e.managers.structure.hierarchy.current.structures)||[])yield null===(t=this.viewer)||void 0===t?void 0:t.managers.structure.component.updateRepresentationsTheme(i.components,{color:r})}))))}clearSelections(){var e,r;this.viewer&&(null===(r=null===(e=this.viewer.managers.structure.hierarchy.current.structures[0])||void 0===e?void 0:e.cell.obj)||void 0===r?void 0:r.data)&&this.viewer.managers.interactivity.lociSelects.deselectAll()}render(){return i.createElement(m.Z,{element:"div",updateCallback:()=>{this.viewer&&this.viewer.handleResize()},measurements:["width","height"],className:Z("viewer-resizer")},(()=>i.createElement("div",{className:Z("structure-and-label")},i.createElement("div",{id:this.props.elementId||"structure-viewer",ref:this._structureViewer,className:Z("structure-viewer-ref")},i.createElement("canvas",{ref:this._structureViewerCanvas})),i.createElement(g,{viewer:this.viewer,accession:this.name}))))}}const Y=H}}]);
//# sourceMappingURL=8759.module.structure-viewer.c64.js.map