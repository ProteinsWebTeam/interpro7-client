{"version":3,"file":"js/5562.module.5562.261.js","mappings":"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","sources":["webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-interpro-track/src/InterproEntryLayout.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-interpro-track/src/coverage/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-interpro-track/src/residues.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-interpro-track/src/nightingale-interpro-track.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-interpro-track/src/coverage/render.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-interpro-track/src/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/mixins/withDimensions/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/mixins/withPosition/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/mixins/withMargin/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/mixins/withResizable/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/mixins/withManager/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/utils/Region.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/mixins/withHighlight/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/mixins/withZoom/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/mixins/withHighlight/SVG/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/utils/bindEvents.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/utils/colors.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/decorators/customElementOnce.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/nightingale-base-element.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-new-core/src/index.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-track/src/FeatureShape.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-track/src/DefaultLayout.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-track/src/NonOverlappingLayout.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-track/src/config.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-track/src/ConfigHelper.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-track/src/nightingale-track.ts","webpack://interpro7-client/./node_modules/@nightingale-elements/nightingale-track/src/index.ts"],"sourcesContent":["/* eslint-disable no-param-reassign */\nimport {\n  DefaultLayout,\n  Feature,\n  FeatureLocation,\n  LayoutOptions,\n} from \"@nightingale-elements/nightingale-track\";\n\nexport const COLLAPSED_HEIGHT = 16;\nexport const EXPANDED_HEIGHT = 14;\nexport const CHILD_HEIGHT = 10;\n\nexport type ResidueLocation = FeatureLocation & {\n  length: number;\n  accession: string;\n  feature: InterProFeature;\n  description: string;\n};\nexport type Residue = {\n  accession: string;\n  locations: Array<ResidueLocation>;\n  feature: InterProFeature;\n  location: ResidueLocation;\n  i: number;\n  j: number;\n};\n\nexport type InterProFeature = Feature & {\n  residues: Residue[];\n  expanded?: boolean;\n  i?: number;\n  j?: number;\n  k?: number;\n};\n\nexport default class InterproEntryLayout extends DefaultLayout {\n  #heightMap = new Map<string, number>();\n  #yPositionMap = new Map<string, number>();\n  maxYPos = 0;\n  expanded = false;\n  padding = 1;\n\n  constructor({\n    expanded,\n    padding,\n    ...otherOptions\n  }: LayoutOptions & { expanded: boolean; padding: number }) {\n    super(otherOptions);\n    this.expanded = expanded;\n    this.padding = padding;\n  }\n\n  init(features: InterProFeature[], children?: InterProFeature[]) {\n    let yPos = 0;\n    this.#heightMap = new Map();\n    this.#yPositionMap = new Map();\n    this.maxYPos = 0;\n    if (!features) return;\n    const innerPadding = (COLLAPSED_HEIGHT - CHILD_HEIGHT) / 2;\n    const residuesPos: Record<\n      string,\n      Record<string, Record<string, { height: number; yPos: number }>>\n    > = {};\n    for (let k = 0; k < features.length; k++) {\n      const feature = features[k];\n      const isCollapsible = feature?.residues?.length || children?.length;\n      this.#heightMap.set(\n        feature.accession,\n        isCollapsible && !this.expanded ? COLLAPSED_HEIGHT : EXPANDED_HEIGHT,\n      );\n      this.#yPositionMap.set(feature.accession, this.padding);\n      yPos = (this.#heightMap.get(feature.accession) || 0) + 2 * this.padding;\n      this.maxYPos = Math.max(this.maxYPos, yPos);\n      if (!(feature.accession in residuesPos))\n        residuesPos[feature.accession] = {};\n      if (feature.residues)\n        yPos = this.#initResidues(\n          feature.residues,\n          feature.accession,\n          this.expanded ? yPos : this.#yPositionMap.get(feature.accession) || 0,\n          k,\n          innerPadding,\n          feature.locations,\n          residuesPos,\n          this.expanded,\n        );\n    }\n    if (children)\n      for (let k = 0; k < children.length; k++) {\n        const child: InterProFeature = children[k];\n        if (!this.#heightMap.has(child.accession)) {\n          this.#heightMap.set(child.accession, CHILD_HEIGHT);\n          this.#yPositionMap.set(\n            child.accession,\n            (this.expanded ? this.maxYPos : innerPadding) + this.padding,\n          );\n          yPos += this.expanded\n            ? 2 * this.padding +\n              (this.#heightMap.get(child.accession) || EXPANDED_HEIGHT)\n            : 0;\n          this.maxYPos = Math.max(this.maxYPos, yPos);\n        }\n        if (!(child.accession in residuesPos))\n          residuesPos[child.accession] = {};\n        if (child.residues) {\n          yPos = this.#initResidues(\n            child.residues,\n            child.accession,\n            child.expanded\n              ? yPos\n              : this.#yPositionMap.get(child.accession) || 0,\n            k,\n            innerPadding,\n            child.locations,\n            residuesPos,\n            this.expanded && child.expanded,\n          );\n        }\n      }\n    this.maxYPos += this.padding;\n  }\n\n  #initResidues(\n    residues: Residue[],\n    featureAcc: string,\n    yPos: number,\n    k: number,\n    innerPadding: number,\n    locs?: FeatureLocation[],\n    residuesPos: Record<\n      string,\n      Record<string, Record<string, { height: number; yPos: number }>>\n    > = {},\n    expanded = true,\n  ) {\n    for (let i = 0; i < residues.length; i++) {\n      const resGroup = residues[i];\n      InterproEntryLayout.filterOutResidueFragmentsOutOfLocation(\n        resGroup,\n        locs || [],\n      );\n      if (!(resGroup.accession in residuesPos[featureAcc]))\n        residuesPos[featureAcc][resGroup.accession] = {};\n      for (let j = 0; j < resGroup.locations.length; j++) {\n        const desc = resGroup.locations[j].description;\n        if (!(desc in residuesPos[featureAcc][resGroup.accession])) {\n          residuesPos[featureAcc][resGroup.accession][desc] = {\n            height: expanded\n              ? CHILD_HEIGHT\n              : (this.#heightMap.get(featureAcc) || EXPANDED_HEIGHT) -\n                2 * innerPadding,\n            yPos: expanded ? this.maxYPos + this.padding : yPos + innerPadding,\n          };\n          yPos = expanded\n            ? this.maxYPos + 2 * this.padding + CHILD_HEIGHT\n            : yPos;\n        }\n        this.#heightMap.set(\n          `${resGroup.accession}_${k}_${i}_${j}`,\n          residuesPos[featureAcc][resGroup.accession][desc].height,\n        );\n        this.#yPositionMap.set(\n          `${resGroup.accession}_${k}_${i}_${j}`,\n          residuesPos[featureAcc][resGroup.accession][desc].yPos,\n        );\n        this.maxYPos = Math.max(this.maxYPos, yPos);\n      }\n    }\n    return expanded ? yPos : this.maxYPos + 2 * this.padding;\n  }\n\n  static filterOutResidueFragmentsOutOfLocation(\n    residue: Residue,\n    featureLocations: FeatureLocation[],\n  ) {\n    residue.locations.forEach(\n      (locRes) =>\n        (locRes.fragments = locRes.fragments.filter((fragRes) =>\n          featureLocations.some((loc) =>\n            loc.fragments.some(\n              (frag) => fragRes.start >= frag.start && fragRes.end <= frag.end,\n            ),\n          ),\n        )),\n    );\n    residue.locations = residue.locations.filter(\n      (locRes) => locRes.fragments.length,\n    );\n  }\n\n  static getAccFromFeature(feature: Feature | string) {\n    let acc = \"\";\n    if (typeof feature === \"string\") {\n      acc = feature;\n    } else if (feature.accession) {\n      acc = feature.accession;\n    }\n    return acc;\n  }\n\n  getFeatureYPos(feature: Feature | string) {\n    const acc = InterproEntryLayout.getAccFromFeature(feature);\n    return this.#yPositionMap.get(acc) || 0;\n  }\n\n  getFeatureHeight(feature: Feature | string) {\n    const acc = InterproEntryLayout.getAccFromFeature(feature);\n    return this.#heightMap.get(acc) || 0;\n  }\n}\n","import { Feature } from \"@nightingale-elements/nightingale-track\";\n\nexport type Segment = {\n  start: number;\n  end: number;\n  value?: number;\n};\nexport const addContributor = (contributor: Segment, coverage: Segment[]) => {\n  let toContribute: Segment | null = { value: 1, ...contributor };\n  const newCoverage = [];\n  for (const segment of coverage) {\n    if (!toContribute) {\n      newCoverage.push(segment);\n      // Segment to contribute is before the current segment\n      // __|--TC--|__||--S--||__\n    } else if (toContribute.end < segment.start) {\n      newCoverage.push(toContribute);\n      toContribute = null;\n      newCoverage.push(segment);\n      // Segment to contribute contains the segment\n      // __|--TC-||==S==||-|__\n    } else if (\n      toContribute.start < segment.start &&\n      toContribute.end >= segment.end\n    ) {\n      newCoverage.push({\n        start: toContribute.start,\n        end: segment.start - 1,\n        value: toContribute.value,\n      });\n      newCoverage.push({\n        start: segment.start,\n        end: segment.end,\n        value: (segment.value || 0) + (toContribute?.value || 0),\n      });\n      toContribute =\n        segment.end === toContribute.end\n          ? null\n          : {\n              start: segment.end + 1,\n              end: toContribute.end,\n              value: toContribute.value,\n            };\n      // Segment to contribute is contained by the segment\n      // __||--S-|==TC==|-||__\n    } else if (\n      segment.start < toContribute.start &&\n      segment.end > toContribute.end\n    ) {\n      newCoverage.push({\n        start: segment.start,\n        end: toContribute.start - 1,\n        value: segment.value,\n      });\n      newCoverage.push({\n        start: toContribute.start,\n        end: toContribute.end,\n        value: (segment.value || 0) + (toContribute?.value || 0),\n      });\n      newCoverage.push({\n        start: toContribute.end + 1,\n        end: segment.end,\n        value: segment.value,\n      });\n      toContribute = null;\n      // Segment to contribute overlaps at the end of the segment\n      // __||--S--|==||--TC--|__\n    } else if (\n      segment.end >= toContribute.start &&\n      segment.end <= toContribute.end\n    ) {\n      if (segment.start < toContribute.start)\n        newCoverage.push({\n          start: segment.start,\n          end: toContribute.start - 1,\n          value: segment.value,\n        });\n      newCoverage.push({\n        start: toContribute.start,\n        end: segment.end,\n        value: (segment.value || 0) + (toContribute?.value || 0),\n      });\n      toContribute =\n        segment.end < toContribute.end\n          ? {\n              start: segment.end + 1,\n              end: toContribute.end,\n              value: toContribute.value,\n            }\n          : null;\n      // Segment to contribute overlaps at the beggining of the segment\n      // __|--TC--||==|--S--||__\n    } else if (\n      toContribute.end >= segment.start &&\n      toContribute.end < segment.end\n    ) {\n      newCoverage.push({\n        start: toContribute.start,\n        end: segment.start - 1,\n        value: toContribute.value,\n      });\n      newCoverage.push({\n        start: segment.start,\n        end: toContribute.end,\n        value: (segment.value || 0) + (toContribute?.value || 0),\n      });\n      newCoverage.push({\n        start: toContribute.end + 1,\n        end: segment.end,\n        value: segment.value,\n      });\n      toContribute = null;\n    } else {\n      newCoverage.push(segment);\n    }\n\n    // position++;\n  }\n  if (toContribute) newCoverage.push(toContribute);\n  return newCoverage;\n};\n\nexport const getCoverage = (\n  contributors: Feature[],\n  length = 100,\n  createEmptyFragments = true,\n) => {\n  let coverage: Segment[] = [];\n  if (createEmptyFragments) {\n    coverage = addContributor({ start: 1, end: length, value: 0 }, coverage);\n  }\n  contributors.forEach((f) =>\n    f.locations?.forEach((loc) =>\n      loc.fragments.forEach((fr) => {\n        coverage = addContributor(fr, coverage);\n      }),\n    ),\n  );\n  return coverage;\n};\n","import { Selection } from \"d3\";\nimport NightingaleElement, {\n  bindEvents,\n} from \"@nightingale-elements/nightingale-new-core\";\n\nimport { InterProFeature, ResidueLocation } from \"./InterproEntryLayout\";\n\nconst MAX_OPACITY_WHILE_COLAPSED = 0.8;\n\nexport type ResidueDatum = {\n  accession: string;\n  feature: InterProFeature;\n  location: ResidueLocation;\n  i: number;\n  j: number;\n  k?: number;\n  fragments: {\n    start: number;\n    end: number;\n  }[];\n  start?: number;\n  end?: number;\n  length: number;\n  description: string;\n};\n\nexport type ResidueGroup = Selection<\n  SVGGElement,\n  ResidueDatum,\n  HTMLElement | SVGElement | null,\n  unknown\n>;\ntype BaseGroup = Selection<\n  SVGGElement,\n  InterProFeature,\n  HTMLElement | SVGElement | null,\n  unknown\n>;\nexport const createResidueGroup = (baseG: BaseGroup) => {\n  return baseG\n    .selectAll(\"g.residues-group\")\n    .data(\n      (d) =>\n        (d as InterProFeature).residues?.map((r, i) => ({\n          ...r,\n          feature: d,\n          i,\n        })) || [],\n    )\n    .enter()\n    .append(\"g\")\n    .attr(\"class\", \"residues-group\")\n    .selectAll(\"g.residues-locations\")\n    .data((d) =>\n      d.locations.map((loc, j) => ({\n        ...loc,\n        accession: d.accession,\n        feature: d.feature as InterProFeature,\n        location: loc,\n        i: d.i,\n        j,\n      })),\n    )\n    .enter()\n    .append(\"g\")\n    .attr(\"class\", \"residues-locations\");\n};\n\nexport const createResiduePaths = ({\n  baseG,\n  getResidueShape,\n  getResidueTransform,\n  getResidueFill,\n  element,\n}: {\n  baseG: ResidueGroup;\n  getResidueShape: (x: ResidueDatum) => string;\n  getResidueTransform: (x: ResidueDatum) => string;\n  getResidueFill: (x: ResidueDatum) => string;\n  element: NightingaleElement;\n}) => {\n  return baseG\n    .selectAll<SVGPathElement, ResidueDatum>(\"path.residue\")\n    .data((d) =>\n      d.fragments.map(\n        (loc) =>\n          ({\n            ...loc,\n            accession: d.accession,\n            feature: {\n              ...d.feature,\n              currentResidue: { ...loc, description: d.location.description },\n            } as InterProFeature,\n            location: d.location,\n            k: d.feature.k,\n            i: d.i,\n            j: d.j,\n          }) as ResidueDatum,\n      ),\n    )\n    .enter()\n    .append(\"path\")\n    .attr(\"class\", \"feature rectangle residue\")\n    .attr(\"d\", getResidueShape)\n    .attr(\"transform\", getResidueTransform)\n    .attr(\"fill\", getResidueFill)\n    .attr(\"stroke\", \"transparent\")\n    .call(bindEvents, element);\n};\n\nexport const refreshResiduePaths = ({\n  baseG,\n  expanded,\n  getResidueShape,\n  getResidueTransform,\n  getResidueFill,\n}: {\n  baseG: ResidueGroup;\n  expanded: boolean;\n  getResidueShape: (x: ResidueDatum) => string;\n  getResidueTransform: (x: ResidueDatum) => string;\n  getResidueFill: (x: ResidueDatum) => string;\n}) => {\n  const paths = baseG.selectAll<SVGPathElement, ResidueDatum>(\"path.residue\");\n  const numberOfSibillings = new Set(\n    paths\n      .data()\n      .map((f) => `${f.feature?.accession}-${f.location?.description}`),\n  ).size;\n  paths\n    .attr(\"d\", getResidueShape)\n    .attr(\"transform\", getResidueTransform)\n    .style(\"pointer-events\", (f) =>\n      expanded || (f.feature && f.feature.expanded) ? \"auto\" : \"none\",\n    )\n    .style(\"stroke\", () => (expanded ? null : \"none\"))\n    .style(\"opacity\", () =>\n      expanded ? null : MAX_OPACITY_WHILE_COLAPSED / numberOfSibillings,\n    )\n    .attr(\"fill\", getResidueFill);\n};\n","import { customElement, property } from \"lit/decorators.js\";\nimport { Selection, select } from \"d3\";\nimport _get from \"lodash-es/get\";\nimport { Feature } from \"@nightingale-elements/nightingale-track\";\n\nimport {\n  bindEvents,\n  contrastingColor,\n} from \"@nightingale-elements/nightingale-new-core\";\nimport NightingaleTrack from \"@nightingale-elements/nightingale-track\";\nimport InterproEntryLayout, { InterProFeature } from \"./InterproEntryLayout\";\nimport { getCoverage, Segment } from \"./coverage\";\nimport {\n  ResidueGroup,\n  ResidueDatum,\n  createResidueGroup,\n  createResiduePaths,\n  refreshResiduePaths,\n} from \"./residues\";\nimport { createCoverage, refreshCoverage } from \"./coverage/render\";\n\nexport type BaseGroup = Selection<\n  SVGGElement,\n  InterProFeature,\n  HTMLElement | SVGElement | null,\n  unknown\n>;\nexport type LabelGroup = Selection<\n  SVGTextContentElement,\n  InterProFeature,\n  HTMLElement | SVGElement | null,\n  unknown\n>;\n\nconst MAX_OPACITY_WHILE_COLAPSED = 0.8;\n\nconst colorCache: Record<string, number[] | null> = {};\n\nfunction colorKeywordToRGB(colorKeyword: string) {\n  if (colorCache[colorKeyword]) return colorCache[colorKeyword];\n\n  const el = document.createElement(\"div\");\n  el.style.color = colorKeyword;\n  document.body.appendChild(el);\n  const rgbValue = window.getComputedStyle(el).color;\n  document.body.removeChild(el);\n  const res = rgbValue?.match(/[.\\d]+/g)?.map(Number) || null;\n  colorCache[colorKeyword] = res;\n  return res;\n}\n\n@customElement(\"nightingale-interpro-track\")\nclass NightingaleInterproTrack extends NightingaleTrack {\n  @property({ type: Boolean })\n  expanded?: boolean = false;\n  @property({ type: Boolean })\n  \"show-label\"?: boolean = false;\n  @property({ type: String })\n  label?: string | null = null;\n\n  layout = undefined;\n  protected layoutObj?: InterproEntryLayout;\n  #contributors?: InterProFeature[];\n  #coverage?: Segment[];\n  #haveCreatedFeatures = false;\n\n  #childrenG?: Selection<\n    SVGGElement,\n    unknown,\n    HTMLElement | SVGElement | null,\n    unknown\n  >;\n  #featuresG?: BaseGroup;\n  #residuesG?: ResidueGroup;\n  #childResiduesG?: ResidueGroup;\n  accession?: string;\n\n  constructor() {\n    super();\n    this[\"margin-top\"] = 2;\n    this[\"margin-bottom\"] = 2;\n  }\n\n  protected createTrack() {\n    if (!this.layoutObj) return;\n    this.layoutObj.expanded = !!this.expanded;\n    this.#childrenG = undefined;\n    super.createTrack();\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.#haveCreatedFeatures = false;\n  }\n\n  attributeChangedCallback(\n    name: string,\n    oldValue: string | null,\n    newValue: string | null,\n  ): void {\n    super.attributeChangedCallback(name, oldValue, newValue);\n    if (name === \"expanded\" && oldValue !== newValue && this.#contributors) {\n      for (const c of this.#contributors) {\n        c.expanded = !oldValue;\n      }\n    }\n  }\n\n  set contributors(contributors: InterProFeature[]) {\n    this.#contributors = NightingaleInterproTrack.normalizeLocations(\n      contributors,\n    ) as InterProFeature[];\n    this.#coverage = getCoverage(this.#contributors, this.length);\n    if (this.data) this.createTrack();\n  }\n\n  getLayout() {\n    return new InterproEntryLayout({\n      layoutHeight: this.height,\n      expanded: !!this.expanded,\n      padding: (this[\"margin-top\"] + this[\"margin-bottom\"]) / 2,\n    });\n  }\n\n  protected createFeatures() {\n    if (!this.seqG) return;\n    this.layoutObj?.init(this.data as InterProFeature[], this.#contributors);\n    // eslint-disable-next-line\n    this.data.forEach((d, i) => ((d as InterProFeature).k = i));\n    this.#featuresG = this.seqG\n      .selectAll<SVGGElement, InterProFeature>(\"g.feature-group\")\n      .data(this.data as InterProFeature[])\n      .enter()\n      .append(\"g\")\n      .attr(\"class\", \"feature-group\")\n      .attr(\"id\", (d) => `g_${d.accession}`);\n\n    const locations = this.#featuresG\n      .selectAll(\"g.location-group\")\n      .data((d) => d.locations?.map((loc) => ({ ...loc, feature: d })) || [])\n      .enter()\n      .append(\"g\")\n      .attr(\"class\", \"location-group\")\n      .style(\"cursor\", this.#contributors ? \"pointer\" : \"default\");\n\n    locations\n      .selectAll(\"line.cover\")\n      .data((d) => [\n        d.fragments.reduce(\n          (agg, v) => ({\n            start: Math.min(agg.start, v.start),\n            end: Math.max(agg.end, v.end),\n            feature: d.feature,\n          }),\n          { start: Infinity, end: -Infinity },\n        ),\n      ])\n      .enter()\n      .append(\"line\")\n      .attr(\"class\", \"cover\");\n\n    locations\n      .selectAll(\"path.feature\")\n      .data((d) =>\n        d.fragments.map((loc) => ({\n          ...loc,\n          feature: d.feature,\n          fragments: d.fragments,\n        })),\n      )\n      .enter()\n      .append(\"path\")\n      .attr(\"class\", (f) => `${this.getShape(f)} feature`)\n      .on(\"click.expanded\", () => {\n        if (this.expanded) this.removeAttribute(\"expanded\");\n        else this.setAttribute(\"expanded\", \"expanded\");\n      })\n      .call(bindEvents, this);\n\n    locations\n      .selectAll(\"text.feature-label\")\n      .data((d) =>\n        d.fragments.map((loc) => ({\n          ...loc,\n          feature: d.feature,\n          fragments: d.fragments,\n        })),\n      )\n      .enter()\n      .append(\"text\")\n      .attr(\"class\", \"feature-label\")\n      .attr(\"dominant-baseline\", \"middle\")\n      .attr(\"text-anchor\", \"middle\")\n      .style(\"cursor\", \"inherit\")\n      .style(\"pointer-events\", \"none\");\n\n    this.#residuesG = createResidueGroup(this.#featuresG);\n    createResiduePaths({\n      baseG: this.#residuesG,\n      getResidueShape: (d) => this.getResidueShape(d),\n      getResidueTransform: (d) => this.getResidueTransform(d),\n      getResidueFill: (d) => this.getResidueFill(d, !!this.expanded),\n      element: this,\n    });\n\n    if (this.#contributors) {\n      // eslint-disable-next-line\n      this.#contributors.forEach((d, i) => (d.k = i));\n      if (!this.#childrenG)\n        this.#childrenG = this.svg\n          ?.append(\"g\")\n          .attr(\"class\", \"children-features\");\n\n      const childrenGroup = this.#childrenG\n        ?.append(\"g\")\n        .attr(\"class\", \"children-group\");\n      const childGroup = childrenGroup\n        ?.selectAll(\"g.child-group\")\n        .data(this.#contributors)\n        .enter()\n        .append(\"g\")\n        .attr(\"class\", \"child-group\");\n      if (!childGroup) return;\n      const locationChildrenG = childGroup\n        .selectAll(\"g.child-location-group\")\n        .data((d) => {\n          // eslint-disable-next-line\n          d.expanded = this.expanded;\n          return (d.locations || []).map((loc) => ({ ...loc, feature: d }));\n        })\n        .enter()\n        .append(\"g\")\n        .attr(\"class\", (_, i) => `child-location-group clg-${i}`);\n\n      locationChildrenG\n        ?.selectAll(\"line.cover\")\n        .data((d) => [\n          d.fragments.reduce(\n            (agg, v) => ({\n              start: Math.min(agg.start, v.start),\n              end: Math.max(agg.end, v.end),\n              feature: d.feature,\n            }),\n            { start: Infinity, end: -Infinity },\n          ),\n        ])\n        .enter()\n        .append(\"line\")\n        .attr(\"class\", \"cover\");\n\n      locationChildrenG\n        ?.selectAll(\"path.child-fragment\")\n        .data((d) =>\n          d.fragments.map((fragment) => ({\n            ...fragment,\n            feature: d.feature,\n            fragments: d.fragments,\n          })),\n        )\n        .enter()\n        .append(\"path\")\n        .attr(\"class\", (f) => `${this.getShape(f)} child-fragment feature`)\n        .call(bindEvents, this)\n        .on(\"click.expanded\", (_event, f) => {\n          // eslint-disable-next-line\n          f.feature.expanded = !f.feature.expanded;\n          this.refresh();\n        });\n      locationChildrenG\n        .selectAll(\"text.child-label\")\n        .data((d) =>\n          d.fragments.map((fragment) => ({\n            ...fragment,\n            feature: d.feature,\n            fragments: d.fragments,\n          })),\n        )\n        .enter()\n        .append(\"text\")\n        .attr(\"class\", \"child-label\")\n        .attr(\"dominant-baseline\", \"middle\")\n        .attr(\"text-anchor\", \"middle\")\n        .style(\"cursor\", \"default\")\n        .style(\"pointer-events\", \"none\");\n\n      this.#childResiduesG = createResidueGroup(childGroup);\n      // this.child_residuesLoc =\n      createResiduePaths({\n        baseG: this.#childResiduesG,\n        getResidueShape: (d) => this.getResidueShape(d),\n        getResidueTransform: (d) => this.getResidueTransform(d),\n        getResidueFill: (d) => this.getResidueFill(d, !!d.feature?.expanded),\n        element: this,\n      });\n      if (this.#coverage?.length)\n        createCoverage({\n          element: this,\n          coverage: this.#coverage,\n        });\n    }\n    this.svg?.attr(\n      \"height\",\n      (this.layoutObj?.maxYPos || 0) + this[\"margin-bottom\"],\n    );\n    this.#haveCreatedFeatures = true;\n  }\n  private getResidueShape(f: ResidueDatum) {\n    return this.featureShape.getFeatureShape(\n      this.getSingleBaseWidth(),\n      this.layoutObj?.getFeatureHeight(`${f.accession}_${f.k}_${f.i}_${f.j}`) ||\n        0,\n      f.end && f.start ? f.end - f.start + 1 : 1,\n      \"rectangle\",\n    );\n  }\n  private getResidueTransform(f: ResidueDatum) {\n    return `translate(${this.getXFromSeqPosition(f.start || 1)},${\n      this[\"margin-top\"] +\n      (this.layoutObj?.getFeatureYPos(`${f.accession}_${f.k}_${f.i}_${f.j}`) ||\n        0)\n    })`;\n  }\n  private getResidueFill(f: ResidueDatum, expanded: boolean) {\n    return expanded ? this.getFeatureColor(f) : \"white\";\n  }\n\n  private getTextLabel(datum: Feature) {\n    if (this.label?.length) {\n      if (this.label.startsWith(\".\")) {\n        return _get(datum, this.label.slice(1), null);\n      }\n      return this.label;\n    }\n    return datum?.feature?.accession || null;\n  }\n\n  private refreshLabels(base: LabelGroup, padding = 2) {\n    base\n      .attr(\"x\", (f) => {\n        const start = getVisibleStart(this[\"display-start\"], f.start);\n        const end = getVisibleEnd(this[\"display-end\"], f.end, this.length);\n        return this.getXFromSeqPosition(start + (end - start) / 2 || 1);\n      })\n      .attr(\n        \"y\",\n        (f) =>\n          this[\"margin-top\"] +\n          (this.layoutObj?.getFeatureYPos(f.feature as Feature) || 0) +\n          (this.layoutObj?.getFeatureHeight(f.feature as Feature) || 0) / 2,\n      )\n      .attr(\"fill\", (f, i, nodes) => {\n        const element = nodes[i];\n        const firstPath = element.parentElement?.querySelector(\"path.feature\");\n\n        if (firstPath) {\n          return contrastingColor(\n            colorKeywordToRGB(this.getFeatureFillColor(f)),\n          );\n        }\n        return null;\n      })\n      .attr(\n        \"font-size\",\n        (f) =>\n          (this.layoutObj?.getFeatureHeight(f.feature as Feature) || 2) -\n          padding,\n      )\n      .text((d) => (this[\"show-label\"] ? this.getTextLabel(d) : null))\n      .each(\n        wrap(\n          this[\"display-start\"],\n          this[\"display-end\"],\n          this[\"length\"],\n          (n) => this.getXFromSeqPosition(n),\n          (feature) => this.layoutObj?.getFeatureHeight(feature) || 0,\n        ),\n      );\n  }\n  private refreshFeatures(base: BaseGroup, expanded = true) {\n    const numberOfSibillings = new Set(\n      base.data().map((f) => f.feature?.accession),\n    ).size;\n    base\n      .attr(\"d\", (f) =>\n        this.featureShape.getFeatureShape(\n          this.getSingleBaseWidth(),\n          this.layoutObj?.getFeatureHeight(f.feature || \"\") || 0,\n          f.end && f.start ? f.end - f.start + 1 : 1,\n          expanded\n            ? this.getShape(f.shape ? f : (f.feature as Feature))\n            : \"rectangle\",\n        ),\n      )\n      .style(\"fill\", (f) =>\n        expanded ? this.getFeatureColor(f.feature as Feature) : \"white\",\n      )\n      .attr(\n        \"opacity\",\n        expanded ? 1 : MAX_OPACITY_WHILE_COLAPSED / numberOfSibillings,\n      )\n      .style(\"stroke\", (f) =>\n        expanded ? this.getFeatureColor(f.feature as Feature) : \"none\",\n      )\n      .attr(\n        \"transform\",\n        (f) =>\n          `translate(${this.getXFromSeqPosition(f.start || 1)},${\n            this[\"margin-top\"] +\n            (this.layoutObj?.getFeatureYPos(f.feature as Feature) || 0)\n          })`,\n      )\n      .style(\"pointer-events\", expanded ? \"auto\" : \"none\");\n  }\n\n  private refreshCoverLine(base: BaseGroup, expanded = true) {\n    base\n      .attr(\"x1\", (f) => this.getXFromSeqPosition(f.start || 1))\n      .attr(\"x2\", (f) => this.getXFromSeqPosition((f.end || 0) + 1))\n      .attr(\n        \"y1\",\n        (f) =>\n          this[\"margin-top\"] +\n          (this.layoutObj?.getFeatureYPos(f.feature as Feature) || 0) +\n          (this.layoutObj?.getFeatureHeight(f.feature as Feature) || 0) / 2,\n      )\n      .attr(\n        \"y2\",\n        (f) =>\n          this[\"margin-top\"] +\n          (this.layoutObj?.getFeatureYPos(f.feature as Feature) || 0) +\n          (this.layoutObj?.getFeatureHeight(f.feature as Feature) || 0) / 2,\n      )\n      .attr(\"stroke\", (f) => this.getFeatureColor(f.feature as Feature))\n      .attr(\"visibility\", expanded ? \"visible\" : \"hidden\");\n  }\n\n  refresh() {\n    if (this.#haveCreatedFeatures && this.layoutObj) {\n      this.layoutObj.expanded = !!this.expanded;\n      this.layoutObj.init(this.data as InterProFeature[], this.#contributors);\n      this.height = this.layoutObj.maxYPos;\n\n      this.refreshCoverLine(\n        this.#featuresG?.selectAll(\"g.location-group line.cover\") as BaseGroup,\n      );\n      this.refreshFeatures(\n        this.#featuresG?.selectAll(\n          \"g.location-group path.feature\",\n        ) as BaseGroup,\n      );\n      this.refreshLabels(\n        this.#featuresG?.selectAll(\n          \"g.location-group text.feature-label\",\n        ) as LabelGroup,\n      );\n\n      // this.#residuesG?.attr(\"visibility\", this.expanded ? \"visible\" : \"hidden\");\n      if (this.#residuesG)\n        refreshResiduePaths({\n          baseG: this.#residuesG,\n          expanded: !!this.expanded,\n          getResidueShape: (d) => this.getResidueShape(d),\n          getResidueTransform: (d) => this.getResidueTransform(d),\n          getResidueFill: (d) => this.getResidueFill(d, !!this.expanded),\n        });\n\n      if (this.#contributors) {\n        const childrenGroup = this.#childrenG?.select(\"g.children-group\");\n        childrenGroup?.attr(\"visibility\", this.expanded ? \"visible\" : \"hidden\");\n        const childGroup = childrenGroup?.selectAll(\"g.child-group\");\n        const locationChildrenG = childGroup?.selectAll(\n          \"g.child-location-group\",\n        );\n        const coverLinesChildren = locationChildrenG?.selectAll(\"line.cover\");\n        const featureChildren = locationChildrenG?.selectAll(\n          \"path.child-fragment\",\n        );\n\n        this.refreshCoverLine(\n          coverLinesChildren as unknown as BaseGroup,\n          this.expanded,\n        );\n        this.refreshFeatures(\n          featureChildren as unknown as BaseGroup,\n          this.expanded,\n        );\n        this.refreshLabels(\n          childGroup?.selectAll(\n            \"g.child-location-group text.child-label\",\n          ) as LabelGroup,\n          0,\n        );\n\n        this.#childResiduesG?.attr(\"visibility\", () =>\n          this.expanded ? \"visible\" : \"hidden\",\n        );\n        if (this.#childResiduesG)\n          refreshResiduePaths({\n            baseG: this.#childResiduesG,\n            expanded: !!this.expanded,\n            getResidueShape: (d) => this.getResidueShape(d),\n            getResidueTransform: (d) => this.getResidueTransform(d),\n            getResidueFill: (d) =>\n              this.getResidueFill(d, !!d.feature?.expanded),\n          });\n\n        if (this.#coverage?.length)\n          refreshCoverage({\n            element: this,\n            featuresG: this.#featuresG,\n            contributorsLength: this.#contributors?.length,\n          });\n      }\n      this.svg?.attr(\"height\", this.layoutObj.maxYPos + this[\"margin-bottom\"]);\n\n      this.updateHighlight();\n\n      this.renderMarginOnGroup(this.margins);\n    }\n  }\n}\nfunction wrap(\n  displayStart: number | undefined,\n  displayEnd: number | undefined,\n  length: number | undefined,\n  getXFromSeqPosition: (x: number) => number,\n  getFeatureHeight: (feature: Feature) => number,\n) {\n  function wrapFn(this: SVGTextContentElement, feature: InterProFeature) {\n    const self = select(this);\n    const start = getVisibleStart(displayStart, feature.start);\n    const end = getVisibleEnd(displayEnd, feature.end, length);\n    const width = getXFromSeqPosition(end) - getXFromSeqPosition(start);\n    const padding = getFeatureHeight(feature.feature as Feature) / 2;\n    let textLength = self.node()?.getComputedTextLength?.() || 0;\n    let text = self.text();\n    while (textLength > width - 2 * padding && text.length > 0) {\n      text = text.slice(0, -1);\n      self.text(text.length ? text + \"\\u2026\" : \"\");\n      textLength = self.node()?.getComputedTextLength() || 0;\n    }\n  }\n  return wrapFn;\n}\n\nfunction getVisibleStart(\n  displayStart: number | undefined,\n  featureStart: number | undefined,\n) {\n  const dStart = displayStart && displayStart > 0 ? displayStart : 0;\n  return Math.max(featureStart || 0, dStart);\n}\nfunction getVisibleEnd(\n  displayEnd: number | undefined,\n  featureEnd: number | undefined,\n  length: number | undefined,\n) {\n  const dEnd = displayEnd && displayEnd > 0 ? displayEnd : length || 0;\n  return Math.min(featureEnd || 0, dEnd);\n}\nexport default NightingaleInterproTrack;\n","import { Segment } from \".\";\nimport NightingaleInterproTrack, {\n  BaseGroup,\n} from \"../nightingale-interpro-track\";\n\nconst MIN_OPACITY_WHILE_COLAPSED = 0.3;\n\nconst cheapScale = (x: number) =>\n  (x + MIN_OPACITY_WHILE_COLAPSED) / (1 + MIN_OPACITY_WHILE_COLAPSED);\n\nexport const createCoverage = ({\n  element,\n  coverage,\n}: {\n  element: NightingaleInterproTrack;\n  coverage: Segment[];\n}) => {\n  element.accession = element?.data?.[0]?.accession || \"_\";\n\n  let mask = element.svg?.select<SVGMaskElement>(\"defs mask\");\n\n  if (!mask?.size())\n    mask = element.svg\n      ?.append(\"defs\")\n      .append(\"mask\")\n      .attr(\"id\", `mask-${element.accession}`);\n\n  mask\n    ?.selectAll(\"rect\")\n    .data(coverage)\n    .enter()\n    .append(\"rect\")\n    .attr(\"y\", 0)\n    .attr(\"height\", element.height);\n};\n\nexport const refreshCoverage = ({\n  element,\n  featuresG,\n  contributorsLength,\n}: {\n  element: NightingaleInterproTrack;\n  featuresG?: BaseGroup;\n  contributorsLength: number;\n}) => {\n  featuresG?.attr(\n    \"mask\",\n    element.expanded ? null : `url(#mask-${element.accession})`,\n  );\n  element.svg\n    ?.selectAll<SVGRectElement, Segment>(\"defs mask rect\")\n    .attr(\"x\", (f) => element.getXFromSeqPosition(f.start))\n    .attr(\"width\", (f) => element.getSingleBaseWidth() * (f.end - f.start + 1))\n    .attr(\"height\", element.height)\n    .attr(\"fill\", \"white\")\n    .attr(\"opacity\", (f) => {\n      return cheapScale((f.value || 0) / (contributorsLength || 1));\n    });\n};\n","import NightingaleInterproTrack from \"./nightingale-interpro-track\";\nexport type { BaseGroup, LabelGroup } from \"./nightingale-interpro-track\";\n\nexport default NightingaleInterproTrack;\n","import { property } from \"lit/decorators.js\";\nimport NightingaleBaseElement, {\n  Constructor,\n} from \"../../nightingale-base-element\";\n\nexport declare class WithDimensionsInterface {\n  width: number;\n  height: number;\n}\n\nconst withDimensions = <T extends Constructor<NightingaleBaseElement>>(\n  superClass: T,\n  options?: {\n    width?: number;\n    height?: number;\n  },\n) => {\n  class WithDimensions extends superClass {\n    // TODO: Making the width reflective makes the withResizable not responsive\n    @property({ type: Number })\n    width?: number = options?.width;\n    @property({ type: Number, reflect: true })\n    height?: number = options?.height;\n  }\n  return WithDimensions as Constructor<WithDimensionsInterface> & T;\n};\n\nexport default withDimensions;\n","import NightingaleBaseElement, {\n  Constructor,\n} from \"../../nightingale-base-element\";\nimport { property } from \"lit/decorators.js\";\n\nexport interface withPositionInterface extends NightingaleBaseElement {\n  \"display-start\"?: number;\n  \"display-end\"?: number;\n  length?: number;\n}\nexport const WHOLE_SEQ = -1;\nconst defaultOptions = {\n  \"display-start\": 1,\n  \"display-end\": WHOLE_SEQ,\n  length: 0,\n};\nconst withPosition = <T extends Constructor<NightingaleBaseElement>>(\n  superClass: T,\n  options: {\n    \"display-start\"?: number;\n    \"display-end\"?: number;\n    length?: number;\n  } = {},\n) => {\n  class WithPosition extends superClass {\n    #intitialOptions = { ...defaultOptions, ...options };\n    #length: number = this.#intitialOptions.length;\n    @property({ type: Number, reflect: true })\n    get length() {\n      return this.#length;\n    }\n    set length(value: number) {\n      this.#length = value;\n      if ((this[\"display-end\"] || 0) > this.#length)\n        this[\"display-end\"] = this.length;\n    }\n\n    @property({ type: Number, reflect: true })\n    \"display-start\"?: number = this.#intitialOptions[\"display-start\"];\n    @property({ type: Number, reflect: true })\n    \"display-end\"?: number = this.#intitialOptions[\"display-end\"];\n  }\n  return WithPosition as Constructor<withPositionInterface> & T;\n};\n\nexport default withPosition;\n","import NightingaleBaseElement, {\n  Constructor,\n} from \"../../nightingale-base-element\";\nimport { property } from \"lit/decorators.js\";\nimport { Selection } from \"d3\";\n\nimport withDimensions, { WithDimensionsInterface } from \"../withDimensions\";\n\nconst DEFAULT_MARGIN_COLOR = \"#FFFFFFDD\";\nexport interface withMarginInterface\n  extends NightingaleBaseElement,\n    WithDimensionsInterface {\n  \"margin-top\": number;\n  \"margin-bottom\": number;\n  \"margin-left\": number;\n  \"margin-right\": number;\n  \"margin-color\": string;\n  getWidthWithMargins: () => number;\n  getHeightWithMargins: () => number;\n  renderMarginOnGroup: (\n    g?: Selection<\n      SVGGElement,\n      unknown,\n      HTMLElement | SVGElement | null,\n      unknown\n    >\n  ) => void;\n}\n\nconst defaultOptions = {\n  \"margin-top\": 0,\n  \"margin-bottom\": 0,\n  \"margin-left\": 10,\n  \"margin-right\": 10,\n  \"margin-color\": DEFAULT_MARGIN_COLOR,\n};\nconst withMargin = <T extends Constructor<NightingaleBaseElement>>(\n  superClass: T,\n  options: {\n    \"margin-top\"?: number;\n    \"margin-bottom\"?: number;\n    \"margin-left\"?: number;\n    \"margin-right\"?: number;\n    \"margin-color\"?: string | null;\n  } = {}\n) => {\n  class WithMargin extends withDimensions(superClass) {\n    #intitialOptions = { ...defaultOptions, ...options };\n    @property({ type: Number })\n    \"margin-top\": number = this.#intitialOptions[\"margin-top\"];\n    @property({ type: Number })\n    \"margin-bottom\": number = this.#intitialOptions[\"margin-bottom\"];\n    @property({ type: Number })\n    \"margin-left\": number = this.#intitialOptions[\"margin-left\"];\n    @property({ type: Number })\n    \"margin-right\": number = this.#intitialOptions[\"margin-right\"];\n    @property({ type: String })\n    \"margin-color\" = this.#intitialOptions[\"margin-color\"];\n\n    #created = false;\n\n    getWidthWithMargins() {\n      return this.width\n        ? this.width - this[\"margin-left\"] - this[\"margin-right\"]\n        : 0;\n    }\n    getHeightWithMargins() {\n      return this.height\n        ? this.height - this[\"margin-top\"] - this[\"margin-bottom\"]\n        : 0;\n    }\n    renderMarginOnGroup(\n      g?: Selection<\n        SVGGElement,\n        unknown,\n        HTMLElement | SVGElement | null,\n        unknown\n      >\n    ) {\n      if (!g) return;\n\n      if (!this.#created || g.select(\"rect\").empty()) {\n        g.append(\"rect\")\n          .style(\"pointer-events\", \"none\")\n          .attr(\"class\", \"margin-left\")\n          .attr(\"x\", 0);\n        g.append(\"rect\")\n          .style(\"pointer-events\", \"none\")\n          .attr(\"class\", \"margin-right\");\n        g.append(\"rect\")\n          .style(\"pointer-events\", \"none\")\n          .attr(\"class\", \"margin-top\")\n          .attr(\"width\", this.width)\n          .attr(\"x\", 0)\n          .attr(\"y\", 0);\n        g.append(\"rect\")\n          .style(\"pointer-events\", \"none\")\n          .attr(\"class\", \"margin-bottom\")\n          .attr(\"width\", this.width)\n          .attr(\"x\", 0);\n\n        this.#created = true;\n      }\n\n      g.select(\"rect.margin-left\")\n        .attr(\"fill\", this[\"margin-color\"] || DEFAULT_MARGIN_COLOR)\n        .attr(\"height\", this.height)\n        .attr(\"width\", this[\"margin-left\"]);\n      g.select(\"rect.margin-right\")\n        .attr(\"fill\", this[\"margin-color\"] || DEFAULT_MARGIN_COLOR)\n        .attr(\"height\", this.height)\n        .attr(\"x\", this.width - this[\"margin-right\"])\n        .attr(\"width\", this[\"margin-right\"]);\n      g.select(\"rect.margin-top\")\n        .attr(\"fill\", this[\"margin-color\"] || DEFAULT_MARGIN_COLOR)\n        .attr(\"height\", this[\"margin-top\"]);\n      g.select(\"rect.margin-bottom\")\n        .attr(\"fill\", this[\"margin-color\"] || DEFAULT_MARGIN_COLOR)\n        .attr(\"y\", this.height - this[\"margin-bottom\"])\n        .attr(\"height\", this[\"margin-bottom\"]);\n    }\n  }\n  return WithMargin as Constructor<withMarginInterface> & T;\n};\n\nexport default withMargin;\n","import { property } from \"lit/decorators.js\";\nimport NightingaleBaseElement, {\n  Constructor,\n} from \"../../nightingale-base-element\";\nimport withDimensions, { WithDimensionsInterface } from \"../withDimensions\";\n\nconst DEFAULT_MIN_HEIGHT = 10;\nconst DEFAULT_MIN_WIDTH = 10;\n\nexport interface WithResizableInterface extends WithDimensionsInterface {\n  \"min-width\": number;\n  \"min-height\": number;\n  onDimensionsChange(): void;\n}\nconst defaultOptions = {\n  \"min-width\": DEFAULT_MIN_WIDTH,\n  \"min-height\": DEFAULT_MIN_HEIGHT,\n};\nconst withResizable = <T extends Constructor<NightingaleBaseElement>>(\n  superClass: T,\n  options: {\n    \"min-width\"?: number;\n    \"min-height\"?: number;\n  } = {}\n) => {\n  class WithResizable extends withDimensions(superClass) {\n    #intitialOptions = { ...defaultOptions, ...options };\n    #observer?: ResizeObserver;\n    @property({ type: Number, reflect: true })\n    \"min-width\": number = this.#intitialOptions[\"min-width\"];\n    @property({ type: Number, reflect: true })\n    \"min-height\": number = this.#intitialOptions[\"min-height\"];\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    constructor(...rest: any[]) {\n      super(...rest);\n      this.onResize = this.onResize.bind(this);\n      this.listenForResize = this.listenForResize.bind(this);\n    }\n\n    private useAvailableWidth() {\n      //Only change this.width if the value in width hasn't been set via its attribute\n      if (this.getAttribute(\"width\") === null) {\n        this.style.width = \"100%\";\n        this.width = Math.max(this.offsetWidth, this[\"min-width\"]);\n      }\n    }\n    private useAvailableHeight() {\n      //Only change this.height if the value in height hasn't been set via its attribute\n      if (this.getAttribute(\"height\") === null) {\n        this.style.height = \"100%\";\n        this.height = Math.max(this.offsetHeight, this[\"min-height\"]);\n      }\n    }\n    onDimensionsChange() {}\n\n    connectedCallback() {\n      this.useAvailableWidth();\n      this.useAvailableHeight();\n      this.listenForResize();\n      super.connectedCallback();\n    }\n    disconnectedCallback() {\n      if (this.#observer) {\n        this.#observer.unobserve(this);\n      }\n      super.disconnectedCallback();\n    }\n\n    private onResize() {\n      const w = this.width;\n      const h = this.height;\n      this.useAvailableWidth();\n      this.useAvailableHeight();\n      if (w !== this.width || h !== this.height) {\n        this.onDimensionsChange();\n      }\n    }\n\n    private listenForResize() {\n      this.#observer = new ResizeObserver(this.onResize);\n      this.#observer.observe(this);\n    }\n  }\n  return WithResizable as Constructor<WithResizableInterface> & T;\n};\n\nexport default withResizable;\n","import NightingaleBaseElement, {\n  Constructor,\n} from \"../../nightingale-base-element\";\n\nconst withManager = <T extends Constructor<NightingaleBaseElement>>(\n  superClass: T,\n) => {\n  class WithManager extends superClass {\n    manager?: HTMLElement | null;\n\n    connectedCallback() {\n      if (this.closest(\"nightingale-manager\")) {\n        customElements.whenDefined(\"nightingale-manager\").then(() => {\n          this.manager = this.closest(\"nightingale-manager\");\n          if (this.manager) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            (this.manager as any).register(this);\n          }\n        });\n      }\n      super.connectedCallback();\n    }\n\n    disconnectedCallback() {\n      if (this.manager) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (this.manager as any).unregister(this);\n      }\n      super.disconnectedCallback();\n    }\n  }\n  return WithManager as T;\n};\n\nexport default withManager;\n","export type SegmentType = { start: number; end: number };\nexport default class Region {\n  segments: SegmentType[];\n  max: number;\n  min: number;\n  regionString: string | null;\n\n  constructor({ min = -Infinity, max = Infinity } = {}) {\n    this.segments = [];\n    this.max = max;\n    this.min = min;\n    this.regionString = null;\n  }\n\n  encode(full = false) {\n    return this.segments\n      .map(({ start, end }) => {\n        if (full) return `${start}:${end}`;\n        const s = start === this.min ? \"\" : start;\n        const e = end === this.max ? \"\" : end;\n        return `${s}:${e}`;\n      })\n      .join(\",\");\n  }\n\n  decode(regionString: string | null) {\n    if (typeof regionString !== \"undefined\") this.regionString = regionString;\n    if (!this.regionString) {\n      this.segments = [];\n      return;\n    }\n    this.segments = this.regionString.split(\",\").map((region) => {\n      const [_start, _end, _] = region.split(\":\");\n      if (typeof _ !== \"undefined\")\n        throw new Error(\n          `there should be at most 1 ':' per region. Region: ${region}`,\n        );\n      let start = _start ? Number(_start) : this.min;\n      let end = _end ? Number(_end) : this.max;\n      if (start > end) [start, end] = [end, start];\n      if (start < this.min) start = this.min;\n      if (end > this.max) end = this.max;\n      if (Number.isNaN(start))\n        throw new Error(\n          `The parsed value of ${_start} is NaN. Region: ${region}`,\n        );\n      if (Number.isNaN(end))\n        throw new Error(\n          `The parsed value of ${_end} is NaN. Region: ${region}`,\n        );\n      return {\n        start,\n        end,\n      };\n    });\n  }\n}\n","import { property } from \"lit/decorators.js\";\nimport NightingaleBaseElement, {\n  Constructor,\n} from \"../../nightingale-base-element\";\nimport Region from \"../../utils/Region\";\n\nconst combineRegions = (region1: string, region2: string): string => {\n  if (!region1) return region2;\n  if (!region2) return region1;\n  return `${region1},${region2}`;\n};\n\nexport declare class WithHighlightInterface {\n  highlight: string;\n  \"highlight-color\": string;\n  highlightedRegion: Region;\n}\nexport const DEFAULT_HIGHLIGHT_COLOR = \"#FFEB3B66\";\n\nconst defaultOptions = {\n  highlight: null,\n  \"highlight-color\": DEFAULT_HIGHLIGHT_COLOR,\n};\nconst withHighlight = <T extends Constructor<NightingaleBaseElement>>(\n  superClass: T,\n  options: {\n    highlight?: string | null;\n    \"highlight-color\"?: string | null;\n  } = {},\n) => {\n  class WithHighlight extends superClass {\n    #initialOptions = { ...defaultOptions, ...options };\n    @property({ type: String, reflect: true })\n    highlight = this.#initialOptions.highlight;\n    @property({ type: String, reflect: true })\n    \"highlight-color\" = this.#initialOptions[\"highlight-color\"];\n\n    highlightedRegion: Region;\n    #fixedHighlight: string | null;\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    constructor(...args: any[]) {\n      super(...args);\n      this.highlightedRegion = new Region({ min: 1 });\n      this.#fixedHighlight = null;\n    }\n    set fixedHighlight(value: string | null) {\n      this.#fixedHighlight = value;\n      this.highlightedRegion.decode(\n        combineRegions(this.highlight || \"\", this.#fixedHighlight || \"\"),\n      );\n      this.updateHighlight();\n    }\n    attributeChangedCallback(\n      name: string,\n      oldValue: string | null,\n      newValue: string | null,\n    ): void {\n      super.attributeChangedCallback(name, oldValue, newValue);\n      if (newValue === \"null\") newValue = null;\n      if (oldValue !== newValue) {\n        if (name === \"length\") {\n          this.highlightedRegion.max = Number(newValue);\n        }\n        if (name === \"highlight\") {\n          this.highlightedRegion.decode(\n            combineRegions(newValue || \"\", this.#fixedHighlight || \"\"),\n          );\n        }\n      }\n    }\n    protected updateHighlight() {\n      return;\n    }\n  }\n  return WithHighlight as Constructor<WithHighlightInterface> & T;\n};\n\nexport default withHighlight;\n","import { property } from \"lit/decorators.js\";\nimport {\n  scaleLinear,\n  zoom as d3zoom,\n  zoomIdentity,\n  ScaleLinear,\n  ZoomBehavior,\n  D3ZoomEvent,\n  Selection,\n} from \"d3\";\n\nimport NightingaleBaseElement, {\n  Constructor,\n} from \"../../nightingale-base-element\";\nimport withDimensions, { WithDimensionsInterface } from \"../withDimensions\";\nimport withPosition, { withPositionInterface } from \"../withPosition\";\nimport withMargin, { withMarginInterface } from \"../withMargin\";\nimport withResizable, { WithResizableInterface } from \"../withResizable\";\n\nexport interface WithZoomInterface\n  extends WithDimensionsInterface,\n    withPositionInterface,\n    withMarginInterface,\n    WithResizableInterface {\n  xScale?: ScaleLinear<number, number>;\n  svg?: Selection<\n    SVGSVGElement,\n    unknown,\n    HTMLElement | SVGElement | null,\n    unknown\n  >;\n  updateScaleDomain(): void;\n  getSingleBaseWidth(): number;\n  getXFromSeqPosition(position: number): number;\n  applyZoomTranslation(): void;\n}\nconst ATTRIBUTES_THAT_TRIGGER_REFRESH = [\"length\", \"width\", \"height\"];\n\nconst withZoom = <T extends Constructor<NightingaleBaseElement>>(\n  superClass: T\n) => {\n  class WithZoom extends withMargin(\n    withPosition(withResizable(withDimensions(superClass)))\n  ) {\n    _applyZoomTranslation: () => void;\n    /**\n     * Base scale without any transformations, only updated in `updateScaleDomain`\n     */\n    private originXScale?: ScaleLinear<number, number>;\n    /**\n     * Temporary scale. It contains the transformations caused by zoom events, but not yet reflected in `display-start` and `display-end`.\n     */\n    private tmpXScale?: ScaleLinear<number, number>;\n    /**\n     * Current scale, the one used to calculate any positions. Calculated based on `display-start` and `display-end`.\n     */\n    xScale?: ScaleLinear<number, number>;\n    _zoom?: ZoomBehavior<HTMLElement, unknown>;\n    _svg?: Selection<HTMLElement, unknown, HTMLElement, unknown>;\n    dontDispatch?: boolean;\n\n    @property({ type: Boolean })\n    \"use-ctrl-to-zoom\" = false;\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    constructor(...args: any[]) {\n      super(...args);\n\n      this.updateScaleDomain = this.updateScaleDomain.bind(this);\n      this._initZoom = this._initZoom.bind(this);\n      this.zoomed = this.zoomed.bind(this);\n      this._applyZoomTranslation = this.applyZoomTranslation.bind(this);\n      let aboutToApply = false;\n      // Postponing the zoom translation to the next frame.\n      // This helps in case several attributes are changed almost at the same time,\n      // in this way, only one refresh will be called.\n      this.applyZoomTranslation = () => {\n        if (aboutToApply) return;\n        aboutToApply = true;\n        requestAnimationFrame(() => {\n          aboutToApply = false;\n          this._applyZoomTranslation();\n        });\n      };\n      // this.scrollFilter = new ScrollFilter(this);\n      // this.wheelListener = (event) => this.scrollFilter.wheel(event);\n    }\n\n    connectedCallback() {\n      this.updateScaleDomain();\n      this._initZoom();\n      // if (this.hasAttribute(\"filter-scroll\")) {\n      //   document.addEventListener(\"wheel\", this.wheelListener, { capture: true });\n      // }\n      super.connectedCallback();\n      this.onDimensionsChange();\n    }\n\n    disconnectedCallback() {\n      // document.removeEventListener(\"wheel\", this.wheelListener);\n      super.disconnectedCallback();\n    }\n\n    get zoom() {\n      return this._zoom;\n    }\n\n    set svg(svg) {\n      if (!svg || !this._zoom) return;\n      this._svg = svg;\n      svg.call(this._zoom).on(\"dblclick.zoom\", null);\n      this.applyZoomTranslation();\n    }\n\n    get svg() {\n      return this._svg;\n    }\n\n    updateScaleDomain() {\n      this.xScale = scaleLinear()\n        // The max width should match the start of the n+1 base\n        .domain([1, (this.length || 0) + 1])\n        .range([0, this.getWidthWithMargins()]);\n      this.originXScale = this.xScale?.copy();\n      this.tmpXScale = this.xScale?.copy();\n      this.zoom?.translateExtent([\n        [0, 0],\n        [this.getWidthWithMargins(), 0],\n      ]);\n    }\n\n    _initZoom() {\n      this._zoom = d3zoom<HTMLElement, unknown>()\n        .scaleExtent([1, Infinity])\n        .translateExtent([\n          [0, 0],\n          [this.getWidthWithMargins(), 0],\n        ])\n        .extent([\n          [0, 0],\n          [this.getWidthWithMargins(), 0],\n        ])\n        .filter((event) => {\n          if (event?.type === \"wheel\") {\n            return !this[\"use-ctrl-to-zoom\"] || event.ctrlKey;\n          }\n          return true;\n          // TODO: deal with event filters\n          //   if (this.hasAttribute(\"scroll-filter\")) {\n          //     const scrollableAttribute = this.getAttribute(\"scrollable\");\n          //     if (scrollableAttribute) return scrollableAttribute === \"true\";\n          //   }\n        })\n        .on(\"zoom\", this.zoomed);\n    }\n\n    attributeChangedCallback(\n      name: string,\n      oldValue: string | null,\n      newValue: string | null\n    ): void {\n      super.attributeChangedCallback(name, oldValue, newValue);\n\n      const newV = newValue === \"null\" ? null : newValue;\n      if (oldValue !== newV) {\n        if (ATTRIBUTES_THAT_TRIGGER_REFRESH.includes(name)) {\n          this.updateScaleDomain();\n        }\n        // One of the observable attributes changed, so the scale needs to be redefined.\n        this.applyZoomTranslation();\n      }\n    }\n\n    zoomed(d3Event: D3ZoomEvent<SVGSVGElement, unknown>) {\n      // Redefines the xScale using the original scale and transform it with the captured event data.\n      if (this.originXScale)\n        this.tmpXScale = d3Event.transform.rescaleX(this.originXScale);\n\n      // New positions based in the updated scale\n      const [start, end] = this?.tmpXScale?.domain() || [0, 0];\n\n      if (this.tmpXScale) {\n        if (this.dontDispatch) {\n          this.xScale = this.tmpXScale;\n        } else {\n          this.dispatchEvent(\n            // Dispatches the event so the manager can propagate this changes to other  components\n            new CustomEvent(\"change\", {\n              detail: {\n                \"display-start\": Math.max(1, start),\n                \"display-end\": Math.min(\n                  this.length || 0,\n                  Math.max(end - 1, start + 1) // To make sure it never zooms in deeper than showing 2 bases covering the full width\n                ),\n              },\n              bubbles: true,\n              cancelable: true,\n            })\n          );\n        }\n      }\n    }\n\n    applyZoomTranslation() {\n      if (!this.svg || !this.originXScale) return;\n      // Calculating the scale factor based in the current start/end coordinates and the length of the sequence.\n      const k = Math.max(\n        1,\n        // +1 because the displayend base should be included\n        (this.length || 0) /\n          (1 + (this[\"display-end\"] || 0) - (this[\"display-start\"] || 0))\n      );\n      // The deltaX gets calculated using the position of the first base to display in original scale\n      const dx = -this.originXScale(this[\"display-start\"] || 0);\n      this.dontDispatch = true; // This is to avoid infinite loops\n      if (this.zoom) {\n        this.svg.call(\n          // We trigger a zoom action\n          this.zoom.transform,\n          zoomIdentity // Identity transformation\n            .scale(k) // Scaled by our scaled factor\n            .translate(dx, 0) // Translated by the delta\n        );\n      }\n      this.dontDispatch = false;\n      this.zoomRefreshed();\n    }\n    zoomRefreshed() {\n      super.render();\n    }\n\n    render() {\n      this.applyZoomTranslation();\n      return super.render();\n    }\n    public override onDimensionsChange() {\n      super.onDimensionsChange();\n      this.svg?.attr(\"width\", this.width);\n      this.svg?.attr(\"height\", this.height);\n      this.updateScaleDomain();\n      this.applyZoomTranslation();\n    }\n\n    getXFromSeqPosition(position: number) {\n      if (!this.xScale) return -1;\n      return this[\"margin-left\"] + this.xScale(position);\n    }\n\n    getSingleBaseWidth() {\n      if (!this.xScale) return -1;\n      return this.xScale(2) - this.xScale(1);\n    }\n  }\n  return WithZoom as Constructor<WithZoomInterface> & T;\n};\n\nexport default withZoom;\n","import { select, Selection } from \"d3\";\n\nimport NightingaleBaseElement, {\n  Constructor,\n} from \"../../../nightingale-base-element\";\n\nimport withHighlight, { WithHighlightInterface } from \"..\";\nimport withZoom, { WithZoomInterface } from \"../../withZoom\";\n\nexport interface WithSVGHighlightInterface\n  extends WithZoomInterface,\n    WithHighlightInterface {\n  createHighlightGroup: () => void;\n  updateHighlight: () => void;\n}\nconst withSVGHighlight = <T extends Constructor<NightingaleBaseElement>>(\n  superClass: T\n) => {\n  class WithSVGHighlight extends withZoom(withHighlight(superClass)) {\n    protected highlighted?: Selection<\n      SVGGElement,\n      unknown,\n      HTMLElement | SVGElement | null,\n      unknown\n    >;\n\n    createHighlightGroup() {\n      const svg = select(this as unknown as NightingaleBaseElement).selectAll<\n        SVGSVGElement,\n        unknown\n      >(\"svg\");\n\n      this.highlighted = svg.append(\"g\").attr(\"class\", \"highlighted\");\n    }\n    updateHighlight() {\n      if (!this.highlighted) return;\n      const highlighs = this.highlighted\n        .selectAll<\n          SVGRectElement,\n          {\n            start: number;\n            end: number;\n          }[]\n        >(\"rect\")\n        .data(this.highlightedRegion.segments);\n\n      highlighs\n        .enter()\n        .append(\"rect\")\n        .style(\"pointer-events\", \"none\")\n        .merge(highlighs)\n        .attr(\"fill\", this[\"highlight-color\"])\n        .attr(\"height\", this.height)\n        .attr(\"x\", (d) => this.getXFromSeqPosition(d.start))\n        .attr(\"width\", (d) =>\n          Math.max(0, this.getSingleBaseWidth() * (d.end - d.start + 1))\n        );\n\n      highlighs.exit().remove();\n    }\n  }\n  return WithSVGHighlight as Constructor<WithSVGHighlightInterface> & T;\n};\n\nexport default withSVGHighlight;\n","import NightingaleBaseElement from \"../nightingale-base-element\";\nimport { WithHighlightInterface } from \"../mixins/withHighlight\";\nimport { Selection, BaseType } from \"d3\";\n\nexport const HIGHLIGHT_EVENT = \"highlight-event\";\n\ntype EventType = \"click\" | \"mouseover\" | \"mouseout\" | \"reset\";\n\ntype FeatureData = {\n  feature?: FeatureData | null;\n  fragments?: Array<{\n    start: number;\n    end: number;\n  }>;\n  start?: number;\n  end?: number;\n  protvistaFeatureId: string;\n};\ntype SequenceBaseData = {\n  position: number;\n  aa: string;\n};\n\ntype detailInterface = {\n  eventType: EventType;\n  // coords: null | [number, number];\n  feature?: FeatureData | SequenceBaseData | null;\n  target?: HTMLElement;\n  highlight?: string;\n  selectedId?: string | null;\n  parentEvent?: Event;\n};\n\nexport function createEvent(\n  type: EventType,\n  feature: FeatureData | SequenceBaseData | null = null,\n  withHighlight = false,\n  withId = false,\n  start?: number,\n  end?: number,\n  target?: HTMLElement,\n  event?: Event,\n  element?: NightingaleBaseElement & WithHighlightInterface,\n): Event {\n  // Variation features have a different shape\n  if (feature) {\n    // eslint-disable-next-line no-param-reassign\n    feature = (feature as FeatureData)?.feature || feature;\n  }\n  const detail: detailInterface = {\n    eventType: type,\n    // TODO: add coordinates\n    // coords: WithNightingaleEvents._getClickCoords(),\n    feature,\n    target,\n    parentEvent: event,\n  };\n  if (withHighlight) {\n    if ((feature as FeatureData)?.fragments) {\n      detail.highlight = ((feature as FeatureData)?.fragments || [])\n        .map((fr) => `${fr.start}:${fr.end}`)\n        .join(\",\");\n    } else if ((event as KeyboardEvent)?.shiftKey && element?.highlight) {\n      // If holding shift, add to the highlights\n      detail.highlight = `${element.highlight},${start}:${end}`;\n    } else {\n      detail.highlight = start && end ? `${start}:${end}` : undefined;\n    }\n  }\n  if (withId) {\n    detail.selectedId = (feature as FeatureData)?.protvistaFeatureId;\n  }\n  return new CustomEvent(\"change\", {\n    detail,\n    bubbles: true,\n    cancelable: true,\n  });\n}\n\nexport default function bindEvents<T extends BaseType>(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  feature: Selection<T, any, any, any>,\n  element: NightingaleBaseElement,\n) {\n  feature\n    .on(\"mouseover\", function (event: Event, datum: unknown) {\n      element.dispatchEvent(\n        createEvent(\n          \"mouseover\",\n          datum as FeatureData | SequenceBaseData,\n          element.getAttribute(HIGHLIGHT_EVENT) === \"onmouseover\",\n          false,\n          (datum as FeatureData).start ?? (datum as SequenceBaseData).position,\n          (datum as FeatureData).end ?? (datum as SequenceBaseData).position,\n          this as unknown as HTMLElement,\n          event,\n        ),\n      );\n    })\n    .on(\"mouseout\", () => {\n      element.dispatchEvent(\n        createEvent(\n          \"mouseout\",\n          null,\n          element.getAttribute(HIGHLIGHT_EVENT) === \"onmouseover\",\n        ),\n      );\n    })\n    .on(\"click\", function (event: Event, datum: unknown) {\n      element.dispatchEvent(\n        createEvent(\n          \"click\",\n          datum as FeatureData | SequenceBaseData,\n          element.getAttribute(HIGHLIGHT_EVENT) === \"onclick\",\n          true,\n          (datum as FeatureData).start ?? (datum as SequenceBaseData).position,\n          (datum as FeatureData).end ?? (datum as SequenceBaseData).position,\n          this as unknown as HTMLElement,\n          event,\n          element as NightingaleBaseElement & WithHighlightInterface,\n        ),\n      );\n    });\n}\n","/* Adapting it from this stack overflow answer: https://stackoverflow.com/a/6511606 */\n\ntype ColorProperty = \"fill\" | \"stroke\" | \"color\";\n\nexport function contrastingColor(color: number[] | null) {\n  if (!color) return \"black\";\n  return luma(color) >= 165 ? \"black\" : \"white\";\n}\nexport function luma(rgb: number[]) {\n  return 0.2126 * rgb[0] + 0.7152 * rgb[1] + 0.0722 * rgb[2]; // SMPTE C, Rec. 709 weightings\n}\n\nexport function getColor(\n  element: Element,\n  property: ColorProperty,\n): number[] | null {\n  const style = getComputedStyle(element);\n  const prop = style?.[property];\n  const res = prop?.match(/[.\\d]+/g)?.map(Number) || null;\n  return res;\n}\n","import { customElement } from \"lit/decorators.js\";\nimport { CustomElementDecorator } from \"lit/decorators\";\n\ntype Constructor<T> = {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  new (...args: any[]): T;\n};\n\ntype CustomElementClass = Omit<typeof HTMLElement, \"new\">;\n\n/**\n * Extending the decorator to define custom elements in order to make sure only gets defined once.\n *\n * ```js\n * @customElementOnce('my-element')\n * class MyElement extends LitElement {\n *   render() {\n *     return html``;\n *   }\n * }\n * ```\n * @category Decorator\n * @param tagName The tag name of the custom element to define.\n */\nexport const customElementOnce =\n  (tagName: string): CustomElementDecorator =>\n  (\n    classOrTarget: CustomElementClass | Constructor<HTMLElement>,\n    context?: ClassDecoratorContext<Constructor<HTMLElement>>\n  ) => {\n    if (!window.customElements.get(tagName))\n      if (context) customElement(tagName)(classOrTarget, context);\n      else customElement(tagName)(classOrTarget);\n  };\n\nexport default customElementOnce;\n","import { LitElement } from \"lit\";\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type Constructor<T = {}> = new (...args: any[]) => T;\n\nclass NightingaleElement extends LitElement {\n  connectedCallback() {\n    super.connectedCallback();\n    this.style.display = \"inline-block\";\n    this.style.lineHeight = \"0\";\n  }\n  createRenderRoot() {\n    return this;\n  }\n}\n\nexport default NightingaleElement;\n","export { default as withDimensions } from \"./mixins/withDimensions/index\";\nexport { default as withPosition } from \"./mixins/withPosition/index\";\nexport { default as withMargin } from \"./mixins/withMargin/index\";\nexport { default as withResizable } from \"./mixins/withResizable/index\";\nexport { default as withManager } from \"./mixins/withManager/index\";\nexport { default as withHighlight } from \"./mixins/withHighlight/index\";\nexport { default as withSVGHighlight } from \"./mixins/withHighlight/SVG/index\";\nexport { default as withZoom } from \"./mixins/withZoom/index\";\nexport { default as bindEvents } from \"./utils/bindEvents\";\nexport { contrastingColor, getColor } from \"./utils/colors\";\nexport { default as Region } from \"./utils/Region\";\nexport { default as customElementOnce } from \"./decorators/customElementOnce\";\nimport NightingaleElement from \"./nightingale-base-element\";\nexport default NightingaleElement;\n","const symbolSize = 10;\n\nexport type Shapes =\n  | \"rectangle\"\n  | \"roundRectangle\"\n  | \"bridge\"\n  | \"line\"\n  | \"bridge\"\n  | \"diamond\"\n  | \"chevron\"\n  | \"catFace\"\n  | \"triangle\"\n  | \"wave\"\n  | \"hexagon\"\n  | \"pentagon\"\n  | \"circle\"\n  | \"arrow\"\n  | \"doubleBar\"\n  | \"discontinuosStart\"\n  | \"discontinuos\"\n  | \"discontinuosEnd\"\n  | \"helix\"\n  | \"strand\";\n\nexport default class FeatureShape {\n  #ftLength = 1;\n  #ftHeight = 1;\n  #ftWidth = 1;\n\n  private shape2function(shape: Shapes) {\n    switch (shape) {\n      case \"rectangle\":\n        return () => this.rectangle();\n      case \"roundRectangle\":\n        return () => this.roundRectangle();\n      case \"line\":\n        return () => this.line();\n      case \"bridge\":\n        return () => this.bridge();\n      case \"diamond\":\n        return () => this.diamond();\n      case \"chevron\":\n        return () => this.chevron();\n      case \"catFace\":\n        return () => this.catFace();\n      case \"triangle\":\n        return () => this.triangle();\n      case \"wave\":\n        return () => this.wave();\n      case \"hexagon\":\n        return () => this.hexagon();\n      case \"pentagon\":\n        return () => this.pentagon();\n      case \"circle\":\n        return () => this.circle();\n      case \"arrow\":\n        return () => this.arrow();\n      case \"doubleBar\":\n        return () => this.doubleBar();\n      case \"discontinuosStart\":\n        return () => this.discontinuosStart();\n      case \"discontinuos\":\n        return () => this.discontinuos();\n      case \"discontinuosEnd\":\n        return () => this.discontinuosEnd();\n      case \"helix\":\n        return () => this.helix();\n      case \"strand\":\n        return () => this.strand();\n      default:\n        return () => this.rectangle();\n    }\n  }\n  getFeatureShape(\n    aaWidth: number,\n    ftHeight: number,\n    ftLength: number,\n    shape: Shapes,\n  ) {\n    shape = shape || \"rectangle\";\n    this.#ftLength = ftLength;\n    this.#ftHeight = ftHeight;\n    this.#ftWidth = aaWidth * ftLength;\n    const shapeFn = this.shape2function(shape);\n    return shapeFn();\n  }\n\n  static isContinuous(shape: Shapes) {\n    return shape.toLowerCase() !== \"bridge\";\n  }\n\n  private rectangle() {\n    return `M0,0L${this.#ftWidth},0L${this.#ftWidth},${this.#ftHeight}L0,${this.#ftHeight}Z`;\n  }\n\n  private roundRectangle() {\n    const radius = 6;\n    return `M${radius},0h${\n      this.#ftWidth - 2 * radius\n    },0a${radius},${radius} 0 0 1 ${radius},${radius}v${\n      this.#ftHeight - 2 * radius\n    }a${radius},${radius} 0 0 1 ${-radius},${radius}h${\n      2 * radius - this.#ftWidth\n    }a${radius},${radius} 0 0 1 ${-radius},${-radius}v${\n      2 * radius - this.#ftHeight\n    }a${radius},${radius} 0 0 1 ${radius},${-radius}Z`;\n  }\n\n  line() {\n    return `M0,${this.#ftHeight / 2} L${this.#ftWidth},${this.#ftHeight / 2}`;\n  }\n\n  bridge() {\n    if (this.#ftLength !== 1) {\n      return `M0,${this.#ftHeight}L0,0L${this.#ftWidth},0L${this.#ftWidth},${this.#ftHeight}L${this.#ftWidth},2L0,2Z`;\n    }\n    return `M0,${this.#ftHeight}L0,${this.#ftHeight / 2}L${this.#ftWidth / 2},${\n      this.#ftHeight / 2\n    }L${this.#ftWidth / 2},0L${this.#ftWidth / 2},${this.#ftHeight / 2}L${\n      this.#ftWidth\n    },${this.#ftHeight / 2}L${this.#ftWidth},${this.#ftHeight}Z`;\n  }\n\n  #getMiddleLine(centerx: number) {\n    return `M0,${centerx}L${this.#ftWidth},${centerx}Z`;\n  }\n\n  diamond() {\n    const centerx = symbolSize / 2;\n    const m = this.#ftWidth / 2;\n    const shape = `M${m},0L${m + centerx},${centerx}L${m},${symbolSize}L${\n      m - centerx\n    },${centerx}`;\n    return this.#ftLength !== 1\n      ? shape + this.#getMiddleLine(centerx)\n      : `${shape}Z`;\n  }\n\n  chevron() {\n    const m = this.#ftWidth / 2;\n    const centerx = symbolSize / 2;\n    const shape = `M${m},${centerx}L${centerx + m},0L${\n      centerx + m\n    },${centerx}L${m},${symbolSize}L${-centerx + m},${centerx}L${\n      -centerx + m\n    },0`;\n    return this.#ftLength !== 1\n      ? `${shape}L${m},${centerx}${this.#getMiddleLine(centerx)}Z`\n      : shape + \"Z\";\n  }\n\n  catFace() {\n    const centerx = symbolSize / 2;\n    const step = symbolSize / 10;\n    const m = this.#ftWidth / 2;\n    const shape = `M${-centerx + m},0L${-centerx + m},${6 * step}L${\n      -2 * step + m\n    },${symbolSize}L${2 * step + m},${symbolSize}L${centerx + m},${6 * step}L${\n      centerx + m\n    },0L${2 * step + m},${4 * step}L${-2 * step + m},${4 * step}`;\n    return this.#ftLength !== 1\n      ? `${shape}M${m},0${this.#getMiddleLine(centerx)}Z`\n      : `${shape}Z`;\n  }\n\n  triangle() {\n    const centerx = symbolSize / 2;\n    const m = this.#ftWidth / 2;\n    const shape = `M${m},0L${centerx + m},${symbolSize}L${\n      -centerx + m\n    },${symbolSize}`;\n    return this.#ftLength !== 1\n      ? `${shape}L${m},0${this.#getMiddleLine(centerx)}Z`\n      : `${shape}Z`;\n  }\n\n  wave() {\n    const rx = symbolSize / 4;\n    const ry = symbolSize / 2;\n    const m = this.#ftWidth / 2;\n    const shape = `M${\n      -symbolSize / 2 + m\n    },${ry}A${rx},${ry} 0 1,1 ${m},${ry}A${rx},${ry} 0 1,0 ${\n      symbolSize / 2 + m\n    },${ry}`;\n    return this.#ftLength !== 1\n      ? `${shape + this.#getMiddleLine(ry)}Z`\n      : `${shape}Z`;\n  }\n\n  private getPolygon(sidesNumber: number) {\n    const r = symbolSize / 2;\n    let polygon = \"M \";\n    const m = this.#ftWidth / 2;\n    for (let i = 0; i < sidesNumber; i++) {\n      polygon += `${r * Math.cos((2 * Math.PI * i) / sidesNumber) + m},${\n        r * Math.sin((2 * Math.PI * i) / sidesNumber) + r\n      } `;\n    }\n    return this.#ftLength !== 1\n      ? `${polygon} ${r * Math.cos(0) + m},${\n          r * Math.sin(0) + r\n        } ${this.#getMiddleLine(r)}Z`\n      : `${polygon}Z`;\n  }\n\n  hexagon() {\n    return this.getPolygon(6);\n  }\n\n  pentagon() {\n    return this.getPolygon(5);\n  }\n\n  circle() {\n    const m = this.#ftWidth / 2;\n    const r = Math.sqrt(symbolSize / Math.PI);\n    const shape = `M${m},0A${r},${r} 0 1,1 ${m},${symbolSize}A${r},${r} 0 1,1 ${m},0`;\n    return this.#ftLength !== 1\n      ? `${shape + this.#getMiddleLine(symbolSize / 2)}Z`\n      : `${shape}Z`;\n  }\n\n  arrow() {\n    const step = symbolSize / 10;\n    const m = this.#ftWidth / 2;\n    const shape = `M${m},0L${-step + m},0L${-5 * step + m},${4 * step}L${\n      -step + m\n    },${this.#ftHeight}L${m},${this.#ftHeight}L${4 * step + m},${4 * step}`;\n    return this.#ftLength !== 1\n      ? `${shape}L${m},0${this.#getMiddleLine(symbolSize / 2)}Z`\n      : `${shape}Z`;\n  }\n\n  doubleBar() {\n    const m = this.#ftWidth / 2;\n    const centerx = symbolSize / 2;\n    const shape = `M${m},0L${-centerx + m},${symbolSize}L${m},${symbolSize}L${\n      centerx + m\n    },0`;\n    return this.#ftLength !== 1\n      ? `${shape}L${m},0${this.#getMiddleLine(symbolSize / 2)}Z`\n      : `${shape}Z`;\n  }\n\n  #getBrokenEnd() {\n    const qh = this.#ftHeight / 4.0;\n    return `L${this.#ftWidth - qh},${qh}L${this.#ftWidth},${2 * qh}L${\n      this.#ftWidth - qh\n    },${3 * qh}L${this.#ftWidth},${this.#ftHeight}`;\n  }\n\n  #getBrokenStart() {\n    const qh = this.#ftHeight / 4.0;\n    return `L${qh},${3 * qh}L0,${2 * qh}L${qh},${qh}`;\n  }\n\n  discontinuosStart() {\n    return `M0,0L${this.#ftWidth},0L${this.#ftWidth},${this.#ftHeight}L0,${\n      this.#ftHeight\n    }${this.#getBrokenStart()}Z`;\n  }\n\n  discontinuos() {\n    return `M0,0L${this.#ftWidth},0${this.#getBrokenEnd()}L0,${\n      this.#ftHeight\n    }${this.#getBrokenStart()}Z`;\n  }\n\n  discontinuosEnd() {\n    return `M0,0L${this.#ftWidth},0${this.#getBrokenEnd()}L0,${\n      this.#ftHeight\n    }Z`;\n  }\n\n  helix() {\n    const x = symbolSize / 2; // Fitting two loops in a symbol\n    const y = symbolSize / 4;\n    let center = x / 2;\n    const nw = Math.round(this.#ftWidth / x);\n\n    let loop = \"\";\n    for (let i = 0; i < nw; i++) {\n      const shape = `M${-(x / 2) + center},${this.#ftHeight} C${center + y},${\n        3 * y\n      } ${x / 2 + center},${y} ${center}, 0 C${center - y},${y} ${center},${\n        3 * y\n      } ${x / 2 + center},${this.#ftHeight}`;\n      loop += shape;\n      center += x;\n    }\n    return loop;\n  }\n\n  strand() {\n    let rl = 0;\n    if (this.#ftWidth > symbolSize / 2) {\n      rl = this.#ftWidth - symbolSize / 2;\n    }\n    const qh = this.#ftHeight / 4;\n    const rect = `M0,${qh}L${rl},${qh}L${rl},${3 * qh}L0,${3 * qh}L0,${qh}`;\n    const triangle = `M${rl},${0}L${this.#ftWidth},${2 * qh}L${rl},${\n      this.#ftHeight\n    }Z`;\n    return rect + triangle;\n  }\n}\n","import { Feature } from \"./nightingale-track\";\n\nexport type LayoutOptions = {\n  layoutHeight: number;\n  margin?: Margin;\n  minHeight?: number;\n};\ntype Margin = {\n  top: number;\n  bottom: number;\n  left: number;\n  right: number;\n};\n\nexport default class DefaultLayout {\n  protected margin: Margin;\n  protected minHeight: number;\n  protected layoutHeight: number;\n\n  features: Feature[];\n\n  constructor({\n    layoutHeight,\n    margin = {\n      top: 1,\n      bottom: 1,\n      left: 0,\n      right: 0,\n    },\n    minHeight = 17,\n  }: LayoutOptions) {\n    this.margin = margin;\n    this.minHeight = minHeight;\n    this.layoutHeight = layoutHeight;\n    this.features = [];\n  }\n\n  init(features: Feature[], ..._args: unknown[]) {\n    this.features = features;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  getFeatureYPos(feature?: Feature | string) {\n    // Position right in the middle of the space between the margins\n    const featureHeight = this.getFeatureHeight();\n    return (\n      this.margin.top +\n      (this.layoutHeight - this.margin.top - this.margin.bottom) / 2 -\n      featureHeight / 2\n    );\n  }\n\n  getFeatureHeight(..._args: unknown[]) {\n    return Math.max(\n      this.minHeight,\n      this.layoutHeight - this.margin.top - this.margin.bottom,\n    );\n  }\n}\n","import DefaultLayout, { LayoutOptions } from \"./DefaultLayout\";\nimport { Feature } from \"./nightingale-track\";\n\nconst featuresOverlap = (feature1: Feature, feature2: Feature) =>\n  !(\n    Number(feature2.start) > Number(feature1.end) ||\n    Number(feature2.end) < Number(feature1.start)\n  );\n\nconst featureOvelapsInRow = (feature: Feature, row: Feature[]) =>\n  row.some((rowFeature) => featuresOverlap(feature, rowFeature));\n\nexport default class NonOverlappingLayout extends DefaultLayout {\n  protected rowHeight: number;\n  featuresMap = new Map();\n  #rows: Feature[][];\n\n  constructor(options: LayoutOptions) {\n    super(options);\n    this.rowHeight = 0;\n    this.minHeight = 15;\n    this.#rows = [];\n  }\n\n  init(features: Feature[]) {\n    features.forEach((feature) => {\n      const rowIndex = this.#rows.findIndex(\n        (row) => !featureOvelapsInRow(feature, row),\n      );\n      if (rowIndex >= 0) {\n        this.#rows[rowIndex].push(feature);\n        this.featuresMap.set(feature, rowIndex);\n      } else {\n        this.#rows.push([feature]);\n        this.featuresMap.set(feature, this.#rows.length - 1);\n      }\n    });\n    this.rowHeight = Math.min(\n      this.layoutHeight / this.#rows.length,\n      this.minHeight,\n    );\n  }\n\n  getOffset() {\n    // this offset is required for centering if the number of rows doesn't\n    // fill the layout\n    if (this.#rows.length * this.rowHeight < this.layoutHeight) {\n      return this.layoutHeight / 2 - (this.#rows.length * this.rowHeight) / 2;\n    }\n    return 0;\n  }\n\n  getFeatureYPos(feature: Feature) {\n    const rowNumber = this.featuresMap.get(feature);\n    return (\n      this.getOffset() +\n      this.rowHeight * rowNumber +\n      this.margin.top +\n      this.margin.bottom\n    );\n  }\n\n  getFeatureHeight() {\n    return this.rowHeight - this.margin.top - this.margin.bottom;\n  }\n}\n","export const config = {\n  CHAIN: {\n    name: \"chain\",\n    label: \"Chain\",\n    tooltip:\n      \"(aka mature region). This describes the extent of a polypeptide chain in the mature protein following processing\",\n    shape: \"rectangle\",\n    color: \"#CC9933\",\n  },\n  TRANSIT: {\n    name: \"transit peptide\",\n    label: \"Transit peptide\",\n    tooltip: \"This describes the extent of a transit peptide\",\n    shape: \"rectangle\",\n    color: \"#009966\",\n  },\n  INIT_MET: {\n    name: \"initiator methionine\",\n    label: \"Initiator methionine\",\n    tooltip:\n      \"This indicates that the initiator methionine is cleaved from the mature protein\",\n    shape: \"arrow\",\n    color: \"#996633\",\n  },\n  PROPEP: {\n    name: \"propeptide\",\n    label: \"Propeptide\",\n    tooltip:\n      \"Part of a protein that is cleaved during maturation or activation\",\n    shape: \"rectangle\",\n    color: \"#99CCCC\",\n  },\n  PEPTIDE: {\n    name: \"peptide\",\n    label: \"Peptide\",\n    tooltip:\n      \"The position and length of an active peptide in the mature protein\",\n    shape: \"rectangle\",\n    color: \"#006699\",\n  },\n  SIGNAL: {\n    name: \"signal peptide\",\n    label: \"Signal peptide\",\n    tooltip: \"N-terminal signal peptide\",\n    shape: \"rectangle\",\n    color: \"#CC0033\",\n  },\n  HELIX: {\n    name: \"helix\",\n    label: \"Helix\",\n    tooltip: \"The positions of experimentally determined helical regions\",\n    shape: \"rectangle\",\n    color: \"#FF0066\",\n  },\n  STRAND: {\n    name: \"strand\",\n    label: \"Beta strand\",\n    tooltip: \"The positions of experimentally determined beta strands\",\n    shape: \"rectangle\",\n    color: \"#FFCC00\",\n  },\n  TURN: {\n    name: \"turn\",\n    label: \"Turn\",\n    tooltip: \"The positions of experimentally determined hydrogen-bonded turns\",\n    shape: \"rectangle\",\n    color: \"#0571AF\",\n  },\n  DISULFID: {\n    name: \"disulfide bond\",\n    label: \"Disulfide bond\",\n    tooltip:\n      \"The positions of cysteine residues participating in disulphide bonds\",\n    shape: \"bridge\",\n    color: \"#23B14D\",\n  },\n  CROSSLNK: {\n    name: \"cross-link\",\n    label: \"Cross-link\",\n    tooltip:\n      \"Covalent linkages of various types formed between two proteins or between two parts of the same protein\",\n    shape: \"bridge\",\n    color: \"#FF6600\",\n  },\n  REGION: {\n    name: \"region of interest\",\n    label: \"Region of interest\",\n    tooltip:\n      \"Regions in multifunctional enzymes or fusion proteins, or characteristics of a region, e.g., protein-protein interactions mediation\",\n    shape: \"rectangle\",\n    color: \"#B33E00\",\n  },\n  COILED: {\n    name: \"coiled-coil region\",\n    label: \"Coiled-coil region\",\n    tooltip:\n      \"Coiled coils are built by two or more alpha-helices that wind around each other to form a supercoil\",\n    shape: \"rectangle\",\n    color: \"#006699\",\n  },\n  MOTIF: {\n    name: \"short sequence motif\",\n    label: \"Short sequence motif\",\n    tooltip: \"Short conserved sequence motif of biological significance\",\n    shape: \"rectangle\",\n    color: \"#402060\",\n  },\n  REPEAT: {\n    name: \"repeat\",\n    label: \"Repeat\",\n    tooltip: \"Repeated sequence motifs or repeated domains within the protein\",\n    shape: \"rectangle\",\n    color: \"#9900FF\",\n  },\n  CA_BIND: {\n    name: \"calcium-binding region\",\n    label: \"Calcium-binding region\",\n    tooltip: \"Calcium-binding regions, such as the EF-hand motif\",\n    shape: \"rectangle\",\n    color: \"#FF3399\",\n  },\n  DNA_BIND: {\n    name: \"DNA-binding region\",\n    label: \"DNA binding\",\n    tooltip:\n      \"DNA-binding domains such as AP2/ERF domain, the ETS domain, the Fork-Head domain, the HMG box and the Myb domain\",\n    shape: \"rectangle\",\n    color: \"#009933\",\n  },\n  DOMAIN: {\n    name: \"other domain of interest\",\n    label: \"Other domain of interest\",\n    tooltip:\n      \"Specific combination of secondary structures organized into a characteristic three-dimensional structure or fold\",\n    shape: \"rectangle\",\n    color: \"#9999FF\",\n  },\n  ZN_FING: {\n    name: \"zinc finger region\",\n    label: \"Zinc finger\",\n    tooltip:\n      \"Small, functional, independently folded domain that coordinates one or more zinc ions\",\n    shape: \"rectangle\",\n    color: \"#990066\",\n  },\n  NP_BIND: {\n    name: \"nucleotide-binding region\",\n    label: \"Nucleotide-binding region\",\n    tooltip:\n      \"(aka flavin-binding). Region in the protein which binds nucleotide phosphates\",\n    shape: \"rectangle\",\n    color: \"#FF9900\",\n  },\n  METAL: {\n    name: \"metal ion-binding site\",\n    label: \"Metal ion-binding site\",\n    tooltip: \"Binding site for a metal ion\",\n    shape: \"diamond\",\n    color: \"#009900\",\n  },\n  SITE: {\n    name: \"other site of interest\",\n    label: \"Other site of interest\",\n    tooltip: \"Any interesting single amino acid site on the sequence\",\n    shape: \"chevron\",\n    color: \"#660033\",\n  },\n  BINDING: {\n    name: \"other binding site\",\n    label: \"Other binding site\",\n    tooltip:\n      \"Binding site for any chemical group (co-enzyme, prosthetic group, etc.)\",\n    shape: \"rectangle\",\n    color: \"#catFace\",\n  },\n  ACT_SITE: {\n    name: \"active site\",\n    label: \"Active site\",\n    tooltip: \"Amino acid(s) directly involved in the activity of an enzyme\",\n    shape: \"circle\",\n    color: \"#FF6666\",\n  },\n  MOD_RES: {\n    name: \"Post-translationally modified residue\",\n    label: \"Modified residue\",\n    tooltip:\n      \"Modified residues such as phosphorylation, acetylation, acylation, methylation\",\n    shape: \"triangle\",\n    color: \"#000066\",\n  },\n  LIPID: {\n    name: \"lipid moiety-binding region\",\n    label: \"Lipidation\",\n    tooltip: \"Covalently attached lipid group(s)\",\n    shape: \"wave\",\n    color: \"#99CC33\",\n  },\n  CARBOHYD: {\n    name: \"glycosylation site\",\n    label: \"Glycosylation\",\n    tooltip: \"Covalently attached glycan group(s)\",\n    shape: \"hexagon\",\n    color: \"#CC3366\",\n  },\n  COMPBIAS: {\n    name: \"compositionally biased region\",\n    label: \"Compositionally biased region\",\n    tooltip:\n      \"Position of regions of compositional bias within the protein and the particular amino acids that are over-represented within those regions\",\n    shape: \"rectangle\",\n    color: \"#FF3366\",\n  },\n  CONFLICT: {\n    name: \"sequence conflict\",\n    label: \"Sequence conflict\",\n    tooltip: \"Sequence discrepancies of unknown origin\",\n    shape: \"rectangle\",\n    color: \"#6633CC\",\n  },\n  NON_CONS: {\n    name: \"non-consecutive residues\",\n    label: \"Non-adjacent residues\",\n    tooltip:\n      \"Indicates that two residues in a sequence are not consecutive and that there is an undetermined number of unsequenced residues between them\",\n    shape: \"doubleBar\",\n    color: \"#FF0033\",\n  },\n  NON_TER: {\n    name: \"non-terminal residue\",\n    label: \"Non-terminal residue\",\n    tooltip:\n      \"The sequence is incomplete. The residue is not the terminal residue of the complete protein\",\n    shape: \"doubleBar\",\n    color: \"#339933\",\n  },\n  UNSURE: {\n    name: \"unsure residue\",\n    label: \"Sequence uncertainty\",\n    tooltip:\n      \"Regions of a sequence for which the authors are unsure about the sequence assignment\",\n    shape: \"rectangle\",\n    color: \"#33FF00\",\n  },\n  NON_STD: {\n    name: \"non-standard amino acid\",\n    label: \"Non-standard residue\",\n    tooltip: \"Non-standard amino acids (selenocysteine and pyrrolysine)\",\n    shape: \"pentagon\",\n    color: \"#330066\",\n  },\n  MUTAGEN: {\n    name: \"mutagenesis site\",\n    label: \"Mutagenesis\",\n    tooltip: \"Site which has been experimentally altered by mutagenesis\",\n    shape: \"rectangle\",\n    color: \"#FF9900\",\n  },\n  TOPO_DOM: {\n    name: \"topological domain\",\n    label: \"Topological domain\",\n    tooltip: \"Location of non-membrane regions of membrane-spanning proteins\",\n    shape: \"rectangle\",\n    color: \"#CC0000\",\n  },\n  TRANSMEM: {\n    name: \"transmembrane region\",\n    label: \"Transmembrane\",\n    tooltip: \"Extent of a membrane-spanning region\",\n    shape: \"rectangle\",\n    color: \"#CC00CC\",\n  },\n  INTRAMEM: {\n    name: \"intramembrane region\",\n    label: \"Intramembrane\",\n    tooltip: \"Extent of a region located in a membrane without crossing it\",\n    shape: \"rectangle\",\n    color: \"#0000CC\",\n  },\n  VAR_SEQ: {\n    name: \"splice variant\",\n    label: \"Splice variant\",\n    tooltip: \"\",\n    shape: \"rectangle\",\n    color: \"#CC11CC\",\n  },\n  VARIANT: {\n    name: \"sequence variant\",\n    label: \"Natural variant\",\n    tooltip:\n      \"Natural variant of the protein, including polymorphisms, variations between strains, isolates or cultivars, disease-associated mutations and RNA editing events\",\n    shape: \"circle\",\n    color: \"black\",\n  },\n  UNIQUE: {\n    name: \"unique\",\n    label: \"Unique peptide\",\n    tooltip: \"\",\n    shape: \"rectangle\",\n    color: \"#fc3133\",\n  },\n  NON_UNIQUE: {\n    name: \"non-unique\",\n    label: \"Non-unique peptide\",\n    tooltip: \"\",\n    shape: \"rectangle\",\n    color: \"#8585fc\",\n  },\n  ANTIGEN: {\n    name: \"antigen\",\n    label: \"Antibody binding sequences\",\n    tooltip: \"\",\n    shape: \"rectangle\",\n    color: \"#996699\",\n  },\n  PDBE_COVER: {\n    name: \"pdbe coverage\",\n    label: \"PDBe 3D structure coverage\",\n    tooltip: \"\",\n    shape: \"rectangle\",\n    color: \"#669966\",\n  },\n};\n","import { config } from \"./config\";\ntype ConfigOption = keyof typeof config;\n\nexport const getShapeByType = (type: string) => {\n  if (type.toUpperCase() in config) {\n    return config[type.toUpperCase() as ConfigOption].shape;\n  }\n  const info = Object.values(config).find(\n    (typeInfo) => typeInfo.name.toUpperCase() === type.toUpperCase(),\n  );\n  if (info) {\n    return info.shape;\n  }\n  return \"rectangle\";\n};\n\nexport const getColorByType = (type: string) => {\n  if (type.toUpperCase() in config) {\n    return config[type.toUpperCase() as ConfigOption].color;\n  }\n  const info = Object.values(config).find(\n    (typeInfo) => typeInfo.name.toUpperCase() === type.toUpperCase(),\n  );\n  if (!info) {\n    console.log(type);\n  }\n  if (info) {\n    return info.color;\n  }\n  return \"black\";\n};\n","import { select, Selection } from \"d3\";\nimport NightingaleElement, {\n  withDimensions,\n  withPosition,\n  withMargin,\n  withResizable,\n  withHighlight,\n  withManager,\n  withZoom,\n  bindEvents,\n  customElementOnce,\n} from \"@nightingale-elements/nightingale-new-core\";\n\n// import _includes from \"lodash-es/includes\";\n// import _groupBy from \"lodash-es/groupBy\";\n// import _union from \"lodash-es/union\";\n// import _intersection from \"lodash-es/intersection\";\n\nimport { html } from \"lit\";\nimport { property } from \"lit/decorators.js\";\n\nimport FeatureShape, { Shapes } from \"./FeatureShape\";\nimport NonOverlappingLayout from \"./NonOverlappingLayout\";\nimport DefaultLayout from \"./DefaultLayout\";\nimport { getShapeByType, getColorByType } from \"./ConfigHelper\";\n\nexport type FeatureLocation = {\n  fragments: Array<{\n    start: number;\n    end: number;\n  }>;\n};\nexport type Feature = {\n  accession: string;\n  color?: string;\n  fill?: string;\n  shape?: Shapes;\n  tooltipContent?: string;\n  type?: string;\n  locations?: Array<FeatureLocation>;\n  feature?: Feature;\n  start?: number;\n  end?: number;\n  opacity?: number;\n};\n\n// TODO: height is not triggering a full redrawn when is changed after first render\nconst ATTRIBUTES_THAT_TRIGGER_REFRESH = [\"length\", \"width\", \"height\"];\n\n@customElementOnce(\"nightingale-track\")\nclass NightingaleTrack extends withManager(\n  withZoom(\n    withResizable(\n      withMargin(\n        withPosition(withDimensions(withHighlight(NightingaleElement))),\n      ),\n    ),\n  ),\n) {\n  @property({ type: String })\n  color?: string | null;\n  @property({ type: String })\n  shape?: string | null;\n  @property({ type: String })\n  layout?: \"non-overlapping\" | \"default\";\n\n  protected featureShape = new FeatureShape();\n  protected layoutObj?: DefaultLayout | NonOverlappingLayout;\n  #originalData: Feature[] = [];\n  #data: Feature[] = [];\n  filters = null;\n\n  protected seqG?: Selection<\n    SVGGElement,\n    unknown,\n    HTMLElement | SVGElement | null,\n    unknown\n  >;\n  #highlighted?: Selection<\n    SVGGElement,\n    unknown,\n    HTMLElement | SVGElement | null,\n    unknown\n  >;\n  protected margins?: Selection<\n    SVGGElement,\n    unknown,\n    HTMLElement | SVGElement | null,\n    unknown\n  >;\n\n  getLayout() {\n    if (String(this.layout).toLowerCase() === \"non-overlapping\")\n      return new NonOverlappingLayout({\n        layoutHeight: this.height,\n      });\n    return new DefaultLayout({\n      layoutHeight: this.height,\n      margin: {\n        top: this[\"margin-top\"],\n        bottom: this[\"margin-bottom\"],\n        left: this[\"margin-left\"],\n        right: this[\"margin-right\"],\n      },\n    });\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.layoutObj = this.getLayout();\n    if (this.#data) this.createTrack();\n\n    // TODO: re-enable when the dataloadre is implemented\n    // this.addEventListener(\"load\", (e) => {\n    //   if (_includes(this.children, e.target)) {\n    //     this.data = e.detail.payload;\n    //   }\n    // });\n  }\n\n  static normalizeLocations(data: Feature[]) {\n    return data.map((obj) => {\n      const { locations, start, end } = obj;\n      return locations\n        ? obj\n        : Object.assign(obj, {\n            locations: [\n              {\n                fragments: [\n                  {\n                    start,\n                    end,\n                  },\n                ],\n              },\n            ],\n          });\n    });\n  }\n\n  processData(data: Feature[]) {\n    this.#originalData = NightingaleTrack.normalizeLocations(data);\n  }\n\n  set data(data: Feature[]) {\n    this.processData(data);\n    this.applyFilters();\n    this.layoutObj = this.getLayout();\n    this.createTrack();\n  }\n  get data() {\n    return this.#data;\n  }\n  // TODO: re-enable filters\n  // set filters(filters) {\n  //   this._filters = filters;\n  //   this.applyFilters();\n  //   this.createTrack();\n  // }\n\n  attributeChangedCallback(\n    name: string,\n    oldValue: string | null,\n    newValue: string | null,\n  ): void {\n    super.attributeChangedCallback(name, oldValue, newValue);\n    if (\n      ATTRIBUTES_THAT_TRIGGER_REFRESH.includes(name) ||\n      name.startsWith(\"margin-\")\n    ) {\n      this.applyFilters();\n      this.layoutObj = this.getLayout();\n      this.createTrack();\n    }\n  }\n\n  protected getFeatureColor(f: Feature | { feature: Feature }): string {\n    const defaultColor = \"gray\";\n    if ((f as Feature).color) {\n      return (f as Feature).color || defaultColor;\n    }\n    if ((f as { feature: Feature })?.feature?.color) {\n      return (f as { feature: Feature })?.feature?.color || defaultColor;\n    }\n    if (this.color) {\n      return this.color;\n    }\n    if ((f as Feature).type) {\n      return getColorByType((f as Feature).type as string);\n    }\n    if ((f as { feature: Feature })?.feature?.type) {\n      return getColorByType((f as { feature: Feature }).feature.type as string);\n    }\n    return defaultColor;\n  }\n\n  protected getFeatureFillColor(f: Feature | { feature: Feature }) {\n    const defaultColor = \"gray\";\n    if ((f as Feature).fill) {\n      return (f as Feature).fill || defaultColor;\n    }\n    if ((f as { feature: Feature })?.feature?.fill) {\n      return (f as { feature: Feature }).feature.fill || defaultColor;\n    }\n    return this.getFeatureColor(f);\n  }\n\n  protected getShape(f: Feature | { feature: Feature }): Shapes {\n    const defaultShape = \"rectangle\";\n    if ((f as Feature).shape) {\n      return (f as Feature).shape || defaultShape;\n    }\n    if ((f as { feature: Feature })?.feature?.shape) {\n      return (f as { feature: Feature }).feature.shape || defaultShape;\n    }\n    if (this.shape) {\n      return this.shape as Shapes;\n    }\n    if ((f as Feature).type) {\n      return getShapeByType((f as Feature).type as string) as Shapes;\n    }\n    if ((f as { feature: Feature }).feature?.type) {\n      return getShapeByType(\n        (f as { feature: Feature }).feature.type as string,\n      ) as Shapes;\n    }\n    return defaultShape;\n  }\n\n  protected createTrack() {\n    if (!this.#data) {\n      return;\n    }\n    this.layoutObj?.init(this.#data);\n\n    this.svg?.selectAll(\"g\").remove();\n\n    this.svg = select(this as unknown as NightingaleElement)\n      .selectAll<SVGSVGElement, unknown>(\"svg\")\n      .attr(\"width\", this.width)\n      .attr(\"height\", this.height);\n\n    if (!this.svg) return;\n    this.seqG = this.svg.append(\"g\").attr(\"class\", \"sequence-features\");\n    this.createFeatures();\n    this.#highlighted = this.svg.append(\"g\").attr(\"class\", \"highlighted\");\n    this.margins = this.svg.append(\"g\").attr(\"class\", \"margin\");\n  }\n\n  protected createFeatures() {\n    if (!this.seqG) return;\n    const featuresG = this.seqG.selectAll(\"g.feature-group\").data(this.#data);\n\n    const locationsG = featuresG\n      .enter()\n      .append(\"g\")\n      .attr(\"class\", \"feature-group\")\n      .attr(\"id\", (d) => `g_${d.accession}`)\n      .selectAll(\"g.location-group\")\n      .data((d) =>\n        (d.locations || []).map((loc) =>\n          Object.assign({}, loc, {\n            feature: d,\n          }),\n        ),\n      )\n      .enter()\n      .append(\"g\")\n      .attr(\"class\", \"location-group\");\n\n    const fragmentGroup = locationsG\n      .selectAll(\"g.fragment-group\")\n      .data((d) =>\n        d.fragments.map((loc) =>\n          Object.assign({}, loc, {\n            feature: d.feature,\n          }),\n        ),\n      )\n      .enter()\n      .append(\"g\")\n      .attr(\"class\", \"fragment-group\");\n\n    fragmentGroup\n      .append(\"path\")\n      .attr(\"class\", (f) => `${this.getShape(f)} feature`)\n      .attr(\"d\", (f) =>\n        this.featureShape.getFeatureShape(\n          this.getSingleBaseWidth(),\n          this.layoutObj?.getFeatureHeight() || 0,\n          f.end ? f.end - f.start + 1 : 1,\n          this.getShape(f),\n        ),\n      )\n      .attr(\n        \"transform\",\n        (f) =>\n          `translate(${this.getXFromSeqPosition(f.start)},${\n            this.layoutObj?.getFeatureYPos(f.feature) || 0\n          })`,\n      )\n      .style(\"fill\", (f) => this.getFeatureFillColor(f))\n      .attr(\"stroke\", (f) => this.getFeatureColor(f))\n      .style(\"fill-opacity\", ({ feature }) =>\n        feature.opacity ? feature.opacity : 0.9,\n      )\n      .style(\"stroke-opacity\", ({ feature }) =>\n        feature.opacity ? feature.opacity : 0.9,\n      );\n\n    fragmentGroup\n      .append(\"rect\")\n      .attr(\"class\", \"outer-rectangle feature\")\n      .attr(\"width\", (f) =>\n        Math.max(\n          0,\n          this.getSingleBaseWidth() * (f.end ? f.end - f.start + 1 : 1),\n        ),\n      )\n      .attr(\"height\", this.layoutObj?.getFeatureHeight() || 0)\n      .attr(\n        \"transform\",\n        (f) =>\n          `translate(${this.getXFromSeqPosition(f.start)},${\n            this.layoutObj?.getFeatureYPos(f.feature) || 0\n          })`,\n      )\n      .style(\"fill\", \"transparent\")\n      .attr(\"stroke\", \"transparent\")\n      .call(bindEvents, this);\n  }\n\n  private applyFilters() {\n    if ((this.filters || []).length <= 0) {\n      this.#data = this.#originalData;\n      return;\n    }\n    // TODO: re-enable filters\n    //   // Filters are OR-ed within a category and AND-ed between categories\n    //   const groupedFilters = _groupBy(this._filters, \"category\");\n    //   const filteredGroups = Object.values(groupedFilters).map((filterGroup) => {\n    //     const filteredData = filterGroup.map((filterItem) =>\n    //       filterItem.filterFn(this.#originalData)\n    //     );\n    //     return _union(...filteredData);\n    //   });\n    //   const intersection = _intersection(...filteredGroups);\n    //   this._data = intersection;\n  }\n\n  refresh() {\n    if (this.xScale && this.seqG) {\n      const fragmentG = this.seqG.selectAll(\"g.fragment-group\").data(\n        this.#data.reduce(\n          (acc: unknown[], f) =>\n            acc.concat(\n              (f.locations || []).reduce(\n                (acc2: unknown[], e) =>\n                  acc2.concat(\n                    e.fragments.map((loc) =>\n                      Object.assign({}, loc, {\n                        feature: f,\n                      }),\n                    ),\n                  ),\n                [],\n              ),\n            ),\n          [],\n        ),\n      );\n\n      fragmentG\n        .selectAll<SVGPathElement, Feature>(\"path.feature\")\n        .attr(\"d\", (f) =>\n          this.featureShape.getFeatureShape(\n            this.getSingleBaseWidth(),\n            this.layoutObj?.getFeatureHeight() || 0,\n            f?.end && f?.start ? f.end - f.start + 1 : 1,\n            this.getShape(f),\n          ),\n        )\n        .attr(\n          \"transform\",\n          (f) =>\n            `translate(${this.getXFromSeqPosition(\n              f.start || 0,\n            )},${this.layoutObj?.getFeatureYPos(f.feature as Feature)})`,\n        );\n\n      fragmentG\n        .selectAll<SVGRectElement, Feature>(\"rect.outer-rectangle\")\n        .attr(\"width\", (f) =>\n          Math.max(\n            0,\n            this.getSingleBaseWidth() *\n              (f?.end && f?.start ? f.end - f.start + 1 : 1),\n          ),\n        )\n        .attr(\"height\", this.layoutObj?.getFeatureHeight() || 0)\n        .attr(\n          \"transform\",\n          (f) =>\n            `translate(${this.getXFromSeqPosition(f.start || 0)},${\n              this.layoutObj?.getFeatureYPos(f.feature as Feature) || 0\n            })`,\n        );\n    }\n    this.updateHighlight();\n\n    this.renderMarginOnGroup(this.margins);\n  }\n\n  protected updateHighlight() {\n    if (!this.#highlighted) return;\n    const highlighs = this.#highlighted\n      .selectAll<\n        SVGRectElement,\n        {\n          start: number;\n          end: number;\n        }[]\n      >(\"rect\")\n      .data(this.highlightedRegion.segments);\n\n    highlighs\n      .enter()\n      .append(\"rect\")\n      .style(\"pointer-events\", \"none\")\n      .merge(highlighs)\n      .attr(\"fill\", this[\"highlight-color\"])\n      .attr(\"height\", this.height)\n      .attr(\"x\", (d) => this.getXFromSeqPosition(d.start))\n      .attr(\"width\", (d) =>\n        Math.max(0, this.getSingleBaseWidth() * (d.end - d.start + 1)),\n      );\n\n    highlighs.exit().remove();\n  }\n\n  zoomRefreshed() {\n    if (this.getWidthWithMargins() > 0) this.refresh();\n  }\n\n  firstUpdated() {\n    this.createTrack();\n  }\n\n  render() {\n    return html`<svg class=\"container\"></svg>`;\n  }\n}\n\nexport default NightingaleTrack;\n\nexport { DefaultLayout };\nexport { getColorByType };\n","import NightingaleTrack from \"./nightingale-track\";\nexport { default as DefaultLayout } from \"./DefaultLayout\";\nexport { default as NonOverlappingLayout } from \"./NonOverlappingLayout\";\nexport type { Feature, FeatureLocation } from \"./nightingale-track\";\nexport type { LayoutOptions } from \"./DefaultLayout\";\nexport type { Shapes } from \"./FeatureShape\";\n\nexport default NightingaleTrack;\n"],"names":["InterproEntryLayout","DefaultLayout","constructor","_b","expanded","padding","super","__rest","_InterproEntryLayout_heightMap","set","Map","_InterproEntryLayout_yPositionMap","maxYPos","this","init","features","children","yPos","__classPrivateFieldSet","residuesPos","k","length","feature","isCollapsible","residues","__classPrivateFieldGet","accession","get","Math","max","_InterproEntryLayout_instances","_InterproEntryLayout_initResidues","call","locations","child","has","filterOutResidueFragmentsOutOfLocation","residue","featureLocations","forEach","locRes","fragments","filter","fragRes","some","loc","frag","start","end","getAccFromFeature","acc","getFeatureYPos","_a","getFeatureHeight","featureAcc","innerPadding","locs","i","resGroup","j","desc","description","height","addContributor","contributor","coverage","toContribute","Object","assign","value","newCoverage","segment","push","createResidueGroup","baseG","selectAll","data","d","map","r","enter","append","attr","location","createResiduePaths","_ref","getResidueShape","getResidueTransform","getResidueFill","element","currentResidue","bindEvents","refreshResiduePaths","_ref2","paths","numberOfSibillings","Set","f","size","style","colorCache","NightingaleInterproTrack","NightingaleInterproTrack_1","NightingaleTrack","label","layout","undefined","_NightingaleInterproTrack_contributors","_NightingaleInterproTrack_coverage","_NightingaleInterproTrack_haveCreatedFeatures","_NightingaleInterproTrack_childrenG","_NightingaleInterproTrack_featuresG","_NightingaleInterproTrack_residuesG","_NightingaleInterproTrack_childResiduesG","createTrack","layoutObj","connectedCallback","attributeChangedCallback","name","oldValue","newValue","c","contributors","normalizeLocations","createEmptyFragments","fr","getCoverage","getLayout","layoutHeight","createFeatures","seqG","reduce","agg","v","min","Infinity","getShape","on","removeAttribute","setAttribute","svg","childrenGroup","_c","childGroup","locationChildrenG","_","fragment","_event","refresh","_d","mask","select","createCoverage","_e","_f","featureShape","getFeatureShape","getSingleBaseWidth","getXFromSeqPosition","getFeatureColor","getTextLabel","datum","startsWith","_get","slice","refreshLabels","base","displayStart","displayEnd","getVisibleStart","getVisibleEnd","nodes","parentElement","querySelector","contrastingColor","colorKeyword","el","document","createElement","color","body","appendChild","rgbValue","window","getComputedStyle","removeChild","res","match","Number","colorKeywordToRGB","getFeatureFillColor","text","each","n","self","width","textLength","node","getComputedTextLength","refreshFeatures","shape","refreshCoverLine","coverLinesChildren","featureChildren","featuresG","contributorsLength","refreshCoverage","_g","_h","updateHighlight","renderMarginOnGroup","margins","featureStart","dStart","featureEnd","dEnd","__decorate","property","type","Boolean","String","customElement","withDimensions","superClass","options","WithDimensions","reflect","defaultOptions","WithPosition","_WithPosition_intitialOptions","_WithPosition_length","DEFAULT_MARGIN_COLOR","WithMargin","_WithMargin_intitialOptions","_WithMargin_created","getWidthWithMargins","getHeightWithMargins","g","empty","WithResizable","arguments","_WithResizable_intitialOptions","_WithResizable_observer","onResize","bind","listenForResize","useAvailableWidth","getAttribute","offsetWidth","useAvailableHeight","offsetHeight","onDimensionsChange","disconnectedCallback","unobserve","w","h","ResizeObserver","observe","closest","customElements","whenDefined","then","manager","register","unregister","Region","_temp","segments","regionString","encode","full","join","decode","split","region","_start","_end","Error","isNaN","combineRegions","region1","region2","highlight","WithHighlight","_WithHighlight_initialOptions","_WithHighlight_fixedHighlight","highlightedRegion","fixedHighlight","ATTRIBUTES_THAT_TRIGGER_REFRESH","WithZoom","withMargin","withPosition","withResizable","updateScaleDomain","_initZoom","zoomed","_applyZoomTranslation","applyZoomTranslation","aboutToApply","requestAnimationFrame","zoom","_zoom","_svg","xScale","scaleLinear","domain","range","originXScale","copy","tmpXScale","translateExtent","d3zoom","scaleExtent","extent","event","ctrlKey","includes","d3Event","transform","rescaleX","dontDispatch","dispatchEvent","CustomEvent","detail","bubbles","cancelable","dx","zoomIdentity","scale","translate","zoomRefreshed","render","position","WithSVGHighlight","withZoom","withHighlight","createHighlightGroup","highlighted","highlighs","merge","exit","remove","HIGHLIGHT_EVENT","createEvent","withId","target","eventType","parentEvent","shiftKey","selectedId","protvistaFeatureId","rgb","tagName","classOrTarget","context","NightingaleElement","LitElement","display","lineHeight","createRenderRoot","centerx","_FeatureShape_ftWidth","_FeatureShape_getBrokenEnd","qh","_FeatureShape_ftHeight","_FeatureShape_getBrokenStart","_FeatureShape_ftLength","shape2function","rectangle","roundRectangle","line","bridge","diamond","chevron","catFace","triangle","wave","hexagon","pentagon","circle","arrow","doubleBar","discontinuosStart","discontinuos","discontinuosEnd","helix","strand","aaWidth","ftHeight","ftLength","shapeFn","isContinuous","toLowerCase","m","symbolSize","_FeatureShape_instances","_FeatureShape_getMiddleLine","getPolygon","sidesNumber","polygon","cos","PI","sin","sqrt","y","center","x","nw","round","loop","rl","margin","top","bottom","left","right","minHeight","featureHeight","featuresMap","_NonOverlappingLayout_rows","rowHeight","rowIndex","findIndex","row","featureOvelapsInRow","rowFeature","featuresOverlap","feature1","feature2","getOffset","rowNumber","config","CHAIN","tooltip","TRANSIT","INIT_MET","PROPEP","PEPTIDE","SIGNAL","HELIX","STRAND","TURN","DISULFID","CROSSLNK","REGION","COILED","MOTIF","REPEAT","CA_BIND","DNA_BIND","DOMAIN","ZN_FING","NP_BIND","METAL","SITE","BINDING","ACT_SITE","MOD_RES","LIPID","CARBOHYD","COMPBIAS","CONFLICT","NON_CONS","NON_TER","UNSURE","NON_STD","MUTAGEN","TOPO_DOM","TRANSMEM","INTRAMEM","VAR_SEQ","VARIANT","UNIQUE","NON_UNIQUE","ANTIGEN","PDBE_COVER","getShapeByType","toUpperCase","info","values","find","typeInfo","getColorByType","console","log","NightingaleTrack_1","withManager","FeatureShape","_NightingaleTrack_originalData","_NightingaleTrack_data","filters","_NightingaleTrack_highlighted","NonOverlappingLayout","obj","processData","applyFilters","defaultColor","fill","defaultShape","fragmentGroup","opacity","fragmentG","concat","acc2","e","firstUpdated","html","_templateObject","customElementOnce"],"sourceRoot":""}