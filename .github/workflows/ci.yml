name: CI Pipeline

on:
  push:
    branches:
      - deploy  # Trigger only for the deploy branch
    paths:
      - 'dev/**'  # Changes in the 'dev' folder
      - 'runner/**'  # Changes in the 'runner' folder
      - 'master/**'  # Changes in the 'master' folder

jobs:
  build:
    runs-on: self-hosted 

    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          clean: false
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 1 

      - name: Release 
        run: |

            source ~/miniforge3/etc/profile.d/conda.sh
            conda activate base
            diff_result=$(git diff --name-only b117b061449e2f1b66c9baba00f120ecf0c9c50d 87c72ec928bb21c2937b6f41bc8b20d01f93ebda)
            echo "$diff_result"

            # # Release to dev if changes detected in the 'dev' folder
            # if git diff --name-only ${{ github.event.before }} ${{ github.sha }} | grep -q '^dev/'; then
            #   export VM_BASE_PATH="/nfs/www-prod/web_hx2/interpro/dev/website/releases/";
            #   export VM_NAME="wp-np3-bd";
            # # Release to runner if changes detected in the 'runner' folder
            # elif git diff --name-only ${{ github.event.before }} ${{ github.sha }} | grep -q '^runner/'; then
            #   echo "Runner changed"
            # # Release to master if changes detected in the 'master' folder
            # elif git diff --name-only ${{ github.event.before }} ${{ github.sha }} | grep -q '^master/'; then
            #   export VM_BASE_PATH="/nfs/www-prod/web_hx2/interpro/master/website/releases/";
            #   export VM_NAME="wp-np3-bd";
            # fi
